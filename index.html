<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Production Analytics | FW2022</title>

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <!-- Icons -->
    <link href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.css" rel="stylesheet">

    <!-- Libraries -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <link rel="stylesheet" href="styles.css?v=20260112">
    <link rel="icon" type="image/png" href="favicon.png">
</head>

<body>
    <!-- Login Overlay -->
    <div id="loginOverlay" class="login-overlay">
        <div class="login-container">
            <div class="login-logo">
                <img src="logo.png" alt="EIPC" class="login-logo-image" id="loginLogoImage">
            </div>


            <form id="loginForm" class="login-form">
                <div class="login-field">
                    <label for="userSelect">Usuario</label>
                    <div class="login-input-wrapper">
                        <i class="ri-user-line"></i>
                        <select id="userSelect" required>
                            <option value="">Cargando usuarios...</option>
                        </select>
                    </div>
                </div>

                <div class="login-field">
                    <label for="passwordInput">Contraseña</label>
                    <div class="login-input-wrapper">
                        <i class="ri-lock-line"></i>
                        <input type="password" id="passwordInput" placeholder="••••••••••">
                        <button type="button" class="toggle-password" id="togglePassword">
                            <i class="ri-eye-line"></i>
                        </button>
                    </div>
                </div>

                <button type="submit" class="login-btn">Iniciar sesión</button>
            </form>

            <!-- Admin Panel Link (hidden by default, shown for admins after login redirect) -->
            <div id="adminPanelLink" class="admin-link" style="display: none; margin-top: 1rem; text-align: center;">
                <a href="#" onclick="showAdminPanel(); return false;"
                    style="color: var(--primary); text-decoration: none; font-size: 0.875rem;">
                    <i class="ri-settings-3-line"></i> Panel de Administración
                </a>
            </div>

            <div class="login-footer">
                © 2026 Eibar Precision Casting
            </div>
        </div>
    </div>

    <div class="layout">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="logo-container">
                <img src="logo.png" alt="Eibar Precision Casting. S.L" class="logo-image"
                    style="height: 80px; width: auto;">
            </div>

            <div class="sidebar-content">
                <!-- INICIO Section - Single Item (No collapsible) -->
                <div class="nav-section" style="margin-top: 1rem;">
                    <a href="#" class="nav-item" data-view="inicio" style="margin: 0 0.5rem;">
                        <i class="ri-home-4-line"></i>
                        <span style="font-weight: 600; font-size: 0.875rem; letter-spacing: 0.5px;">INICIO</span>
                    </a>
                </div>

                <!-- MAESTROS Section - Collapsible -->
                <div class="nav-section">
                    <div class="nav-section-header" id="maestrosHeader" data-view="maestros">
                        <div class="nav-section-title">
                            <i class="ri-database-2-line"></i>
                            <span>MAESTROS</span>
                        </div>
                        <i class="ri-arrow-down-s-line nav-section-arrow"></i>
                    </div>
                    <nav class="nav-menu nav-submenu" id="maestrosMenu">
                        <a href="#" class="nav-item" data-view="articulos">
                            <i class="ri-file-list-2-line"></i>
                            <span>Articulos</span>
                        </a>
                        <a href="#" class="nav-item" data-view="centros">
                            <i class="ri-building-line"></i>
                            <span>Centros</span>
                        </a>
                        <a href="#" class="nav-item" data-view="especificaciones">
                            <i class="ri-file-text-line"></i>
                            <span>Especificaciones</span>
                        </a>
                        <a href="#" class="nav-item" data-view="proveedores">
                            <i class="ri-truck-line"></i>
                            <span>Proveedores</span>
                        </a>
                        <a href="#" class="nav-item" data-view="clientes">
                            <i class="ri-user-star-line"></i>
                            <span>Clientes</span>
                        </a>
                        <a href="#" class="nav-item" data-view="codigos-rechazo">
                            <i class="ri-alert-line"></i>
                            <span>Códigos rechazo</span>
                        </a>
                        <a href="#" class="nav-item" data-view="incidencias">
                            <i class="ri-error-warning-line"></i>
                            <span>Incidencias</span>
                        </a>
                        <a href="#" class="nav-item" data-view="utillajes">
                            <i class="ri-tools-line"></i>
                            <span>Utillajes</span>
                        </a>
                        <a href="#" class="nav-item" data-view="ausencias">
                            <i class="ri-calendar-close-line"></i>
                            <span>Ausencias</span>
                        </a>
                        <a href="#" class="nav-item" data-view="materiales">
                            <i class="ri-box-3-line"></i>
                            <span>Materiales</span>
                        </a>
                        <a href="#" class="nav-item" data-view="normas">
                            <i class="ri-book-2-line"></i>
                            <span>Normas</span>
                        </a>
                        <a href="#" class="nav-item" data-view="rutas">
                            <i class="ri-route-line"></i>
                            <span>Rutas</span>
                        </a>
                        <a href="#" class="nav-item" data-view="operarios">
                            <i class="ri-team-line"></i>
                            <span>Operarios</span>
                        </a>
                        <a href="#" class="nav-item" data-view="operaciones">
                            <i class="ri-tools-line"></i>
                            <span>Operaciones</span>
                        </a>
                        <a href="#" class="nav-item" data-view="activos">
                            <i class="ri-device-line"></i>
                            <span>Activos</span>
                        </a>
                        <a href="#" class="nav-item" data-view="equipos">
                            <i class="ri-cpu-line"></i>
                            <span>Equipos</span>
                        </a>
                        <a href="#" class="nav-item" data-view="secciones">
                            <i class="ri-layout-2-line"></i>
                            <span>Secciones</span>
                        </a>
                        <a href="#" class="nav-item" data-view="estructuras">
                            <i class="ri-organization-chart"></i>
                            <span>Estructuras</span>
                        </a>
                    </nav>
                </div>

                <!-- HeatTreat Section - Collapsible -->
                <div class="nav-section">
                    <div class="nav-section-header" id="heattreatHeader" data-view="dashboard">
                        <div class="nav-section-title">
                            <i class="ri-fire-fill"></i>
                            <span>HEATTREAT</span>
                        </div>
                        <i class="ri-arrow-down-s-line nav-section-arrow"></i>
                    </div>
                    <nav class="nav-menu nav-submenu" id="heattreatMenu">
                        <a href="#" class="nav-item" data-view="orders">
                            <i class="ri-file-list-3-line"></i>
                            <span>Coladas-TT</span>
                        </a>
                    </nav>
                </div>

                <!-- CALIDAD Section - Collapsible -->
                <div class="nav-section">
                    <div class="nav-section-header" id="calidadHeader">
                        <div class="nav-section-title">
                            <i class="ri-shield-check-line"></i>
                            <span>CALIDAD</span>
                        </div>
                        <i class="ri-arrow-down-s-line nav-section-arrow"></i>
                    </div>
                    <nav class="nav-menu nav-submenu" id="calidadMenu">
                        <a href="#" class="nav-item" data-view="calidad-rechazos">
                            <i class="ri-close-circle-line"></i>
                            <span>Rechazos</span>
                        </a>
                    </nav>
                </div>

                <!-- COMPRAS Section MOVED DOWN -->

                <!-- PERSONAL Section - Collapsible -->
                <div class="nav-section">
                    <div class="nav-section-header" id="personalHeader" data-view="personal-dashboard">
                        <div class="nav-section-title">
                            <i class="ri-user-settings-line"></i>
                            <span>PERSONAL</span>
                        </div>
                        <i class="ri-arrow-down-s-line nav-section-arrow"></i>
                    </div>
                    <nav class="nav-menu nav-submenu" id="personalMenu">
                        <a href="#" class="nav-item" data-view="bonos">
                            <i class="ri-medal-line"></i>
                            <span>Bonos</span>
                        </a>
                        <a href="#" class="nav-item" data-view="formacion">
                            <i class="ri-book-open-line"></i>
                            <span>Formación</span>
                        </a>
                        <a href="#" class="nav-item" data-view="matriz-polivalencias">
                            <i class="ri-grid-fill"></i>
                            <span>Matriz de Polivalencias</span>
                        </a>
                        <a href="#" class="nav-item" data-view="capacitaciones">
                            <i class="ri-school-line"></i>
                            <span>Capacitaciones</span>
                        </a>
                        <a href="#" class="nav-item" data-view="certificaciones">
                            <i class="ri-award-line"></i>
                            <span>Certificaciones</span>
                        </a>
                    </nav>
                </div>

                <!-- ENSAYOS Section - Collapsible -->
                <div class="nav-section">
                    <div class="nav-section-header" id="ensayosHeader" data-view="ensayos-dashboard">
                        <div class="nav-section-title">
                            <i class="ri-test-tube-line"></i>
                            <span>ENSAYOS</span>
                        </div>
                        <i class="ri-arrow-down-s-line nav-section-arrow"></i>
                    </div>
                    <nav class="nav-menu nav-submenu" id="ensayosMenu">
                        <!-- Dashboard implicit in header -->
                        <a href="#" class="nav-item" data-view="ensayos-vt">
                            <i class="ri-eye-line"></i>
                            <span>Informes VT</span>
                        </a>
                        <a href="#" class="nav-item" data-view="ensayos-pt">
                            <i class="ri-drop-line"></i>
                            <span>Informes PT</span>
                        </a>
                        <a href="#" class="nav-item" data-view="ensayos-rt">
                            <i class="ri-file-list-3-line"></i>
                            <span>Informes RT</span>
                        </a>
                        <a href="#" class="nav-item" data-view="ensayos-dureza">
                            <i class="ri-hammer-line"></i>
                            <span>Informes Dureza</span>
                        </a>
                        <a href="#" class="nav-item" data-view="ensayos-traccion">
                            <i class="ri-drag-move-2-line"></i>
                            <span>Informes Tracción</span>
                        </a>
                        <a href="#" class="nav-item" data-view="ensayos-metalografia">
                            <i class="ri-microscope-line"></i>
                            <span>Informes Metalografía</span>
                        </a>
                    </nav>
                </div>

                <!-- MANTENIMIENTO Section - Collapsible -->
                <div class="nav-section">
                    <div class="nav-section-header" id="mantenimientoHeader">
                        <div class="nav-section-title">
                            <i class="ri-tools-fill"></i>
                            <span>MANTENIMIENTO</span>
                        </div>
                        <i class="ri-arrow-down-s-line nav-section-arrow"></i>
                    </div>
                    <nav class="nav-menu nav-submenu" id="mantenimientoMenu">
                        <!-- Se añadirán subsecciones aquí -->
                    </nav>
                </div>

                <!-- CALIBRACIONES Section - Collapsible -->
                <div class="nav-section">
                    <div class="nav-section-header" id="calibracionesHeader" data-view="equipos">
                        <div class="nav-section-title">
                            <i class="ri-ruler-line"></i>
                            <span>CALIBRACIONES</span>
                        </div>
                        <i class="ri-arrow-down-s-line nav-section-arrow"></i>
                    </div>
                    <nav class="nav-menu nav-submenu" id="calibracionesMenu">
                        <!-- Se añadirán subsecciones aquí -->
                    </nav>
                </div>

                <!-- PRODUCCION Section - Collapsible -->
                <div class="nav-section">
                    <div class="nav-section-header" id="produccionHeader">
                        <div class="nav-section-title">
                            <i class="ri-git-pull-request-fill"></i>
                            <span>PRODUCCION</span>
                        </div>
                        <i class="ri-arrow-down-s-line nav-section-arrow"></i>
                    </div>
                    <nav class="nav-menu nav-submenu" id="produccionMenu">
                        <a href="#" class="nav-item" data-view="oee">
                            <i class="ri-speed-up-line"></i>
                            <span>OEE</span>
                        </a>
                        <a href="#" class="nav-item" data-view="ordenes">
                            <i class="ri-file-list-3-line"></i>
                            <span>Ordenes</span>
                        </a>

                    </nav>
                </div>

                <!-- COMPRAS Section - Collapsible -->
                <div class="nav-section">
                    <div class="nav-section-header" id="comprasHeader" data-view="compras-dashboard">
                        <div class="nav-section-title">
                            <i class="ri-shopping-cart-line"></i>
                            <span>COMPRAS</span>
                        </div>
                        <i class="ri-arrow-down-s-line nav-section-arrow"></i>
                    </div>
                    <nav class="nav-menu nav-submenu" id="comprasMenu">
                        <a href="#" class="nav-item" data-view="solicitante-compras">
                            <i class="ri-file-list-line"></i>
                            <span>Solicitante Compras</span>
                        </a>
                        <a href="#" class="nav-item" data-view="pedidos">
                            <i class="ri-shopping-bag-line"></i>
                            <span>Pedidos</span>
                        </a>
                        <a href="#" class="nav-item" data-view="albaranes">
                            <i class="ri-file-text-line"></i>
                            <span>Albaranes</span>
                        </a>
                        <a href="#" class="nav-item" data-view="facturas">
                            <i class="ri-file-copy-line"></i>
                            <span>Facturas</span>
                        </a>
                    </nav>
                </div>

                <!-- COMERCIAL Section - Collapsible -->
                <div class="nav-section">
                    <div class="nav-section-header" id="comercialHeader" data-view="comercial-dashboard">
                        <div class="nav-section-title">
                            <i class="ri-briefcase-line"></i>
                            <span>COMERCIAL</span>
                        </div>
                        <i class="ri-arrow-down-s-line nav-section-arrow"></i>
                    </div>
                    <nav class="nav-menu nav-submenu" id="comercialMenu">
                        <a href="#" class="nav-item" data-view="otd">
                            <i class="ri-truck-line"></i>
                            <span>OTD</span>
                        </a>
                        <a href="#" class="nav-item" data-view="capa-charge">
                            <i class="ri-bar-chart-grouped-line"></i>
                            <span>Capa Charge</span>
                        </a>
                    </nav>
                </div>

            </div>

            <!-- ADMIN Section - Hidden by default, shown only for admins -->
            <div id="adminSection" class="nav-section"
                style="display: none; margin-top: 1rem; border-top: 1px solid var(--border); padding-top: 1rem;">
                <a href="#" class="nav-item" data-view="admin"
                    style="margin: 0 0.5rem; background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%); color: white; border-radius: 8px;">
                    <i class="ri-settings-3-line"></i>
                    <span style="font-weight: 600;">ADMINISTRACIÓN</span>
                </a>
            </div>

            <div class="sidebar-footer" style="text-align: center;">
                <div class="connection-status online" id="connectionStatus" style="justify-content: center;">
                    <span class="status-dot"></span>
                    <span class="status-text">Conectado a SQL</span>
                </div>
                <p class="last-update"
                    style="font-size: 0.7rem; color: var(--text-muted); margin: 0.5rem 0 0 0; text-align: center;">
                    Última actualización: <span id="lastUpdate">--:--</span></p>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Header -->
            <header class="top-header">
                <div class="header-title">
                    <h1 id="pageTitle" style="display: flex; align-items: center; gap: 0.5rem; margin: 0;">Dashboard
                        General</h1>
                    <p id="pageSubtitle"
                        style="margin: 0; color: var(--text-muted); font-size: 0.875rem; display: none;"></p>
                </div>

                <div class="header-actions">
                    <button class="btn-icon" id="refreshBtn" title="Actualizar datos">
                        <i class="ri-refresh-line"></i>
                    </button>
                    <button class="btn-icon" id="themeToggle" title="Cambiar tema">
                        <i class="ri-moon-line"></i>
                    </button>

                    <!-- User Profile -->
                    <div class="header-separator"></div>
                    <div class="user-profile" id="userProfile">
                        <div class="user-avatar" id="userAvatar">U</div>
                        <span class="user-name" id="userName">Usuario</span>
                        <button class="btn-icon" id="logoutBtn" title="Cerrar sesión" onclick="handleLogout()">
                            <i class="ri-logout-box-r-line"></i>
                        </button>
                    </div>
                </div>
            </header>

            <!-- INICIO View - General Dashboard -->
            <div id="inicioView" class="view-section active">
                <div style="padding: 2rem;">
                    <h1 style="margin: 0 0 0.5rem 0; color: var(--text-main); font-size: 2rem;">Bienvenido a EIPC</h1>
                    <p style="color: var(--text-muted); margin: 0 0 2rem 0;">Panel de control general</p>

                    <!-- KPI Overview Grid -->
                    <div class="kpi-grid">
                        <div class="kpi-card">
                            <div class="kpi-icon"
                                style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                                <i class="ri-database-2-line" style="font-size: 2rem;"></i>
                            </div>
                            <div class="kpi-info">
                                <h3>MAESTROS</h3>
                                <p class="kpi-value">Control</p>
                                <span class="kpi-trend">Gestión de datos maestros</span>
                            </div>
                        </div>

                        <div class="kpi-card">
                            <div class="kpi-icon"
                                style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
                                <i class="ri-fire-fill" style="font-size: 2rem;"></i>
                            </div>
                            <div class="kpi-info">
                                <h3>HEATTREAT</h3>
                                <p class="kpi-value">Activo</p>
                                <span class="kpi-trend">Tratamientos térmicos</span>
                            </div>
                        </div>

                        <div class="kpi-card">
                            <div class="kpi-icon"
                                style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">
                                <i class="ri-shield-check-line" style="font-size: 2rem;"></i>
                            </div>
                            <div class="kpi-info">
                                <h3>CALIDAD</h3>
                                <p class="kpi-value">Sistema</p>
                                <span class="kpi-trend">Control de calidad</span>
                            </div>
                        </div>

                        <div class="kpi-card">
                            <div class="kpi-icon"
                                style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);">
                                <i class="ri-git-pull-request-fill" style="font-size: 2rem;"></i>
                            </div>
                            <div class="kpi-info">
                                <h3>PRODUCCION</h3>
                                <p class="kpi-value">En línea</p>
                                <span class="kpi-trend">Control de producción</span>
                            </div>
                        </div>
                    </div>

                    <!-- Quick Access -->
                    <div style="margin-top: 2rem;">
                        <h2 style="margin: 0 0 1rem 0; color: var(--text-main); font-size: 1.5rem;">Accesos Rápidos</h2>
                        <div
                            style="display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 1rem;">
                            <a href="#" data-view="articulos"
                                style="display: flex; align-items: center; gap: 1rem; padding: 1rem; background: var(--bg-card); border-radius: 8px; text-decoration: none; color: var(--text-main); transition: all 0.3s;">
                                <i class="ri-file-list-2-line" style="font-size: 1.5rem; color: var(--primary);"></i>
                                <div>
                                    <div style="font-weight: 600;">Artículos</div>
                                    <div style="font-size: 0.875rem; color: var(--text-muted);">Maestro de artículos
                                    </div>
                                </div>
                            </a>

                            <a href="#" data-view="orders"
                                style="display: flex; align-items: center; gap: 1rem; padding: 1rem; background: var(--bg-card); border-radius: 8px; text-decoration: none; color: var(--text-main); transition: all 0.3s;">
                                <i class="ri-file-list-3-line" style="font-size: 1.5rem; color: var(--primary);"></i>
                                <div>
                                    <div style="font-weight: 600;">Coladas-TT</div>
                                    <div style="font-size: 0.875rem; color: var(--text-muted);">Tratamientos térmicos
                                    </div>
                                </div>
                            </a>

                            <a href="#" data-view="operarios"
                                style="display: flex; align-items: center; gap: 1rem; padding: 1rem; background: var(--bg-card); border-radius: 8px; text-decoration: none; color: var(--text-main); transition: all 0.3s;">
                                <i class="ri-team-line" style="font-size: 1.5rem; color: var(--primary);"></i>
                                <div>
                                    <div style="font-weight: 600;">Operarios</div>
                                    <div style="font-size: 0.875rem; color: var(--text-muted);">Gestión de personal
                                    </div>
                                </div>
                            </a>

                            <a href="#" data-view="rutas"
                                style="display: flex; align-items: center; gap: 1rem; padding: 1rem; background: var(--bg-card); border-radius: 8px; text-decoration: none; color: var(--text-main); transition: all 0.3s;">
                                <i class="ri-route-line" style="font-size: 1.5rem; color: var(--primary);"></i>
                                <div>
                                    <div style="font-weight: 600;">Rutas</div>
                                    <div style="font-size: 0.875rem; color: var(--text-muted);">Rutas de fabricación
                                    </div>
                                </div>
                            </a>
                        </div>
                    </div>
                </div>
            </div>

            <!-- MAESTROS View - Dashboard Maestros -->
            <div id="maestrosView" class="view-section">
                <div style="padding: 2rem;">

                    <div class="kpi-grid" style="grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));">

                        <!-- Articulos -->
                        <div class="kpi-card" onclick="switchView('articulos')"
                            style="cursor: pointer; transition: transform 0.2s, box-shadow 0.2s;">
                            <div class="kpi-icon"
                                style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                                <i class="ri-file-list-2-line" style="font-size: 2rem;"></i>
                            </div>
                            <div class="kpi-info">
                                <h3>ARTICULOS</h3>
                                <p class="kpi-value">Maestros</p>
                                <span class="kpi-trend">Base de datos de artículos</span>
                            </div>
                        </div>

                        <!-- Operarios -->
                        <div class="kpi-card" onclick="switchView('operarios')"
                            style="cursor: pointer; transition: transform 0.2s, box-shadow 0.2s;">
                            <div class="kpi-icon"
                                style="background: linear-gradient(135deg, #fa709a 0%, #fe9488 100%);">
                                <i class="ri-team-line" style="font-size: 2rem;"></i>
                            </div>
                            <div class="kpi-info">
                                <h3>OPERARIOS</h3>
                                <p class="kpi-value">Personal</p>
                                <span class="kpi-trend">Gestión de operarios</span>
                            </div>
                        </div>

                        <!-- Operaciones -->
                        <div class="kpi-card" onclick="switchView('operaciones')"
                            style="cursor: pointer; transition: transform 0.2s, box-shadow 0.2s;">
                            <div class="kpi-icon"
                                style="background: linear-gradient(135deg, #30cfd0 0%, #c43ad6 100%);">
                                <i class="ri-tools-line" style="font-size: 2rem;"></i>
                            </div>
                            <div class="kpi-info">
                                <h3>OPERACIONES</h3>
                                <p class="kpi-value">Procesos</p>
                                <span class="kpi-trend">Catálogo de operaciones</span>
                            </div>
                        </div>

                        <!-- Activos -->
                        <div class="kpi-card" onclick="switchView('activos')"
                            style="cursor: pointer; transition: transform 0.2s, box-shadow 0.2s;">
                            <div class="kpi-icon"
                                style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
                                <i class="ri-device-line" style="font-size: 2rem;"></i>
                            </div>
                            <div class="kpi-info">
                                <h3>ACTIVOS</h3>
                                <p class="kpi-value">Equipos</p>
                                <span class="kpi-trend">Maquinaria y recursos</span>
                            </div>
                        </div>

                        <!-- Centros -->
                        <div class="kpi-card" onclick="switchView('centros')"
                            style="cursor: pointer; transition: transform 0.2s, box-shadow 0.2s;">
                            <div class="kpi-icon"
                                style="background: linear-gradient(135deg, #0dcaf0 0%, #0d6efd 100%);">
                                <i class="ri-building-line" style="font-size: 2rem;"></i>
                            </div>
                            <div class="kpi-info">
                                <h3>CENTROS</h3>
                                <p class="kpi-value">Plantas</p>
                                <span class="kpi-trend">Centros de trabajo</span>
                            </div>
                        </div>

                        <!-- Especificaciones -->
                        <div class="kpi-card" onclick="switchView('especificaciones')"
                            style="cursor: pointer; transition: transform 0.2s, box-shadow 0.2s;">
                            <div class="kpi-icon"
                                style="background: linear-gradient(135deg, #6c757d 0%, #495057 100%);">
                                <i class="ri-file-text-line" style="font-size: 2rem;"></i>
                            </div>
                            <div class="kpi-info">
                                <h3>ESPECIF.</h3>
                                <p class="kpi-value">Docs</p>
                                <span class="kpi-trend">Especificaciones técnicas</span>
                            </div>
                        </div>

                        <!-- Proveedores -->
                        <div class="kpi-card" onclick="switchView('proveedores')"
                            style="cursor: pointer; transition: transform 0.2s, box-shadow 0.2s;">
                            <div class="kpi-icon"
                                style="background: linear-gradient(135deg, #fd7e14 0%, #dc3545 100%);">
                                <i class="ri-truck-line" style="font-size: 2rem;"></i>
                            </div>
                            <div class="kpi-info">
                                <h3>PROVEEDORES</h3>
                                <p class="kpi-value">Jom</p>
                                <span class="kpi-trend">Gestión de proveedores</span>
                            </div>
                        </div>

                        <!-- Clientes -->
                        <div class="kpi-card" onclick="switchView('clientes')"
                            style="cursor: pointer; transition: transform 0.2s, box-shadow 0.2s;">
                            <div class="kpi-icon"
                                style="background: linear-gradient(135deg, #ffc107 0%, #fd7e14 100%);">
                                <i class="ri-user-star-line" style="font-size: 2rem;"></i>
                            </div>
                            <div class="kpi-info">
                                <h3>CLIENTES</h3>
                                <p class="kpi-value">Cartera</p>
                                <span class="kpi-trend">Gestión de clientes</span>
                            </div>
                        </div>

                        <!-- Códigos Rechazo -->
                        <div class="kpi-card" onclick="switchView('codigos-rechazo')"
                            style="cursor: pointer; transition: transform 0.2s, box-shadow 0.2s;">
                            <div class="kpi-icon"
                                style="background: linear-gradient(135deg, #e91e63 0%, #c2185b 100%);">
                                <i class="ri-alert-line" style="font-size: 2rem;"></i>
                            </div>
                            <div class="kpi-info">
                                <h3>COD. RECHAZO</h3>
                                <p class="kpi-value">Defectos</p>
                                <span class="kpi-trend">Catálogo de defectos</span>
                            </div>
                        </div>

                        <!-- Incidencias -->
                        <div class="kpi-card" onclick="switchView('incidencias')"
                            style="cursor: pointer; transition: transform 0.2s, box-shadow 0.2s;">
                            <div class="kpi-icon"
                                style="background: linear-gradient(135deg, #ff5722 0%, #e64a19 100%);">
                                <i class="ri-error-warning-line" style="font-size: 2rem;"></i>
                            </div>
                            <div class="kpi-info">
                                <h3>INCIDENCIAS</h3>
                                <p class="kpi-value">Eventos</p>
                                <span class="kpi-trend">Tipos de incidencias</span>
                            </div>
                        </div>

                        <!-- Utillajes -->
                        <div class="kpi-card" onclick="switchView('utillajes')"
                            style="cursor: pointer; transition: transform 0.2s, box-shadow 0.2s;">
                            <div class="kpi-icon"
                                style="background: linear-gradient(135deg, #607d8b 0%, #455a64 100%);">
                                <i class="ri-tools-fill" style="font-size: 2rem;"></i>
                            </div>
                            <div class="kpi-info">
                                <h3>UTILLAJES</h3>
                                <p class="kpi-value">Moldes</p>
                                <span class="kpi-trend">Gestión de utillajes</span>
                            </div>
                        </div>

                        <!-- Ausencias -->
                        <div class="kpi-card" onclick="switchView('ausencias')"
                            style="cursor: pointer; transition: transform 0.2s, box-shadow 0.2s;">
                            <div class="kpi-icon"
                                style="background: linear-gradient(135deg, #9c27b0 0%, #7b1fa2 100%);">
                                <i class="ri-calendar-close-line" style="font-size: 2rem;"></i>
                            </div>
                            <div class="kpi-info">
                                <h3>AUSENCIAS</h3>
                                <p class="kpi-value">Bajas</p>
                                <span class="kpi-trend">Motivos de ausencia</span>
                            </div>
                        </div>

                        <!-- Materiales -->
                        <div class="kpi-card" onclick="switchView('materiales')"
                            style="cursor: pointer; transition: transform 0.2s, box-shadow 0.2s;">
                            <div class="kpi-icon"
                                style="background: linear-gradient(135deg, #795548 0%, #5d4037 100%);">
                                <i class="ri-box-3-line" style="font-size: 2rem;"></i>
                            </div>
                            <div class="kpi-info">
                                <h3>MATERIALES</h3>
                                <p class="kpi-value">Stock</p>
                                <span class="kpi-trend">Materias primas</span>
                            </div>
                        </div>

                        <!-- Normas -->
                        <div class="kpi-card" onclick="switchView('normas')"
                            style="cursor: pointer; transition: transform 0.2s, box-shadow 0.2s;">
                            <div class="kpi-icon"
                                style="background: linear-gradient(135deg, #20c997 0%, #198754 100%);">
                                <i class="ri-book-2-line" style="font-size: 2rem;"></i>
                            </div>
                            <div class="kpi-info">
                                <h3>NORMAS</h3>
                                <p class="kpi-value">ISO/UNE</p>
                                <span class="kpi-trend">Normativa técnica</span>
                            </div>
                        </div>

                    </div>
                </div>
            </div>

            <div id="equiposView" class="view-section">
                <div style="padding: 2rem;">

                    <!-- KPI Grid -->
                    <div
                        style="display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: 1.5rem; margin-bottom: 2rem;">
                        <!-- KPI Active Equipos -->
                        <div class="kpi-card" style="margin: 0;">
                            <div class="kpi-icon"
                                style="background: linear-gradient(135deg, #10b981 0%, #059669 100%);">
                                <i class="ri-ruler-line" style="font-size: 2rem;"></i>
                            </div>
                            <div class="kpi-info">
                                <h3>EQUIPOS ACTIVOS</h3>
                                <p class="kpi-value" id="kpiActiveEquipos">0</p>
                                <span class="kpi-trend">Equipos en uso</span>
                            </div>
                        </div>

                        <!-- KPI Total Inactive -->
                        <div class="kpi-card" style="margin: 0;">
                            <div class="kpi-icon"
                                style="background: linear-gradient(135deg, #ef4444 0%, #b91c1c 100%);">
                                <i class="ri-delete-bin-line" style="font-size: 2rem;"></i>
                            </div>
                            <div class="kpi-info">
                                <h3>EQUIPOS RETIRADOS</h3>
                                <p class="kpi-value" id="kpiInactiveEquipos">0</p>
                                <span class="kpi-trend">No operativos</span>
                            </div>
                        </div>

                        <!-- KPI Top Empresa -->
                        <div class="kpi-card" style="margin: 0;">
                            <div class="kpi-icon"
                                style="background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);">
                                <i class="ri-building-line" style="font-size: 2rem;"></i>
                            </div>
                            <div class="kpi-info">
                                <h3>EQUIPOS POR EMPRESA</h3>
                                <div id="kpiEmpresaList" style="font-size: 0.85rem; color: var(--text-muted);">
                                    Cargando...
                                </div>
                            </div>
                        </div>

                        <!-- KPI Top Area -->
                        <div class="kpi-card" style="margin: 0;">
                            <div class="kpi-icon"
                                style="background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);">
                                <i class="ri-layout-masonry-line" style="font-size: 2rem;"></i>
                            </div>
                            <div class="kpi-info">
                                <h3>EQUIPOS POR SECCIÓN</h3>
                                <div id="kpiSeccionList" style="font-size: 0.85rem; color: var(--text-muted);">
                                    Cargando...
                                </div>
                            </div>
                        </div>

                        <!-- KPI Top Subarea -->
                        <div class="kpi-card" style="margin: 0;">
                            <div class="kpi-icon"
                                style="background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);">
                                <i class="ri-git-merge-line" style="font-size: 2rem;"></i>
                            </div>
                            <div class="kpi-info">
                                <h3>EQUIPOS POR SUBSECCIÓN</h3>
                                <div id="kpiSubseccionList" style="font-size: 0.85rem; color: var(--text-muted);">
                                    Cargando...
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Expired Calibrations Alert Table (Red) -->
                    <div id="expiredCalibrationsContainer" style="margin-bottom: 2rem; display: none;">
                        <div
                            style="background: rgba(239, 68, 68, 0.05); border: 1px solid var(--danger); border-radius: 12px; padding: 1rem;">

                            <!-- Header with Pagination -->
                            <div
                                style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                                <h3
                                    style="margin: 0; color: var(--danger); display: flex; align-items: center; gap: 0.5rem; font-size: 1.1rem;">
                                    <i class="ri-alarm-warning-fill"></i> Calibraciones Caducadas
                                </h3>

                                <div id="expiredPaginationControls"
                                    style="display: flex; align-items: center; gap: 1rem; font-size: 0.9rem; color: var(--text-muted);">
                                    <span id="expiredCount">0 registros</span>
                                    <div style="display: flex; gap: 0.5rem;">
                                        <button id="expiredPrevBtn"
                                            style="background: var(--bg-card); border: 1px solid var(--border); border-radius: 4px; padding: 0.25rem 0.5rem; cursor: pointer; color: var(--text-main);">
                                            <i class="ri-arrow-left-s-line"></i>
                                        </button>
                                        <span id="expiredPageInfo"
                                            style="display: flex; align-items: center;">1-10</span>
                                        <button id="expiredNextBtn"
                                            style="background: var(--bg-card); border: 1px solid var(--border); border-radius: 4px; padding: 0.25rem 0.5rem; cursor: pointer; color: var(--text-main);">
                                            <i class="ri-arrow-right-s-line"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <div style="overflow-x: auto;">
                                <table
                                    style="width: 100%; border-collapse: collapse; font-size: 0.9rem; table-layout: fixed;">
                                    <thead>
                                        <tr
                                            style="text-align: left; color: var(--text-muted); border-bottom: 1px solid var(--border-light);">
                                            <th class="sortable" data-sort="proxima"
                                                style="padding: 0.75rem 0.5rem; cursor: pointer; width: 15%;">
                                                Fecha <i class="ri-arrow-up-down-line sort-icon"
                                                    style="font-size: 0.8rem;"></i>
                                            </th>
                                            <th class="sortable" data-sort="NOMBRE INSTRUMENTO"
                                                style="padding: 0.75rem 0.5rem; cursor: pointer; width: 35%;">
                                                Instrumento <i class="ri-arrow-up-down-line sort-icon"
                                                    style="font-size: 0.8rem;"></i>
                                            </th>
                                            <th class="sortable" data-sort="Nº REF"
                                                style="padding: 0.75rem 0.5rem; cursor: pointer; width: 15%;">
                                                Nº ID <i class="ri-arrow-up-down-line sort-icon"
                                                    style="font-size: 0.8rem;"></i>
                                            </th>
                                            <th class="sortable" data-sort="EMPRESA"
                                                style="padding: 0.75rem 0.5rem; cursor: pointer; width: 15%;">
                                                Empresa <i class="ri-arrow-up-down-line sort-icon"
                                                    style="font-size: 0.8rem;"></i>
                                            </th>
                                            <th class="sortable" data-sort="Seccion"
                                                style="padding: 0.75rem 0.5rem; cursor: pointer; width: 20%;">
                                                Sección <i class="ri-arrow-up-down-line sort-icon" </th>
                                        </tr>
                                    </thead>
                                    <tbody id="expiredCalibrationsTableBody">
                                        <!-- Populated by JS -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- Upcoming Calibrations Alert Table (Yellow) -->
                    <div id="upcomingCalibrationsContainer" style="margin-bottom: 2rem; display: none;">
                        <div
                            style="background: rgba(245, 158, 11, 0.05); border: 1px solid #f59e0b; border-radius: 12px; padding: 1rem;">

                            <!-- Header with Pagination -->
                            <div
                                style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                                <h3
                                    style="margin: 0; color: #d97706; display: flex; align-items: center; gap: 0.5rem; font-size: 1.1rem;">
                                    <i class="ri-alarm-warning-line"></i> Próximas Calibraciones (&lt; 1 mes)
                                </h3>

                                <div id="proximasPaginationControls"
                                    style="display: flex; align-items: center; gap: 1rem; font-size: 0.9rem; color: var(--text-muted);">
                                    <span id="proximasCount">0 registros</span>
                                    <div style="display: flex; gap: 0.5rem;">
                                        <button id="proximasPrevBtn"
                                            style="background: var(--bg-card); border: 1px solid var(--border); border-radius: 4px; padding: 0.25rem 0.5rem; cursor: pointer; color: var(--text-main);">
                                            <i class="ri-arrow-left-s-line"></i>
                                        </button>
                                        <span id="proximasPageInfo"
                                            style="display: flex; align-items: center;">1-10</span>
                                        <button id="proximasNextBtn"
                                            style="background: var(--bg-card); border: 1px solid var(--border); border-radius: 4px; padding: 0.25rem 0.5rem; cursor: pointer; color: var(--text-main);">
                                            <i class="ri-arrow-right-s-line"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <div style="overflow-x: auto;">
                                <table
                                    style="width: 100%; border-collapse: collapse; font-size: 0.9rem; table-layout: fixed;">
                                    <thead>
                                        <tr
                                            style="text-align: left; color: var(--text-muted); border-bottom: 1px solid var(--border-light);">
                                            <th class="sortable" data-sort="proxima"
                                                style="padding: 0.75rem 0.5rem; cursor: pointer; width: 15%;">
                                                Fecha <i class="ri-arrow-up-down-line sort-icon"
                                                    style="font-size: 0.8rem;"></i>
                                            </th>
                                            <th class="sortable" data-sort="NOMBRE INSTRUMENTO"
                                                style="padding: 0.75rem 0.5rem; cursor: pointer; width: 35%;">
                                                Instrumento <i class="ri-arrow-up-down-line sort-icon"
                                                    style="font-size: 0.8rem;"></i>
                                            </th>
                                            <th class="sortable" data-sort="Nº REF"
                                                style="padding: 0.75rem 0.5rem; cursor: pointer; width: 15%;">
                                                Nº ID <i class="ri-arrow-up-down-line sort-icon"
                                                    style="font-size: 0.8rem;"></i>
                                            </th>
                                            <th class="sortable" data-sort="EMPRESA"
                                                style="padding: 0.75rem 0.5rem; cursor: pointer; width: 15%;">
                                                Empresa <i class="ri-arrow-up-down-line sort-icon"
                                                    style="font-size: 0.8rem;"></i>
                                            </th>
                                            <th class="sortable" data-sort="Seccion"
                                                style="padding: 0.75rem 0.5rem; cursor: pointer; width: 20%;">
                                                Sección <i class="ri-arrow-up-down-line sort-icon" </th>
                                        </tr>
                                    </thead>
                                    <tbody id="upcomingCalibrationsTableBody">
                                        <!-- Populated by JS -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- Filters -->
                    <div class="filters-container"
                        style="display: flex; gap: 1rem; margin-bottom: 2rem; background: var(--bg-card); padding: 1.5rem; border-radius: 12px; box-shadow: var(--shadow-sm); flex-wrap: wrap; align-items: end;">

                        <!-- Filter Inputs -->
                        <div class="filter-group" style="flex: 1; min-width: 150px;">
                            <label class="filter-label">Nº ID</label>
                            <input type="text" id="equiposRefFilter" class="filter-input" placeholder="Buscar ID..."
                                style="width: 100%; padding: 0.5rem; border-radius: 6px; border: 1px solid var(--border); background: var(--bg-card); color: var(--text-main);">
                        </div>
                        <div class="filter-group" style="flex: 1; min-width: 150px;">
                            <label class="filter-label">Empresa</label>
                            <select id="equiposEmpresaFilter" class="filter-select">
                                <option value="">Todas</option>
                            </select>
                        </div>
                        <div class="filter-group" style="flex: 1; min-width: 150px;">
                            <label class="filter-label">Area</label>
                            <select id="equiposAreaFilter" class="filter-select">
                                <option value="">Todas</option>
                            </select>
                        </div>
                        <div class="filter-group" style="flex: 1; min-width: 150px;">
                            <label class="filter-label">Sección</label>
                            <select id="equiposSeccionFilter" class="filter-select">
                                <option value="">Todas</option>
                            </select>
                        </div>
                        <div class="filter-group" style="flex: 1; min-width: 150px;">
                            <label class="filter-label">Subsección</label>
                            <select id="equiposSubseccionFilter" class="filter-select">
                                <option value="">Todas</option>
                            </select>
                        </div>
                        <div class="filter-group" style="flex: 1; min-width: 150px;">
                            <label class="filter-label">Entidad</label>
                            <select id="equiposEntidadFilter" class="filter-select">
                                <option value="">Todas</option>
                            </select>
                        </div>
                        <div class="filter-group" style="flex: 1; min-width: 120px;">
                            <label class="filter-label">Estado</label>
                            <select id="equiposRetiradoFilter" class="filter-select">
                                <option value="">Todos</option>
                                <option value="0" selected>Activos</option>
                                <option value="1">Retirados</option>
                            </select>
                        </div>
                    </div>
                    <!-- Main Equipos Table Section -->
                    <div id="equiposInfo" class="section-header"
                        style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                        <h2 class="section-title" style="margin: 0;">Listado de Equipos</h2>

                        <!-- Main Pagination Controls -->
                        <div id="equiposPaginationControls"
                            style="display: flex; align-items: center; gap: 1rem; font-size: 0.9rem; color: var(--text-muted);">
                            <span id="equiposResultCount">0 registros</span>
                            <div style="display: flex; gap: 0.5rem; align-items: center;">
                                <button id="equiposPrevBtn"
                                    style="background: var(--bg-card); border: 1px solid var(--border); border-radius: 4px; padding: 0.25rem 0.5rem; cursor: pointer; color: var(--text-main);">
                                    <i class="ri-arrow-left-s-line"></i>
                                </button>
                                <span id="equiposPageInfo">1-50</span>
                                <button id="equiposNextBtn"
                                    style="background: var(--bg-card); border: 1px solid var(--border); border-radius: 4px; padding: 0.25rem 0.5rem; cursor: pointer; color: var(--text-main);">
                                    <i class="ri-arrow-right-s-line"></i>
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="table-container"
                        style="overflow-x: auto; background: var(--bg-card); border-radius: 12px; box-shadow: var(--shadow-sm);">
                        <table class="data-table" id="equiposTable"
                            style="width: 100%; border-collapse: collapse; table-layout: fixed;">
                            <thead>
                                <tr>
                                    <th data-sort="Nº REF" class="sortable"
                                        style="width: 10%; padding: 0.75rem 0.5rem; cursor: pointer;">Nº ID <i
                                            class="ri-arrow-up-down-line sort-icon"></i></th>
                                    <th data-sort="NOMBRE INSTRUMENTO" class="sortable"
                                        style="width: 20%; padding: 0.75rem 0.5rem; cursor: pointer;">NOMBRE <i
                                            class="ri-arrow-up-down-line sort-icon"></i></th>
                                    <th data-sort="proxima" class="sortable"
                                        style="width: 10%; padding: 0.75rem 0.5rem; cursor: pointer;">PROX. CALIB <i
                                            class="ri-arrow-up-down-line sort-icon"></i></th>
                                    <th style="width: 5%; padding: 0.75rem 0.5rem;">ESTADO</th>
                                    <th data-sort="EMPRESA" class="sortable"
                                        style="width: 10%; padding: 0.75rem 0.5rem; cursor: pointer;">EMPRESA <i
                                            class="ri-arrow-up-down-line sort-icon"></i></th>
                                    <th data-sort="Seccion" class="sortable"
                                        style="width: 15%; padding: 0.75rem 0.5rem; cursor: pointer;">SECCIÓN <i
                                            class="ri-arrow-up-down-line sort-icon"></i></th>
                                    <th style="width: 15%; padding: 0.75rem 0.5rem;">INT/EXT - ENTIDAD</th>
                                    <th style="width: 10%; padding: 0.75rem 0.5rem;">PERIOD.</th>
                                    <th style="width: 8%; padding: 0.75rem 0.5rem;">Nº EC</th>
                                    <th style="width: 7%; padding: 0.75rem 0.5rem;">PC</th>
                                </tr>
                            </thead>
                            <tbody id="equiposTableBody">
                                <!-- Data populated by JS -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Dashboard View (HeatTreat) -->
            <div id="dashboardView" class="view-section">
                <!-- Year Filter -->
                <div
                    style="margin-bottom: 1.5rem; padding: 1rem; background: var(--bg-card); border-radius: 8px; box-shadow: var(--shadow-sm); display: flex; align-items: center; gap: 1rem;">
                    <label for="dashboardYearFilter" style="font-weight: 600; color: var(--text-main);">Año:</label>
                    <select id="dashboardYearFilter"
                        style="padding: 0.5rem 1rem; border-radius: 6px; border: 1px solid var(--border); background: var(--bg-card); color: var(--text-main); min-width: 120px; cursor: pointer;">
                        <option value="" selected>Todos</option>
                        <option value="2026">2026</option>
                        <option value="2025">2025</option>
                        <option value="2024">2024</option>
                        <option value="2023">2023</option>
                        <option value="2022">2022</option>
                    </select>
                    <span style="color: var(--text-muted); font-size: 0.875rem;">Filtra datos del dashboard por
                        año</span>
                </div>

                <!-- KPI Cards -->
                <div class="kpi-grid">
                    <div class="kpi-card">
                        <div class="kpi-icon t4">T4</div>
                        <div class="kpi-info">
                            <h3>Tratamientos T4</h3>
                            <p class="kpi-value" id="kpiT4Count">0</p>
                            <span class="kpi-trend" id="kpiT4">0 piezas</span>
                        </div>
                    </div>
                    <div class="kpi-card">
                        <div class="kpi-icon t6">T6</div>
                        <div class="kpi-info">
                            <h3>Tratamientos T6</h3>
                            <p class="kpi-value" id="kpiT6Count">0</p>
                            <span class="kpi-trend" id="kpiT6">0 piezas</span>
                        </div>
                    </div>
                    <div class="kpi-card">
                        <div class="kpi-icon warning">
                            <i class="ri-repeat-line"></i>
                        </div>
                        <div class="kpi-info">
                            <h3>Reprocesos</h3>
                            <p class="kpi-value" id="kpiReprocessCount">0</p>
                            <span class="kpi-trend negative" id="kpiReprocess">0% del total</span>
                        </div>
                    </div>
                    <div class="kpi-card">
                        <div class="kpi-icon success">
                            <i class="ri-check-double-line"></i>
                        </div>
                        <div class="kpi-info">
                            <h3>Eficiencia</h3>
                            <p class="kpi-value" id="kpiEfficiency">0%</p>
                            <span class="kpi-trend positive">First Pass Yield</span>
                        </div>
                    </div>
                </div>

                <!-- Charts Row 1 -->
                <div class="charts-row">
                    <div class="chart-card large">
                        <div class="card-header"
                            style="display: flex; justify-content: space-between; align-items: center;">
                            <h3>Tendencia de Tratamientos (Último Año)</h3>
                            <select id="trendChartType" class="chart-control"
                                style="padding: 4px 8px; border-radius: 4px; border: 1px solid var(--border);">
                                <option value="all">Todos</option>
                                <option value="t4">Solo T4</option>
                                <option value="t6">Solo T6</option>
                            </select>
                        </div>
                        <div class="chart-container">
                            <canvas id="productionTrendChart"></canvas>
                        </div>
                    </div>
                    <div class="chart-card small">
                        <div class="card-header">
                            <h3>Distribución de Piezas</h3>
                        </div>
                        <div class="chart-container">
                            <canvas id="distributionChart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Charts Row 2 -->
                <div class="charts-row">
                    <div class="chart-card large">
                        <div class="card-header">
                            <h3>Cantidad de Tratamientos por Tipo</h3>
                        </div>
                        <div class="chart-container">
                            <canvas id="treatmentCountsChart"></canvas>
                        </div>
                    </div>
                    <div class="chart-card small">
                        <div class="card-header">
                            <h3>Secuencias Más Comunes</h3>
                        </div>
                        <div class="chart-container">
                            <canvas id="sequencesChart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Charts Row 3 -->
                <div class="charts-row">
                    <div class="chart-card full-width">
                        <div class="card-header">
                            <h3>Artículos con Reprocesos (Top 10)</h3>
                        </div>
                        <div class="chart-container" style="height: 350px;">
                            <canvas id="reprocessByArticleChart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Treatment Load Table -->
                <div class="table-card" style="margin-top: 2rem;">
                    <div
                        style="padding: 1rem 1.5rem; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 1rem;">
                        <h3 style="margin: 0; font-size: 1.125rem; font-weight: 600;"><i class="ri-fire-line"
                                style="margin-right: 0.5rem; color: var(--primary);"></i>Carga de Tratamientos</h3>
                        <div style="display: flex; align-items: center; gap: 1rem;">
                            <div style="display: flex; align-items: center; gap: 0.5rem;">
                                <label for="treatmentTypeFilter"
                                    style="font-weight: 500; font-size: 0.875rem;">Tipo:</label>
                                <select id="treatmentTypeFilter"
                                    style="padding: 0.4rem 0.75rem; border-radius: 6px; border: 1px solid var(--border); background: var(--bg-body); color: var(--text-main); min-width: 100px;">
                                    <option value="">Todos</option>
                                    <option value="T4">T4</option>
                                    <option value="T6">T6</option>
                                </select>
                            </div>
                            <span id="treatmentLoadCount" style="font-size: 0.875rem; color: var(--text-muted);">0
                                tratamientos</span>
                        </div>
                    </div>
                    <div class="table-wrapper" style="max-height: 400px; overflow-y: auto;">
                        <table id="treatmentLoadTable" style="min-width: 600px;">
                            <thead style="position: sticky; top: 0; background: var(--bg-card); z-index: 1;">
                                <tr>
                                    <th class="sortable-treatment" data-sort="numero"
                                        style="width: 25%; cursor: pointer;">Nº
                                        Tratamiento <i class="ri-arrow-up-down-line"
                                            style="font-size: 0.75rem; opacity: 0.5;"></i>
                                    </th>
                                    <th class="sortable-treatment" data-sort="tipo"
                                        style="width: 20%; cursor: pointer;">Tipo <i class="ri-arrow-up-down-line"
                                            style="font-size: 0.75rem; opacity: 0.5;"></i></th>
                                    <th class="sortable-treatment" data-sort="fecha"
                                        style="width: 15%; cursor: pointer;">Fecha
                                        <i class="ri-arrow-up-down-line" style="font-size: 0.75rem; opacity: 0.5;"></i>
                                    </th>
                                    <th class="sortable-treatment" data-sort="ordenes"
                                        style="width: 20%; cursor: pointer;">
                                        Órdenes <i class="ri-arrow-up-down-line"
                                            style="font-size: 0.75rem; opacity: 0.5;"></i>
                                    </th>
                                    <th class="sortable-treatment" data-sort="piezas"
                                        style="width: 20%; cursor: pointer;">
                                        Piezas <i class="ri-arrow-up-down-line"
                                            style="font-size: 0.75rem; opacity: 0.5;"></i>
                                    </th>
                                </tr>
                            </thead>
                            <tbody id="treatmentLoadTableBody">
                                <tr>
                                    <td colspan="5" style="text-align: center; color: var(--text-muted);">Cargando...
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Orders View -->
            <div id="ordersView" class="view-section">
                <!-- Filter Bar Row 1: Year, Month, Familia, Subfamilia -->
                <div class="filter-bar"
                    style="display: flex; gap: 1rem; margin-bottom: 0.5rem; padding: 1rem; background: var(--bg-card); border-radius: 8px; box-shadow: var(--shadow-sm); flex-wrap: wrap; align-items: center;">
                    <div class="filter-group" style="display: flex; align-items: center; gap: 0.5rem;">
                        <label for="ordersYearFilter" style="font-weight: 500;">Año:</label>
                        <select id="ordersYearFilter"
                            style="padding: 0.5rem 1rem; border-radius: 6px; border: 1px solid var(--border); background: var(--bg-card); color: var(--text-main); min-width: 100px;">
                            <option value="">Todos</option>
                        </select>
                    </div>
                    <div class="filter-group" style="display: flex; align-items: center; gap: 0.5rem;">
                        <label for="ordersMonthFilter" style="font-weight: 500;">Mes:</label>
                        <select id="ordersMonthFilter"
                            style="padding: 0.5rem 1rem; border-radius: 6px; border: 1px solid var(--border); background: var(--bg-card); color: var(--text-main); min-width: 120px;">
                            <option value="">Todos</option>
                            <option value="1">Enero</option>
                            <option value="2">Febrero</option>
                            <option value="3">Marzo</option>
                            <option value="4">Abril</option>
                            <option value="5">Mayo</option>
                            <option value="6">Junio</option>
                            <option value="7">Julio</option>
                            <option value="8">Agosto</option>
                            <option value="9">Septiembre</option>
                            <option value="10">Octubre</option>
                            <option value="11">Noviembre</option>
                            <option value="12">Diciembre</option>
                        </select>
                    </div>
                    <div class="filter-group" style="display: flex; align-items: center; gap: 0.5rem;">
                        <label for="familiaFilter" style="font-weight: 500;">Familia:</label>
                        <select id="familiaFilter"
                            style="padding: 0.5rem 1rem; border-radius: 6px; border: 1px solid var(--border); background: var(--bg-card); color: var(--text-main); min-width: 350px;">
                            <option value="">Todos</option>
                        </select>
                    </div>
                    <div class="filter-group" style="display: flex; align-items: center; gap: 0.5rem;">
                        <label for="subfamiliaFilter" style="font-weight: 500;">Subfamilia:</label>
                        <select id="subfamiliaFilter"
                            style="padding: 0.5rem 1rem; border-radius: 6px; border: 1px solid var(--border); background: var(--bg-card); color: var(--text-main); min-width: 350px;">
                            <option value="">Todos</option>
                        </select>
                    </div>
                </div>

                <!-- Filter Bar Row 2 -->
                <div class="filter-bar"
                    style="display: flex; gap: 1rem; margin-bottom: 1rem; padding: 1rem; background: var(--bg-card); border-radius: 8px; box-shadow: var(--shadow-sm); flex-wrap: wrap; align-items: center;">
                    <div class="filter-group" style="display: flex; align-items: center; gap: 0.5rem;">
                        <label for="ordenFilter" style="font-weight: 500;">Orden:</label>
                        <input type="text" id="ordenFilter" placeholder="Buscar orden..."
                            style="padding: 0.5rem 1rem; border-radius: 6px; border: 1px solid var(--border); background: var(--bg-card); color: var(--text-main); width: 140px;">
                    </div>
                    <div class="filter-group" style="display: flex; align-items: center; gap: 0.5rem;">
                        <label for="articuloFilter" style="font-weight: 500;">Artículo:</label>
                        <select id="articuloFilter"
                            style="padding: 0.5rem 1rem; border-radius: 6px; border: 1px solid var(--border); background: var(--bg-card); color: var(--text-main); min-width: 150px;">
                            <option value="">Todos</option>
                        </select>
                    </div>
                    <div class="filter-group" style="display: flex; align-items: center; gap: 0.5rem;">
                        <label for="reprocessFilter" style="font-weight: 500;">Reproceso:</label>
                        <select id="reprocessFilter"
                            style="padding: 0.5rem 1rem; border-radius: 6px; border: 1px solid var(--border); background: var(--bg-card); color: var(--text-main);">
                            <option value="">Todos</option>
                            <option value="true">Reproceso</option>
                            <option value="false">Sin Reproceso</option>
                        </select>
                    </div>
                    <div class="filter-group" style="display: flex; align-items: center; gap: 0.5rem;">
                        <label for="sequenceFilterSelect" style="font-weight: 500;">Secuencia:</label>
                        <select id="sequenceFilterSelect"
                            style="padding: 0.5rem 1rem; border-radius: 6px; border: 1px solid var(--border); background: var(--bg-card); color: var(--text-main); min-width: 350px;">
                            <option value="">Todos</option>
                        </select>
                    </div>
                </div>

                <!-- Pagination -->
                <div class="pagination-bar"
                    style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; padding: 0.75rem 1rem; background: var(--bg-card); border-radius: 8px; box-shadow: var(--shadow-sm);">
                    <span id="paginationInfo" style="font-size: 0.875rem; color: var(--text-muted);">Mostrando 0 de
                        0</span>
                    <div style="display: flex; gap: 0.5rem;">
                        <button id="prevPageBtn" class="btn-pagination"
                            style="padding: 0.5rem 1rem; border-radius: 6px; border: 1px solid var(--border); background: var(--bg-card); color: var(--text-main); cursor: pointer; display: flex; align-items: center; gap: 0.25rem;">
                            <i class="ri-arrow-left-s-line"></i> Anterior
                        </button>
                        <button id="nextPageBtn" class="btn-pagination"
                            style="padding: 0.5rem 1rem; border-radius: 6px; border: 1px solid var(--border); background: var(--bg-card); color: var(--text-main); cursor: pointer; display: flex; align-items: center; gap: 0.25rem;">
                            Siguiente <i class="ri-arrow-right-s-line"></i>
                        </button>
                    </div>
                </div>

                <div class="table-card">
                    <div class="table-wrapper">
                        <table id="ordersTable">
                            <thead>
                                <tr>
                                    <th data-sort="numero orden" class="sortable">Orden <i
                                            class="ri-arrow-up-down-line sort-icon"></i></th>
                                    <th data-sort="articulo" class="sortable">Artículo <i
                                            class="ri-arrow-up-down-line sort-icon"></i></th>
                                    <th data-sort="Colada" class="sortable">Colada <i
                                            class="ri-arrow-up-down-line sort-icon"></i></th>
                                    <th data-sort="sequence" class="sortable">Secuencia <i
                                            class="ri-arrow-up-down-line sort-icon"></i></th>
                                    <th>T4</th>
                                    <th>T6</th>
                                    <th>T4R1</th>
                                    <th>T6R1</th>
                                    <th>T4R2</th>
                                    <th>T6R2</th>
                                    <th>T4R3</th>
                                    <th>T6R3</th>
                                    <th data-sort="hasReprocess" class="sortable">Estado <i
                                            class="ri-arrow-up-down-line sort-icon"></i></th>
                                </tr>
                            </thead>
                            <tbody id="ordersTableBody"></tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Articulos View -->
            <div id="articulosView" class="view-section">
                <div class="articulos-content" style="padding: 2rem;">

                    <!-- Filter Bar for Articulos -->
                    <div class="filter-bar"
                        style="display: flex; gap: 1rem; margin-bottom: 1rem; padding: 1rem; background: var(--bg-card); border-radius: 8px; box-shadow: var(--shadow-sm); flex-wrap: wrap; align-items: flex-end;">
                        <div class="filter-group" style="display: flex; flex-direction: column; gap: 0.25rem;">
                            <label for="articulosTipoFilter"
                                style="font-weight: 500; font-size: 0.875rem;">Tipo:</label>
                            <select id="articulosTipoFilter"
                                style="padding: 0.5rem 1rem; border-radius: 6px; border: 1px solid var(--border); background: var(--bg-card); color: var(--text-main); min-width: 150px;">
                                <option value="02" selected>02</option>
                            </select>
                        </div>
                        <div class="filter-group" style="display: flex; flex-direction: column; gap: 0.25rem;">
                            <label for="articulosFamiliaFilter"
                                style="font-weight: 500; font-size: 0.875rem;">Familia:</label>
                            <select id="articulosFamiliaFilter"
                                style="padding: 0.5rem 1rem; border-radius: 6px; border: 1px solid var(--border); background: var(--bg-card); color: var(--text-main); min-width: 200px;">
                                <option value="">Todas</option>
                            </select>
                        </div>
                        <div class="filter-group" style="display: flex; flex-direction: column; gap: 0.25rem;">
                            <label for="articulosSubfamiliaFilter"
                                style="font-weight: 500; font-size: 0.875rem;">Subfamilia:</label>
                            <select id="articulosSubfamiliaFilter"
                                style="padding: 0.5rem 1rem; border-radius: 6px; border: 1px solid var(--border); background: var(--bg-card); color: var(--text-main); min-width: 200px;">
                                <option value="">Todas</option>
                            </select>
                        </div>
                        <button id="buscarArticulosBtn" class="btn-primary"
                            style="padding: 0.5rem 1.5rem; border-radius: 6px; border: none; background: var(--primary); color: white; cursor: pointer; font-weight: 500; display: flex; align-items: center; gap: 0.5rem;">
                            <i class="ri-search-line"></i> Buscar
                        </button>
                    </div>

                    <!-- Secondary Filter Row for Cliente and Material (shown when tipo is 02) -->
                    <div id="articulosSecondaryFilters" class="filter-bar"
                        style="display: flex; gap: 1rem; margin-bottom: 1rem; padding: 1rem; background: var(--bg-card); border-radius: 8px; box-shadow: var(--shadow-sm); flex-wrap: wrap; align-items: flex-end;">
                        <div class="filter-group" style="display: flex; flex-direction: column; gap: 0.25rem;">
                            <label for="articulosClienteFilter"
                                style="font-weight: 500; font-size: 0.875rem;">Cliente:</label>
                            <input type="text" id="articulosClienteFilter" list="clientesDatalist"
                                placeholder="Buscar cliente..."
                                style="padding: 0.5rem 1rem; border-radius: 6px; border: 1px solid var(--border); background: var(--bg-card); color: var(--text-main); min-width: 350px;">
                            <datalist id="clientesDatalist"></datalist>
                        </div>
                        <div class="filter-group" style="display: flex; flex-direction: column; gap: 0.25rem;">
                            <label for="articulosMaterialFilter"
                                style="font-weight: 500; font-size: 0.875rem;">Material:</label>
                            <select id="articulosMaterialFilter"
                                style="padding: 0.5rem 1rem; border-radius: 6px; border: 1px solid var(--border); background: var(--bg-card); color: var(--text-main); min-width: 200px;">
                                <option value="">Todos</option>
                            </select>
                        </div>
                    </div>

                    <!-- Info Bar -->
                    <div id="articulosInfo"
                        style="display: none; justify-content: space-between; align-items: center; margin-bottom: 1rem; padding: 0.75rem 1rem; background: rgba(59, 130, 246, 0.05); border-left: 4px solid var(--primary); border-radius: 4px;">
                        <span
                            style="display: flex; align-items: center; gap: 0.5rem; color: var(--text-main); font-weight: 500;">
                            <i class="ri-information-line" style="color: var(--primary);"></i>
                            <span id="articulosResultCount">0 registros encontrados</span>
                        </span>
                    </div>

                    <!-- Pagination -->
                    <div id="articulosPaginationBar" class="pagination-bar"
                        style="display: none; justify-content: space-between; align-items: center; margin-bottom: 1rem; padding: 0.75rem 1rem; background: var(--bg-card); border-radius: 8px; box-shadow: var(--shadow-sm);">
                        <span id="articulosPaginationInfo"
                            style="font-size: 0.875rem; color: var(--text-muted);">Mostrando 0 de
                            0</span>
                        <div style="display: flex; gap: 0.5rem;">
                            <button id="articulosPrevPageBtn" class="btn-pagination"
                                style="padding: 0.5rem 1rem; border-radius: 6px; border: 1px solid var(--border); background: var(--bg-card); color: var(--text-main); cursor: pointer; display: flex; align-items: center; gap: 0.25rem;">
                                <i class="ri-arrow-left-s-line"></i> Anterior
                            </button>
                            <button id="articulosNextPageBtn" class="btn-pagination"
                                style="padding: 0.5rem 1rem; border-radius: 6px; border: 1px solid var(--border); background: var(--bg-card); color: var(--text-main); cursor: pointer; display: flex; align-items: center; gap: 0.25rem;">
                                Siguiente <i class="ri-arrow-right-s-line"></i>
                            </button>
                        </div>
                    </div>
                    <!-- Table -->
                    <div class="table-card">
                        <div class="table-wrapper">
                            <table id="articulosTable" style="table-layout: fixed; width: 100%;">
                                <thead>
                                    <tr>
                                        <th style="width: 140px; cursor: pointer;" data-sort="codigo"
                                            class="sortable-articulos">Código <i class="ri-arrow-up-down-line"></i></th>
                                        <th style="width: 350px; cursor: pointer;" data-sort="denominacion"
                                            class="sortable-articulos">Denominación <i
                                                class="ri-arrow-up-down-line"></i></th>
                                        <th style="width: 250px; cursor: pointer;" data-sort="familia"
                                            class="sortable-articulos">Familia <i class="ri-arrow-up-down-line"></i>
                                        </th>
                                        <th style="width: 250px; cursor: pointer;" data-sort="subfamilia"
                                            class="sortable-articulos">Subfamilia <i class="ri-arrow-up-down-line"></i>
                                        </th>
                                        <th style="width: 200px; cursor: pointer;" data-sort="material"
                                            class="sortable-articulos">Material <i class="ri-arrow-up-down-line"></i>
                                        </th>
                                    </tr>
                                </thead>
                                <tbody id="articulosTableBody">
                                    <tr>
                                        <td colspan="5"
                                            style="text-align: center; padding: 2rem; color: var(--text-muted);">
                                            <i class="ri-file-list-2-line"
                                                style="font-size: 2rem; display: block; margin-bottom: 0.5rem;"></i>
                                            Pulsa Buscar para cargar los artículos
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Articulo Detail Modal -->
            <div id="articuloModal" class="modal-overlay"
                style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 1000; align-items: center; justify-content: center;">
                <div class="modal-content"
                    style="background: var(--bg-card); border-radius: 12px; box-shadow: var(--shadow-lg); max-width: 700px; width: 90%; max-height: 90vh; overflow: auto; position: relative;">
                    <button id="closeArticuloModal"
                        style="position: absolute; top: 1rem; right: 1rem; background: none; border: none; font-size: 1.5rem; cursor: pointer; color: white; z-index: 10;">
                        <i class="ri-close-line"></i>
                    </button>
                    <div
                        style="background: linear-gradient(135deg, var(--primary) 0%, #6366f1 100%); padding: 1.5rem 2rem; color: white;">
                        <h3 id="modalArticuloCodigo" style="margin: 0; font-size: 1.5rem; font-weight: 600;">-</h3>
                        <p id="modalArticuloDenominacion" style="margin: 0.5rem 0 0 0; opacity: 0.9; font-size: 1rem;">-
                        </p>
                    </div>
                    <div style="padding: 2rem;">
                        <div
                            style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1.5rem;">
                            <div class="info-item" style="display: flex; flex-direction: column; gap: 0.25rem;">
                                <span
                                    style="font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.05em; color: var(--text-muted); font-weight: 500;">Clase</span>
                                <span id="modalArticuloClase"
                                    style="font-size: 1.125rem; font-weight: 500; color: var(--text-main);">-</span>
                            </div>
                            <div class="info-item" style="display: flex; flex-direction: column; gap: 0.25rem;">
                                <span
                                    style="font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.05em; color: var(--text-muted); font-weight: 500;">Grado</span>
                                <span id="modalArticuloGrado"
                                    style="font-size: 1.125rem; font-weight: 500; color: var(--text-main);">-</span>
                            </div>
                            <div class="info-item" style="display: flex; flex-direction: column; gap: 0.25rem;">
                                <span
                                    style="font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.05em; color: var(--text-muted); font-weight: 500;">Zona
                                    Designada</span>
                                <span id="modalArticuloZona"
                                    style="font-size: 1.125rem; font-weight: 500; color: var(--text-main);">-</span>
                            </div>
                            <div class="info-item" style="display: flex; flex-direction: column; gap: 0.25rem;">
                                <span
                                    style="font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.05em; color: var(--text-muted); font-weight: 500;">Norma</span>
                                <span id="modalArticuloNorma"
                                    style="font-size: 1.125rem; font-weight: 500; color: var(--text-main);">-</span>
                            </div>
                            <div class="info-item" style="display: flex; flex-direction: column; gap: 0.25rem;">
                                <span
                                    style="font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.05em; color: var(--text-muted); font-weight: 500;">Material</span>
                                <span id="modalArticuloMaterial"
                                    style="font-size: 1.125rem; font-weight: 500; color: var(--text-main);">-</span>
                            </div>
                            <div class="info-item" style="display: flex; flex-direction: column; gap: 0.25rem;">
                                <span
                                    style="font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.05em; color: var(--text-muted); font-weight: 500;">Especificación</span>
                                <span id="modalArticuloEspecificacion"
                                    style="font-size: 1.125rem; font-weight: 500; color: var(--text-main);">-</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>


            <!-- Rutas View -->
            <div id="rutasView" class="view-section">
                <div class="rutas-content" style="padding: 2rem;">

                    <div class="filter-bar"
                        style="display: flex; gap: 0.75rem; margin-bottom: 1rem; padding: 1rem; background: var(--bg-card); border-radius: 8px; box-shadow: var(--shadow-sm); flex-wrap: nowrap; align-items: flex-end;">
                        <div class="filter-group" style="display: flex; flex-direction: column; gap: 0.25rem;">
                            <label for="rutasArticuloFilter"
                                style="font-weight: 500; font-size: 0.875rem;">Artículo:</label>
                            <input type="text" id="rutasArticuloFilter" placeholder="Código..."
                                style="padding: 0.5rem 0.75rem; border-radius: 6px; border: 1px solid var(--border); background: var(--bg-card); color: var(--text-main); width: 130px;">
                        </div>
                        <div class="filter-group" style="display: flex; flex-direction: column; gap: 0.25rem;">
                            <label for="rutasOperacionFilter"
                                style="font-weight: 500; font-size: 0.875rem;">Operación:</label>
                            <select id="rutasOperacionFilter"
                                style="padding: 0.5rem 0.75rem; border-radius: 6px; border: 1px solid var(--border); background: var(--bg-card); color: var(--text-main); width: 160px;">
                                <option value="">Todas</option>
                            </select>
                        </div>

                        <div class="filter-group" style="display: flex; flex-direction: column; gap: 0.25rem;">
                            <label for="rutasRutaFilter" style="font-weight: 500; font-size: 0.875rem;">Ruta:</label>
                            <input type="text" id="rutasRutaFilter" placeholder="Ej: PR" value="PR"
                                style="padding: 0.5rem 0.75rem; border-radius: 6px; border: 1px solid var(--border); background: var(--bg-card); color: var(--text-main); width: 70px;">
                        </div>
                        <div class="filter-group" style="display: flex; flex-direction: column; gap: 0.25rem;">
                            <label for="rutasFaseFilter" style="font-weight: 500; font-size: 0.875rem;">Fase:</label>
                            <select id="rutasFaseFilter"
                                style="padding: 0.5rem 0.75rem; border-radius: 6px; border: 1px solid var(--border); background: var(--bg-card); color: var(--text-main); width: 100px;">
                                <option value="">Todas</option>
                            </select>
                        </div>
                        <div class="filter-group" style="display: flex; flex-direction: column; gap: 0.25rem;">
                            <label for="rutasFamiliaFilter"
                                style="font-weight: 500; font-size: 0.875rem;">Familia:</label>
                            <select id="rutasFamiliaFilter"
                                style="padding: 0.5rem 0.75rem; border-radius: 6px; border: 1px solid var(--border); background: var(--bg-card); color: var(--text-main); width: 160px;">
                                <option value="">Todas</option>
                            </select>
                        </div>
                        <div class="filter-group" style="display: flex; flex-direction: column; gap: 0.25rem;">
                            <label for="rutasClasificacionFilter"
                                style="font-weight: 500; font-size: 0.875rem;">Clasif.:</label>
                            <select id="rutasClasificacionFilter"
                                style="padding: 0.5rem 0.75rem; border-radius: 6px; border: 1px solid var(--border); background: var(--bg-card); color: var(--text-main); width: 130px;">
                                <option value="">Todas</option>
                            </select>
                        </div>
                        <button id="buscarRutasBtn" class="btn-primary"
                            style="padding: 0.5rem 1rem; border-radius: 6px; border: none; background: var(--primary); color: white; cursor: pointer; font-weight: 500;">
                            <i class="ri-search-line"></i> Buscar
                        </button>
                    </div>

                    <div id="rutasSecondaryFilters" class="filter-bar"
                        style="display: none; gap: 1rem; margin-bottom: 1rem; padding: 1rem; background: var(--bg-card); border-radius: 8px; box-shadow: var(--shadow-sm); flex-wrap: wrap; align-items: flex-end;">
                        <div class="filter-group" style="display: flex; flex-direction: column; gap: 0.25rem;">
                            <label for="rutasTipoFilter" style="font-weight: 500; font-size: 0.875rem;">Tipo:</label>
                            <select id="rutasTipoFilter"
                                style="padding: 0.5rem 1rem; border-radius: 6px; border: 1px solid var(--border); background: var(--bg-card); color: var(--text-main); min-width: 120px;">
                                <option value="">Todos</option>
                            </select>
                        </div>
                        <div class="filter-group" style="display: flex; flex-direction: column; gap: 0.25rem;">
                            <label for="rutasControlFilter" style="font-weight: 500; font-size: 0.875rem;">Control
                                Prod.:</label>
                            <select id="rutasControlFilter"
                                style="padding: 0.5rem 1rem; border-radius: 6px; border: 1px solid var(--border); background: var(--bg-card); color: var(--text-main); min-width: 100px;">
                                <option value="">Todos</option>
                                <option value="true">Sí</option>
                                <option value="false">No</option>
                            </select>
                        </div>
                    </div>


                    <!-- Info Bar -->
                    <div id="rutasInfo"
                        style="display: none; justify-content: space-between; align-items: center; margin-bottom: 1rem; padding: 0.75rem 1rem; background: rgba(59, 130, 246, 0.05); border-left: 4px solid var(--primary); border-radius: 4px;">
                        <span
                            style="display: flex; align-items: center; gap: 0.5rem; color: var(--text-main); font-weight: 500;">
                            <i class="ri-information-line" style="color: var(--primary);"></i>
                            <span id="rutasResultCount">0 registros encontrados</span>
                        </span>
                        <span id="rutasTiempoTotalInfo"
                            style="display: none; font-size: 0.875rem; font-weight: 600; color: var(--success);">
                            Tiempo Total: <span id="rutasTiempoTotal">0</span>
                        </span>
                    </div>

                    <!-- Pagination -->
                    <div id="rutasPaginationBar" class="pagination-bar"
                        style="display: none; justify-content: space-between; align-items: center; margin-bottom: 1rem; padding: 0.75rem 1rem; background: var(--bg-card); border-radius: 8px; box-shadow: var(--shadow-sm);">
                        <span id="rutasPaginationInfo" style="font-size: 0.875rem; color: var(--text-muted);">Mostrando
                            0 de 0</span>
                        <div style="display: flex; gap: 0.5rem;">
                            <button id="rutasPrevPageBtn" class="btn-pagination"
                                style="padding: 0.5rem 1rem; border-radius: 6px; border: 1px solid var(--border); background: var(--bg-card); color: var(--text-main); cursor: pointer; display: flex; align-items: center; gap: 0.25rem;">
                                <i class="ri-arrow-left-s-line"></i> Anterior
                            </button>
                            <button id="rutasNextPageBtn" class="btn-pagination"
                                style="padding: 0.5rem 1rem; border-radius: 6px; border: 1px solid var(--border); background: var(--bg-card); color: var(--text-main); cursor: pointer; display: flex; align-items: center; gap: 0.25rem;">
                                Siguiente <i class="ri-arrow-right-s-line"></i>
                            </button>
                        </div>
                    </div>

                    <!-- Layout with table and TOP 10 side by side -->
                    <div style="display: flex; gap: 1rem; width: 100%; flex-wrap: wrap;">
                        <!-- Main Content - tabla ocupa el espacio restante -->
                        <div style="flex: 1 1 600px; min-width: 0;">
                            <div class="table-card">
                                <div class="table-wrapper" style="overflow-x: auto;">
                                    <table id="rutasTable" style="width: 100%; min-width: 700px;">
                                        <thead>
                                            <tr>
                                                <th style="width: 11%; min-width: 70px; cursor: pointer;"
                                                    data-sort="articulo" class="sortable-rutas">Artículo <i
                                                        class="ri-arrow-up-down-line"></i>
                                                </th>
                                                <th style="width: 5%; min-width: 40px; cursor: pointer; text-align: center;"
                                                    data-sort="secuencia" class="sortable-rutas">Sec <i
                                                        class="ri-arrow-up-down-line"></i>
                                                </th>
                                                <th style="width: 22%; min-width: 120px; cursor: pointer;"
                                                    data-sort="codigo" class="sortable-rutas">Operación <i
                                                        class="ri-arrow-up-down-line"></i>
                                                </th>
                                                <th style="width: 8%; min-width: 50px; cursor: pointer;"
                                                    data-sort="fase" class="sortable-rutas">Fase <i
                                                        class="ri-arrow-up-down-line"></i>
                                                </th>
                                                <th style="width: 5%; min-width: 40px; cursor: pointer; text-align: center;"
                                                    data-sort="tipo" class="sortable-rutas">
                                                    Tipo <i class="ri-arrow-up-down-line"></i></th>
                                                <th style="width: 22%; min-width: 100px; cursor: pointer;"
                                                    data-sort="centro" class="sortable-rutas">Centro <i
                                                        class="ri-arrow-up-down-line"></i>
                                                </th>
                                                <th style="width: 10%; min-width: 60px; cursor: pointer; text-align: right;"
                                                    data-sort="tiempo" class="sortable-rutas">Tiempo <i
                                                        class="ri-arrow-up-down-line"></i>
                                                </th>
                                                <th style="width: 17%; min-width: 90px; cursor: pointer; text-align: center;"
                                                    data-sort="control" class="sortable-rutas">Control Prod. <i
                                                        class="ri-arrow-up-down-line"></i>
                                                </th>
                                            </tr>
                                        </thead>
                                        <tbody id="rutasTableBody">
                                            <tr>
                                                <td colspan="8"
                                                    style="text-align: center; padding: 2rem; color: var(--text-muted);">
                                                    <i class="ri-search-line"
                                                        style="font-size: 2rem; display: block; margin-bottom: 0.5rem;"></i>
                                                    Introduce un código de artículo y pulsa Buscar
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>

                        <!-- TOP 10 Sidebar - contenedor con dos tablas -->
                        <div
                            style="flex: 0 0 280px; max-width: 320px; display: flex; flex-direction: column; gap: 1rem;">
                            <!-- TOP 10 Mayor Tiempo -->
                            <div class="table-card" style="height: fit-content; overflow: hidden;">
                                <div style="padding: 0.5rem 0.75rem; border-bottom: 1px solid var(--border);">
                                    <h3 style="margin: 0; font-size: 0.8rem; color: var(--text-main);">
                                        <i class="ri-timer-line" style="color: var(--warning);"></i> TOP 10 Mayor Tiempo
                                    </h3>
                                </div>
                                <div id="rutasTop10Body" style="padding: 0.25rem;">
                                    <div style="text-align: center; padding: 1rem; color: var(--text-muted);">
                                        Cargando...
                                    </div>
                                </div>
                            </div>

                            <!-- TOP 10 Mayor Nº de Operaciones -->
                            <div class="table-card" style="height: fit-content; overflow: hidden;">
                                <div style="padding: 0.5rem 0.75rem; border-bottom: 1px solid var(--border);">
                                    <h3 style="margin: 0; font-size: 0.8rem; color: var(--text-main);">
                                        <i class="ri-list-ordered" style="color: var(--primary);"></i> TOP 10 Más
                                        Operaciones
                                    </h3>
                                </div>
                                <div id="rutasTop10OperacionesBody" style="padding: 0.25rem;">
                                    <div style="text-align: center; padding: 1rem; color: var(--text-muted);">
                                        Cargando...
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Operarios View -->
            <!-- Operarios View -->
            <div id="operariosView" class="view-section">
                <div class="operarios-content" style="padding: 2rem;">

                    <div class="filter-bar"
                        style="display: flex; gap: 1rem; margin-bottom: 1rem; padding: 1rem; background: var(--bg-card); border-radius: 8px; box-shadow: var(--shadow-sm); flex-wrap: wrap; align-items: flex-end;">
                        <div class="filter-group" style="display: flex; flex-direction: column; gap: 0.25rem;">
                            <label for="operariosSeccionFilter"
                                style="font-weight: 500; font-size: 0.875rem;">Sección:</label>
                            <select id="operariosSeccionFilter"
                                style="padding: 0.5rem 1rem; border-radius: 6px; border: 1px solid var(--border); background: var(--bg-card); color: var(--text-main); min-width: 250px;">
                                <option value="">Todas</option>
                            </select>
                        </div>
                        <div class="filter-group" style="display: flex; flex-direction: column; gap: 0.25rem;">
                            <label for="operariosActivoFilter"
                                style="font-weight: 500; font-size: 0.875rem;">Activo:</label>
                            <select id="operariosActivoFilter"
                                style="padding: 0.5rem 1rem; border-radius: 6px; border: 1px solid var(--border); background: var(--bg-card); color: var(--text-main); min-width: 100px;">
                                <option value="">Todos</option>
                                <option value="true" selected>Sí</option>
                                <option value="false">No</option>
                            </select>
                        </div>
                        <div class="filter-group" style="display: flex; flex-direction: column; gap: 0.25rem;">
                            <label for="operariosACalculoFilter" style="font-weight: 500; font-size: 0.875rem;">A
                                Cálculo:</label>
                            <select id="operariosACalculoFilter"
                                style="padding: 0.5rem 1rem; border-radius: 6px; border: 1px solid var(--border); background: var(--bg-card); color: var(--text-main); min-width: 100px;">
                                <option value="">Todos</option>
                                <option value="true">Sí</option>
                                <option value="false">No</option>
                            </select>
                        </div>
                        <button id="buscarOperariosBtn" class="btn-primary"
                            style="padding: 0.5rem 1.5rem; border-radius: 6px; border: none; background: var(--primary); color: white; cursor: pointer; font-weight: 500;">
                            <i class="ri-search-line"></i> Buscar
                        </button>
                    </div>

                    <!-- Info Bar -->
                    <div id="operariosInfo"
                        style="display: none; justify-content: space-between; align-items: center; margin-bottom: 1rem; padding: 0.75rem 1rem; background: rgba(59, 130, 246, 0.05); border-left: 4px solid var(--primary); border-radius: 4px;">
                        <span
                            style="display: flex; align-items: center; gap: 0.5rem; color: var(--text-main); font-weight: 500;">
                            <i class="ri-information-line" style="color: var(--primary);"></i>
                            <span id="operariosResultCount">0 registros encontrados</span>
                        </span>
                    </div>

                    <!-- Pagination Bar -->
                    <div id="operariosPaginationBar" class="pagination-bar"
                        style="display: none; justify-content: space-between; align-items: center; margin-bottom: 1rem; padding: 0.75rem 1rem; background: var(--bg-card); border-radius: 8px; box-shadow: var(--shadow-sm);">
                        <span id="operariosPaginationInfo"
                            style="font-size: 0.875rem; color: var(--text-muted);">Mostrando
                            0 de 0</span>
                        <div style="display: flex; gap: 0.5rem;">
                            <button id="operariosPrevPageBtn" class="btn-pagination"
                                style="padding: 0.5rem 1rem; border-radius: 6px; border: 1px solid var(--border); background: var(--bg-card); color: var(--text-main); cursor: pointer; display: flex; align-items: center; gap: 0.25rem;">
                                <i class="ri-arrow-left-s-line"></i> Anterior
                            </button>
                            <button id="operariosNextPageBtn" class="btn-pagination"
                                style="padding: 0.5rem 1rem; border-radius: 6px; border: 1px solid var(--border); background: var(--bg-card); color: var(--text-main); cursor: pointer; display: flex; align-items: center; gap: 0.25rem;">
                                Siguiente <i class="ri-arrow-right-s-line"></i>
                            </button>
                        </div>
                    </div>

                    <div class="table-card">
                        <div class="table-wrapper">
                            <table id="operariosTable" style="table-layout: fixed; width: 100%;">
                                <thead>
                                    <tr>
                                        <th style="width: 100px; cursor: pointer;" data-sort="operario"
                                            class="sortable-operarios">Operario <i class="ri-arrow-up-down-line"></i>
                                        </th>
                                        <th style="width: 250px; cursor: pointer;" data-sort="nombre"
                                            class="sortable-operarios">Nombre <i class="ri-arrow-up-down-line"></i></th>
                                        <th style="width: 120px; cursor: pointer;" data-sort="fechaAlta"
                                            class="sortable-operarios">Fecha Alta <i class="ri-arrow-up-down-line"></i>
                                        </th>
                                        <th style="width: 80px; cursor: pointer;" data-sort="activo"
                                            class="sortable-operarios">
                                            Activo <i class="ri-arrow-up-down-line"></i></th>
                                        <th style="width: 100px; cursor: pointer;" data-sort="aCalculo"
                                            class="sortable-operarios">A Cálculo <i class="ri-arrow-up-down-line"></i>
                                        </th>
                                    </tr>
                                </thead>
                                <tbody id="operariosTableBody">
                                    <tr>
                                        <td colspan="3"
                                            style="text-align: center; padding: 2rem; color: var(--text-muted);">
                                            <i class="ri-team-line"
                                                style="font-size: 2rem; display: block; margin-bottom: 0.5rem;"></i>
                                            Selecciona los filtros y pulsa Buscar
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Operaciones View -->
            <div id="operacionesView" class="view-section">
                <div class="operaciones-content" style="padding: 2rem;">

                    <div class="filter-bar"
                        style="display: flex; gap: 1rem; margin-bottom: 1rem; padding: 1rem; background: var(--bg-card); border-radius: 8px; box-shadow: var(--shadow-sm); flex-wrap: wrap; align-items: flex-end;">
                        <div class="filter-group" style="display: flex; flex-direction: column; gap: 0.25rem;">
                            <label for="operacionesCodigoFilter"
                                style="font-weight: 500; font-size: 0.875rem;">Operación:</label>
                            <select id="operacionesCodigoFilter"
                                style="padding: 0.5rem 1rem; border-radius: 6px; border: 1px solid var(--border); background: var(--bg-card); color: var(--text-main); min-width: 350px;">
                                <option value="">Todas</option>
                            </select>
                        </div>
                        <div class="filter-group" style="display: flex; flex-direction: column; gap: 0.25rem;">
                            <label for="operacionesSeccionFilter"
                                style="font-weight: 500; font-size: 0.875rem;">Sección:</label>
                            <select id="operacionesSeccionFilter"
                                style="padding: 0.5rem 1rem; border-radius: 6px; border: 1px solid var(--border); background: var(--bg-card); color: var(--text-main); min-width: 250px;">
                                <option value="">Todas</option>
                            </select>
                        </div>
                        <div class="filter-group" style="display: flex; flex-direction: column; gap: 0.25rem;">
                            <label for="operacionesActivoFilter"
                                style="font-weight: 500; font-size: 0.875rem;">Activo:</label>
                            <select id="operacionesActivoFilter"
                                style="padding: 0.5rem 1rem; border-radius: 6px; border: 1px solid var(--border); background: var(--bg-card); color: var(--text-main); min-width: 100px;">
                                <option value="">Todos</option>
                                <option value="1">SÍ</option>
                                <option value="0">No</option>
                            </select>
                        </div>
                        <div class="filter-group" style="display: flex; flex-direction: column; gap: 0.25rem;">
                            <label for="operacionesComputoFilter" style="font-weight: 500; font-size: 0.875rem;">Computo
                                OEE:</label>
                            <select id="operacionesComputoFilter"
                                style="padding: 0.5rem 1rem; border-radius: 6px; border: 1px solid var(--border); background: var(--bg-card); color: var(--text-main); min-width: 120px;">
                                <option value="">Todos</option>
                                <option value="1">SÍ</option>
                                <option value="0">No</option>
                            </select>
                        </div>
                        <button id="buscarOperacionesBtn" class="btn-primary"
                            style="padding: 0.5rem 1.5rem; border-radius: 6px; border: none; background: var(--primary); color: white; cursor: pointer; font-weight: 500;">
                            <i class="ri-search-line"></i> Buscar
                        </button>
                    </div>

                    <!-- Info Bar -->
                    <div id="operacionesInfo"
                        style="display: none; justify-content: space-between; align-items: center; margin-bottom: 1rem; padding: 0.75rem 1rem; background: rgba(59, 130, 246, 0.05); border-left: 4px solid var(--primary); border-radius: 4px;">
                        <span
                            style="display: flex; align-items: center; gap: 0.5rem; color: var(--text-main); font-weight: 500;">
                            <i class="ri-information-line" style="color: var(--primary);"></i>
                            <span id="operacionesResultCount">0 registros encontrados</span>
                        </span>
                    </div>

                    <!-- Pagination Bar -->
                    <div id="operacionesPaginationBar" class="pagination-bar"
                        style="display: none; justify-content: space-between; align-items: center; margin-bottom: 1rem; padding: 0.75rem 1rem; background: var(--bg-card); border-radius: 8px; box-shadow: var(--shadow-sm);">
                        <span id="operacionesPaginationInfo"
                            style="font-size: 0.875rem; color: var(--text-muted);">Mostrando
                            0 de 0</span>
                        <div style="display: flex; gap: 0.5rem;">
                            <button id="operacionesPrevPageBtn" class="btn-pagination"
                                style="padding: 0.5rem 1rem; border-radius: 6px; border: 1px solid var(--border); background: var(--bg-card); color: var(--text-main); cursor: pointer; display: flex; align-items: center; gap: 0.25rem;">
                                <i class="ri-arrow-left-s-line"></i> Anterior
                            </button>
                            <button id="operacionesNextPageBtn" class="btn-pagination"
                                style="padding: 0.5rem 1rem; border-radius: 6px; border: 1px solid var(--border); background: var(--bg-card); color: var(--text-main); cursor: pointer; display: flex; align-items: center; gap: 0.25rem;">
                                Siguiente <i class="ri-arrow-right-s-line"></i>
                            </button>
                        </div>
                    </div>

                    <div class="table-card">
                        <div class="table-wrapper">
                            <table id="operacionesTable" style="table-layout: fixed; width: 100%;">
                                <thead>
                                    <tr>
                                        <th style="width: 80px; cursor: pointer;" data-sort="codigo"
                                            class="sortable-op">Código
                                            <i class="ri-arrow-up-down-line"></i>
                                        </th>
                                        <th style="width: auto; cursor: pointer;" data-sort="descripcion"
                                            class="sortable-op">
                                            Descripción <i class="ri-arrow-up-down-line"></i></th>
                                        <th style="width: 80px; cursor: pointer;" data-sort="seccion"
                                            class="sortable-op">
                                            Sección <i class="ri-arrow-up-down-line"></i>
                                        </th>
                                        <th style="width: 70px; cursor: pointer; text-align: center;" data-sort="rutas"
                                            class="sortable-op">En Rutas
                                            <i class="ri-arrow-up-down-line"></i>
                                        </th>
                                        <th style="width: 70px; cursor: pointer;" data-sort="activo"
                                            class="sortable-op">Activo
                                            <i class="ri-arrow-up-down-line"></i>
                                        </th>
                                        <th style="width: 120px; cursor: pointer;" data-sort="grupo"
                                            class="sortable-op">Grupo
                                            <i class="ri-arrow-up-down-line"></i>
                                        </th>
                                        <th style="width: 80px; cursor: pointer;" data-sort="plazo" class="sortable-op">
                                            Plazo <i class="ri-arrow-up-down-line"></i>
                                        </th>
                                        <th style="width: 90px; cursor: pointer;" data-sort="computo"
                                            class="sortable-op">
                                            Computo OEE <i class="ri-arrow-up-down-line"></i>
                                        </th>
                                    </tr>
                                </thead>
                                <tbody id="operacionesTableBody">
                                    <tr>
                                        <td colspan="8"
                                            style="text-align: center; padding: 2rem; color: var(--text-muted);">
                                            <i class="ri-tools-line"
                                                style="font-size: 2rem; display: block; margin-bottom: 0.5rem;"></i>
                                            Selecciona una operación o sección y pulsa Buscar
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Códigos Rechazo View -->
            <div id="codigos-rechazoView" class="view-section">
                <div class="codigos-rechazo-content" style="padding: 2rem;">

                    <div class="filter-bar"
                        style="display: flex; gap: 1rem; margin-bottom: 1rem; padding: 1rem; background: var(--bg-card); border-radius: 8px; box-shadow: var(--shadow-sm); flex-wrap: wrap; align-items: flex-end;">
                        <div class="filter-group" style="display: flex; flex-direction: column; gap: 0.25rem;">
                            <label for="codigosRechazoCodigoFilter"
                                style="font-weight: 500; font-size: 0.875rem;">Código /
                                Descripción:</label>
                            <input type="text" id="codigosRechazoCodigoFilter" placeholder="Buscar..."
                                style="padding: 0.5rem 1rem; border-radius: 6px; border: 1px solid var(--border); background: var(--bg-card); color: var(--text-main); min-width: 250px;">
                        </div>
                        <div class="filter-group" style="display: flex; flex-direction: column; gap: 0.25rem;">
                            <label for="codigosRechazoSeccionFilter"
                                style="font-weight: 500; font-size: 0.875rem;">Sección:</label>
                            <select id="codigosRechazoSeccionFilter"
                                style="padding: 0.5rem 1rem; border-radius: 6px; border: 1px solid var(--border); background: var(--bg-card); color: var(--text-main); min-width: 200px;">
                                <option value="">Todas</option>
                            </select>
                        </div>
                        <div class="filter-group" style="display: flex; flex-direction: column; gap: 0.25rem;">
                            <label for="codigosRechazoControlFilter"
                                style="font-weight: 500; font-size: 0.875rem;">Control
                                Producción:</label>
                            <select id="codigosRechazoControlFilter"
                                style="padding: 0.5rem 1rem; border-radius: 6px; border: 1px solid var(--border); background: var(--bg-card); color: var(--text-main); min-width: 150px;">
                                <option value="">Todos</option>
                                <option value="true">Sí</option>
                                <option value="false">No</option>
                            </select>
                        </div>
                        <button id="buscarCodigosRechazoBtn" class="btn-primary"
                            style="padding: 0.5rem 1.5rem; border-radius: 6px; border: none; background: var(--primary); color: white; cursor: pointer; font-weight: 500;">
                            <i class="ri-search-line"></i> Buscar
                        </button>
                    </div>

                    <!-- Info Bar -->
                    <div id="codigosRechazoInfo"
                        style="display: none; justify-content: space-between; align-items: center; margin-bottom: 1rem; padding: 0.75rem 1rem; background: rgba(59, 130, 246, 0.05); border-left: 4px solid var(--primary); border-radius: 4px;">
                        <span
                            style="display: flex; align-items: center; gap: 0.5rem; color: var(--text-main); font-weight: 500;">
                            <i class="ri-information-line" style="color: var(--primary);"></i>
                            <span id="codigosRechazoResultCount">0 registros encontrados</span>
                        </span>
                    </div>

                    <!-- Pagination Bar -->
                    <div id="codigosRechazoPaginationBar" class="pagination-bar"
                        style="display: none; justify-content: space-between; align-items: center; margin-bottom: 1rem; padding: 0.75rem 1rem; background: var(--bg-card); border-radius: 8px; box-shadow: var(--shadow-sm);">
                        <span id="codigosRechazoPaginationInfo"
                            style="font-size: 0.875rem; color: var(--text-muted);">Mostrando
                            0 de 0</span>
                        <div style="display: flex; gap: 0.5rem;">
                            <button id="codigosRechazoPrevPageBtn" class="btn-pagination"
                                style="padding: 0.5rem 1rem; border-radius: 6px; border: 1px solid var(--border); background: var(--bg-card); color: var(--text-main); cursor: pointer; display: flex; align-items: center; gap: 0.25rem;">
                                <i class="ri-arrow-left-s-line"></i> Anterior
                            </button>
                            <button id="codigosRechazoNextPageBtn" class="btn-pagination"
                                style="padding: 0.5rem 1rem; border-radius: 6px; border: 1px solid var(--border); background: var(--bg-card); color: var(--text-main); cursor: pointer; display: flex; align-items: center; gap: 0.25rem;">
                                Siguiente <i class="ri-arrow-right-s-line"></i>
                            </button>
                        </div>
                    </div>

                    <div class="table-card">
                        <div class="table-wrapper">
                            <table id="codigosRechazoTable" style="table-layout: fixed; width: 100%;">
                                <thead>
                                    <tr>
                                        <th style="width: 150px; cursor: pointer;" data-sort="codigo"
                                            class="sortable-cr">Código
                                            <i class="ri-arrow-up-down-line"></i>
                                        </th>
                                        <th style="width: 300px; cursor: pointer;" data-sort="descripcion"
                                            class="sortable-cr">
                                            Descripción <i class="ri-arrow-up-down-line"></i></th>
                                        <th style="width: 200px; cursor: pointer;" data-sort="seccion"
                                            class="sortable-cr">
                                            Sección <i class="ri-arrow-up-down-line"></i></th>
                                        <th style="width: 150px; cursor: pointer;" data-sort="control"
                                            class="sortable-cr">
                                            Control Prod. <i class="ri-arrow-up-down-line"></i></th>
                                    </tr>
                                </thead>
                                <tbody id="codigosRechazoTableBody">
                                    <tr>
                                        <td colspan="4"
                                            style="text-align: center; padding: 2rem; color: var(--text-muted);">
                                            <i class="ri-alert-line"
                                                style="font-size: 2rem; display: block; margin-bottom: 0.5rem;"></i>
                                            Selecciona filtros y pulsa Buscar
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Incidencias View -->
            <div id="incidenciasView" class="view-section">
                <div class="incidencias-content" style="padding: 2rem;">

                    <div class="filter-bar"
                        style="display: flex; gap: 1rem; margin-bottom: 1rem; padding: 1rem; background: var(--bg-card); border-radius: 8px; box-shadow: var(--shadow-sm); flex-wrap: wrap; align-items: flex-end;">
                        <div class="filter-group" style="display: flex; flex-direction: column; gap: 0.25rem;">
                            <label for="incidenciasSeccionFilter"
                                style="font-weight: 500; font-size: 0.875rem;">Sección:</label>
                            <select id="incidenciasSeccionFilter"
                                style="padding: 0.5rem 1rem; border-radius: 6px; border: 1px solid var(--border); background: var(--bg-card); color: var(--text-main); min-width: 200px;">
                                <option value="">Todas</option>
                            </select>
                        </div>
                        <div class="filter-group" style="display: flex; flex-direction: column; gap: 0.25rem;">
                            <label for="incidenciasActividadFilter"
                                style="font-weight: 500; font-size: 0.875rem;">Actividad
                                Asignada:</label>
                            <select id="incidenciasActividadFilter"
                                style="padding: 0.5rem 1rem; border-radius: 6px; border: 1px solid var(--border); background: var(--bg-card); color: var(--text-main); min-width: 200px;">
                                <option value="">Todas</option>
                            </select>
                        </div>
                        <div class="filter-group" style="display: flex; flex-direction: column; gap: 0.25rem;">
                            <label for="incidenciasActivoFilter"
                                style="font-weight: 500; font-size: 0.875rem;">Activo:</label>
                            <select id="incidenciasActivoFilter"
                                style="padding: 0.5rem 1rem; border-radius: 6px; border: 1px solid var(--border); background: var(--bg-card); color: var(--text-main); min-width: 120px;">
                                <option value="">Todos</option>
                                <option value="1">Sí</option>
                                <option value="0">No</option>
                            </select>
                        </div>
                        <div class="filter-group" style="display: flex; flex-direction: column; gap: 0.25rem;">
                            <label for="incidenciasTipoVinculacionFilter"
                                style="font-weight: 500; font-size: 0.875rem;">Tipo
                                Vinculación:</label>
                            <select id="incidenciasTipoVinculacionFilter"
                                style="padding: 0.5rem 1rem; border-radius: 6px; border: 1px solid var(--border); background: var(--bg-card); color: var(--text-main); min-width: 150px;">
                                <option value="">Todos</option>
                            </select>
                        </div>
                        <button id="buscarIncidenciasBtn" class="btn-primary"
                            style="padding: 0.5rem 1.5rem; border-radius: 6px; border: none; background: var(--primary); color: white; cursor: pointer; font-weight: 500;">
                            <i class="ri-search-line"></i> Buscar
                        </button>
                    </div>

                    <!-- Info Bar -->
                    <div id="incidenciasInfo"
                        style="display: none; justify-content: space-between; align-items: center; margin-bottom: 1rem; padding: 0.75rem 1rem; background: rgba(59, 130, 246, 0.05); border-left: 4px solid var(--primary); border-radius: 4px;">
                        <span
                            style="display: flex; align-items: center; gap: 0.5rem; color: var(--text-main); font-weight: 500;">
                            <i class="ri-information-line" style="color: var(--primary);"></i>
                            <span id="incidenciasResultCount">0 registros encontrados</span>
                        </span>
                    </div>

                    <!-- Pagination Bar -->
                    <div id="incidenciasPaginationBar" class="pagination-bar"
                        style="display: none; justify-content: space-between; align-items: center; margin-bottom: 1rem; padding: 0.75rem 1rem; background: var(--bg-card); border-radius: 8px; box-shadow: var(--shadow-sm);">
                        <span id="incidenciasPaginationInfo"
                            style="font-size: 0.875rem; color: var(--text-muted);">Mostrando 0
                            de
                            0</span>
                        <div style="display: flex; gap: 0.5rem;">
                            <button id="incidenciasPrevPageBtn" class="btn-pagination"
                                style="padding: 0.5rem 1rem; border-radius: 6px; border: 1px solid var(--border); background: var(--bg-card); color: var(--text-main); cursor: pointer; display: flex; align-items: center; gap: 0.25rem;">
                                <i class="ri-arrow-left-s-line"></i> Anterior
                            </button>
                            <button id="incidenciasNextPageBtn" class="btn-pagination"
                                style="padding: 0.5rem 1rem; border-radius: 6px; border: 1px solid var(--border); background: var(--bg-card); color: var(--text-main); cursor: pointer; display: flex; align-items: center; gap: 0.25rem;">
                                Siguiente <i class="ri-arrow-right-s-line"></i>
                            </button>
                        </div>
                    </div>

                    <div class="table-card">
                        <div class="table-wrapper" style="overflow-x: auto;">
                            <table id="incidenciasTable" style="table-layout: fixed; width: 100%; min-width: 1000px;">
                                <thead>
                                    <tr>
                                        <th style="width: 100px;">Código</th>
                                        <th style="width: 250px;">Descripción</th>
                                        <th style="width: 100px; text-align: center;">Remunerada</th>
                                        <th style="width: 80px; text-align: center;">A Prima</th>
                                        <th style="width: 150px;">Actividad Asignada</th>
                                        <th style="width: 150px;">Sección</th>
                                        <th style="width: 80px; text-align: center;">Activo</th>
                                        <th style="width: 120px;">Tipo Vinculación</th>
                                    </tr>
                                </thead>
                                <tbody id="incidenciasTableBody">
                                    <tr>
                                        <td colspan="8"
                                            style="text-align: center; padding: 2rem; color: var(--text-muted);">
                                            <i class="ri-alert-line"
                                                style="font-size: 2rem; display: block; margin-bottom: 0.5rem;"></i>
                                            Selecciona filtros y pulsa Buscar
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Ausencias View -->
            <div id="ausenciasView" class="view-section">
                <div class="ausencias-content" style="padding: 2rem;">

                    <div class="filter-bar"
                        style="display: flex; gap: 1rem; margin-bottom: 1rem; padding: 1rem; background: var(--bg-card); border-radius: 8px; box-shadow: var(--shadow-sm); flex-wrap: wrap; align-items: flex-end;">
                        <div class="filter-group" style="display: flex; flex-direction: column; gap: 0.25rem;">
                            <label for="ausenciasCodigoFilter"
                                style="font-weight: 500; font-size: 0.875rem;">Código:</label>
                            <input type="text" id="ausenciasCodigoFilter" placeholder="Buscar código..."
                                style="padding: 0.5rem 1rem; border-radius: 6px; border: 1px solid var(--border); background: var(--bg-card); color: var(--text-main); min-width: 150px;">
                        </div>
                        <div class="filter-group" style="display: flex; flex-direction: column; gap: 0.25rem;">
                            <label for="ausenciasDenominacionFilter"
                                style="font-weight: 500; font-size: 0.875rem;">Denominación:</label>
                            <input type="text" id="ausenciasDenominacionFilter" placeholder="Buscar denominación..."
                                style="padding: 0.5rem 1rem; border-radius: 6px; border: 1px solid var(--border); background: var(--bg-card); color: var(--text-main); min-width: 250px;">
                        </div>
                        <div class="filter-group" style="display: flex; flex-direction: column; gap: 0.25rem;">
                            <label for="ausenciasAbsentismoFilter"
                                style="font-weight: 500; font-size: 0.875rem;">Absentismo:</label>
                            <select id="ausenciasAbsentismoFilter"
                                style="padding: 0.5rem 1rem; border-radius: 6px; border: 1px solid var(--border); background: var(--bg-card); color: var(--text-main); min-width: 120px;">
                                <option value="">Todos</option>
                                <option value="-1">Sí</option>
                                <option value="0">No</option>
                            </select>
                        </div>
                        <button id="buscarAusenciasBtn" class="btn-primary"
                            style="padding: 0.5rem 1.5rem; border-radius: 6px; border: none; background: var(--primary); color: white; cursor: pointer; font-weight: 500;">
                            <i class="ri-search-line"></i> Buscar
                        </button>
                    </div>

                    <!-- Info Bar -->
                    <div id="ausenciasInfo"
                        style="display: none; justify-content: space-between; align-items: center; margin-bottom: 1rem; padding: 0.75rem 1rem; background: rgba(59, 130, 246, 0.05); border-left: 4px solid var(--primary); border-radius: 4px;">
                        <span
                            style="display: flex; align-items: center; gap: 0.5rem; color: var(--text-main); font-weight: 500;">
                            <i class="ri-information-line" style="color: var(--primary);"></i>
                            <span id="ausenciasResultCount">0 registros encontrados</span>
                        </span>
                    </div>

                    <div class="table-card">
                        <div class="table-wrapper" style="overflow-x: auto;">
                            <table id="ausenciasTable" style="table-layout: fixed; width: 100%; min-width: 600px;">
                                <thead>
                                    <tr>
                                        <th style="width: 120px;">Código</th>
                                        <th style="width: 350px;">Denominación</th>
                                        <th style="width: 100px; text-align: center;">Absentismo</th>
                                    </tr>
                                </thead>
                                <tbody id="ausenciasTableBody">
                                    <tr>
                                        <td colspan="3"
                                            style="text-align: center; padding: 2rem; color: var(--text-muted);">
                                            <i class="ri-alert-line"
                                                style="font-size: 2rem; display: block; margin-bottom: 0.5rem;"></i>
                                            Selecciona filtros y pulsa Buscar
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Materiales View -->
            <div id="materialesView" class="view-section">
                <!-- Filter Bar -->
                <div class="filter-bar"
                    style="display: flex; gap: 1rem; margin-bottom: 1rem; padding: 1rem; background: var(--bg-card); border-radius: 8px; box-shadow: var(--shadow-sm); flex-wrap: wrap; align-items: center;">

                    <div class="filter-group" style="display: flex; align-items: center; gap: 0.5rem;">
                        <label for="materialesCodigoFilter" style="font-weight: 500;">Código/Descripción:</label>
                        <input type="text" id="materialesCodigoFilter" placeholder="Buscar material..."
                            style="padding: 0.5rem 1rem; border-radius: 6px; border: 1px solid var(--border); background: var(--bg-card); color: var(--text-main); min-width: 200px;">
                    </div>

                    <button id="buscarMaterialesBtn" class="btn-primary"
                        style="padding: 0.5rem 1.5rem; border-radius: 6px; border: none; background: var(--primary); color: white; cursor: pointer; font-weight: 500;">
                        <i class="ri-search-line"></i> Buscar
                    </button>
                </div>

                <!-- Info Bar -->
                <div id="materialesInfo"
                    style="display: none; justify-content: space-between; align-items: center; margin-bottom: 1rem; padding: 0.75rem 1rem; background: rgba(59, 130, 246, 0.05); border-left: 4px solid var(--primary); border-radius: 4px;">
                    <span
                        style="display: flex; align-items: center; gap: 0.5rem; color: var(--text-main); font-weight: 500;">
                        <i class="ri-information-line" style="color: var(--primary);"></i>
                        <span id="materialesResultCount">0 registros encontrados</span>
                    </span>
                </div>

                <!-- Pagination Bar -->
                <div id="materialesPaginationBar" class="pagination-bar"
                    style="display: none; justify-content: space-between; align-items: center; margin-bottom: 1rem; padding: 0.75rem 1rem; background: var(--bg-card); border-radius: 8px; box-shadow: var(--shadow-sm);">
                    <span id="materialesPaginationInfo" style="font-size: 0.875rem; color: var(--text-muted);">Mostrando
                        0 de 0</span>
                    <div style="display: flex; gap: 0.5rem;">
                        <button id="materialesPrevPageBtn" class="btn-pagination"
                            style="padding: 0.5rem 1rem; border-radius: 6px; border: 1px solid var(--border); background: var(--bg-card); color: var(--text-main); cursor: pointer; display: flex; align-items: center; gap: 0.25rem;">
                            <i class="ri-arrow-left-s-line"></i> Anterior
                        </button>
                        <button id="materialesNextPageBtn" class="btn-pagination"
                            style="padding: 0.5rem 1rem; border-radius: 6px; border: 1px solid var(--border); background: var(--bg-card); color: var(--text-main); cursor: pointer; display: flex; align-items: center; gap: 0.25rem;">
                            Siguiente <i class="ri-arrow-right-s-line"></i>
                        </button>
                    </div>
                </div>

                <div class="table-card">
                    <div class="table-wrapper">
                        <table id="materialesTable">
                            <thead>
                                <tr>
                                    <th>Código</th>
                                    <th>Descripción</th>
                                </tr>
                            </thead>
                            <tbody id="materialesTableBody">
                                <!-- Data will be populated here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Utillajes View -->
            <div id="utillajesView" class="view-section">
                <!-- Filter Bar -->
                <div class="filter-bar"
                    style="display: flex; gap: 1rem; margin-bottom: 1rem; padding: 1rem; background: var(--bg-card); border-radius: 8px; box-shadow: var(--shadow-sm); flex-wrap: wrap; align-items: flex-end;">

                    <div class="filter-group" style="display: flex; flex-direction: column; gap: 0.25rem;">
                        <label for="utillajesCodigoFilter"
                            style="font-weight: 500; font-size: 0.875rem;">Código:</label>
                        <input type="text" id="utillajesCodigoFilter" placeholder="Buscar código..."
                            style="padding: 0.5rem 1rem; border-radius: 6px; border: 1px solid var(--border); background: var(--bg-card); color: var(--text-main); min-width: 150px;">
                    </div>

                    <div class="filter-group" style="display: flex; flex-direction: column; gap: 0.25rem;">
                        <label for="utillajesTipoFilter" style="font-weight: 500; font-size: 0.875rem;">Tipo:</label>
                        <select id="utillajesTipoFilter"
                            style="padding: 0.5rem 1rem; border-radius: 6px; border: 1px solid var(--border); background: var(--bg-card); color: var(--text-main); min-width: 150px;">
                            <option value="">Todos</option>
                        </select>
                    </div>

                    <div class="filter-group" style="display: flex; flex-direction: column; gap: 0.25rem;">
                        <label for="utillajesFamiliaFilter"
                            style="font-weight: 500; font-size: 0.875rem;">Familia:</label>
                        <select id="utillajesFamiliaFilter"
                            style="padding: 0.5rem 1rem; border-radius: 6px; border: 1px solid var(--border); background: var(--bg-card); color: var(--text-main); min-width: 150px;">
                            <option value="">Todas</option>
                        </select>
                    </div>

                    <div class="filter-group" style="display: flex; flex-direction: column; gap: 0.25rem;">
                        <label for="utillajesSituacionFilter"
                            style="font-weight: 500; font-size: 0.875rem;">Situación:</label>
                        <select id="utillajesSituacionFilter"
                            style="padding: 0.5rem 1rem; border-radius: 6px; border: 1px solid var(--border); background: var(--bg-card); color: var(--text-main); min-width: 150px;">
                            <option value="">Todas</option>
                        </select>
                    </div>

                    <div class="filter-group" style="display: flex; flex-direction: column; gap: 0.25rem;">
                        <label for="utillajesActivoFilter"
                            style="font-weight: 500; font-size: 0.875rem;">Activo:</label>
                        <select id="utillajesActivoFilter"
                            style="padding: 0.5rem 1rem; border-radius: 6px; border: 1px solid var(--border); background: var(--bg-card); color: var(--text-main); min-width: 120px;">
                            <option value="">Todos</option>
                            <option value="-1" selected>Sí</option>
                            <option value="0">No</option>
                        </select>
                    </div>

                    <button id="utillajesSearchBtn" class="btn-primary"
                        style="padding: 0.5rem 1.5rem; border-radius: 6px; border: none; background: var(--primary); color: white; cursor: pointer; font-weight: 500;">
                        <i class="ri-search-line"></i> Buscar
                    </button>
                </div>

                <!-- Info Bar -->
                <div id="utillajesInfo"
                    style="display: none; justify-content: space-between; align-items: center; margin-bottom: 1rem; padding: 0.75rem 1rem; background: rgba(59, 130, 246, 0.05); border-left: 4px solid var(--primary); border-radius: 4px;">
                    <span
                        style="display: flex; align-items: center; gap: 0.5rem; color: var(--text-main); font-weight: 500;">
                        <i class="ri-information-line" style="color: var(--primary);"></i>
                        <span id="utillajesResultCount">0 registros encontrados</span>
                    </span>
                </div>

                <!-- Pagination Bar -->
                <div id="utillajesPaginationBar" class="pagination-bar"
                    style="display: none; justify-content: space-between; align-items: center; margin-bottom: 1rem; padding: 0.75rem 1rem; background: var(--bg-card); border-radius: 8px; box-shadow: var(--shadow-sm);">
                    <span id="utillajesPaginationInfo" style="font-size: 0.875rem; color: var(--text-muted);">Mostrando
                        0 de
                        0</span>
                    <div style="display: flex; gap: 0.5rem;">
                        <button id="utillajesPrevPageBtn" class="btn-pagination"
                            style="padding: 0.5rem 1rem; border-radius: 6px; border: 1px solid var(--border); background: var(--bg-card); color: var(--text-main); cursor: pointer; display: flex; align-items: center; gap: 0.25rem;">
                            <i class="ri-arrow-left-s-line"></i> Anterior
                        </button>
                        <button id="utillajesNextPageBtn" class="btn-pagination"
                            style="padding: 0.5rem 1rem; border-radius: 6px; border: 1px solid var(--border); background: var(--bg-card); color: var(--text-main); cursor: pointer; display: flex; align-items: center; gap: 0.25rem;">
                            Siguiente <i class="ri-arrow-right-s-line"></i>
                        </button>
                    </div>
                </div>

                <div class="table-card">
                    <div class="table-wrapper">
                        <table id="utillajesTable">
                            <thead>
                                <tr>
                                    <th data-sort="codigo utillaje" class="sortable">Código <i
                                            class="ri-arrow-up-down-line sort-icon"></i></th>
                                    <th data-sort="tipo utillaje" class="sortable">Tipo <i
                                            class="ri-arrow-up-down-line sort-icon"></i></th>
                                    <th data-sort="familia" class="sortable">Familia <i
                                            class="ri-arrow-up-down-line sort-icon"></i></th>
                                    <th data-sort="situacion" class="sortable">Situación <i
                                            class="ri-arrow-up-down-line sort-icon"></i></th>
                                    <th data-sort="activo" class="sortable">Activo <i
                                            class="ri-arrow-up-down-line sort-icon"></i></th>
                                    <th data-sort="estanteria" class="sortable">Estantería <i
                                            class="ri-arrow-up-down-line sort-icon"></i></th>
                                </tr>
                            </thead>
                            <tbody id="utillajesTableBody">
                                <!-- Data will be populated here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            <!-- Secciones View -->
            <div id="seccionesView" class="view-section">
                <div class="secciones-content" style="padding: 2rem;">

                    <div class="filter-bar"
                        style="display: flex; gap: 1rem; margin-bottom: 1rem; padding: 1rem; background: var(--bg-card); border-radius: 8px; box-shadow: var(--shadow-sm); flex-wrap: wrap; align-items: flex-end;">
                        <div class="filter-group" style="display: flex; flex-direction: column; gap: 0.25rem;">
                            <label for="seccionesCodigoFilter"
                                style="font-weight: 500; font-size: 0.875rem;">Sección:</label>
                            <input type="text" id="seccionesCodigoFilter" placeholder="Buscar código..."
                                style="padding: 0.5rem 1rem; border-radius: 6px; border: 1px solid var(--border); background: var(--bg-card); color: var(--text-main); min-width: 150px;">
                        </div>
                        <div class="filter-group" style="display: flex; flex-direction: column; gap: 0.25rem;">
                            <label for="seccionesDenominacionFilter"
                                style="font-weight: 500; font-size: 0.875rem;">Denominación:</label>
                            <input type="text" id="seccionesDenominacionFilter" placeholder="Buscar denominación..."
                                style="padding: 0.5rem 1rem; border-radius: 6px; border: 1px solid var(--border); background: var(--bg-card); color: var(--text-main); min-width: 250px;">
                        </div>
                        <button id="buscarSeccionesBtn" class="btn-primary"
                            style="padding: 0.5rem 1.5rem; border-radius: 6px; border: none; background: var(--primary); color: white; cursor: pointer; font-weight: 500;">
                            <i class="ri-search-line"></i> Buscar
                        </button>
                    </div>

                    <!-- Info Bar -->
                    <div id="seccionesInfo"
                        style="display: none; justify-content: space-between; align-items: center; margin-bottom: 1rem; padding: 0.75rem 1rem; background: rgba(59, 130, 246, 0.05); border-left: 4px solid var(--primary); border-radius: 4px;">
                        <span
                            style="display: flex; align-items: center; gap: 0.5rem; color: var(--text-main); font-weight: 500;">
                            <i class="ri-information-line" style="color: var(--primary);"></i>
                            <span id="seccionesResultCount">0 registros encontrados</span>
                        </span>
                    </div>

                    <div class="table-card">
                        <div class="table-wrapper" style="overflow-x: auto;">
                            <table id="seccionesTable" style="table-layout: fixed; width: 100%; min-width: 500px;">
                                <thead>
                                    <tr>
                                        <th style="width: 120px;">Sección</th>
                                        <th style="width: 400px;">Denominación</th>
                                    </tr>
                                </thead>
                                <tbody id="seccionesTableBody">
                                    <tr>
                                        <td colspan="2"
                                            style="text-align: center; padding: 2rem; color: var(--text-muted);">
                                            <i class="ri-alert-line"
                                                style="font-size: 2rem; display: block; margin-bottom: 0.5rem;"></i>
                                            Selecciona filtros y pulsa Buscar
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Estructuras View -->
            <div id="estructurasView" class="view-section">
                <div class="estructuras-content" style="padding: 2rem;">

                    <div class="filter-bar"
                        style="display: flex; gap: 1rem; margin-bottom: 1rem; padding: 1rem; background: var(--bg-card); border-radius: 8px; box-shadow: var(--shadow-sm); flex-wrap: wrap; align-items: flex-end;">
                        <div class="filter-group" style="display: flex; flex-direction: column; gap: 0.25rem;">
                            <label for="estructurasArticuloFilter"
                                style="font-weight: 500; font-size: 0.875rem;">Artículo:</label>
                            <input type="text" id="estructurasArticuloFilter" placeholder="Código de artículo..."
                                style="padding: 0.5rem 1rem; border-radius: 6px; border: 1px solid var(--border); background: var(--bg-card); color: var(--text-main); min-width: 150px;">
                        </div>
                        <div class="filter-group" style="display: flex; flex-direction: column; gap: 0.25rem;">
                            <label for="estructurasComponenteFilter"
                                style="font-weight: 500; font-size: 0.875rem;">Componente:</label>
                            <select id="estructurasComponenteFilter"
                                style="padding: 0.5rem 1rem; border-radius: 6px; border: 1px solid var(--border); background: var(--bg-card); color: var(--text-main); min-width: 200px;">
                                <option value="">Todos</option>
                            </select>
                        </div>
                        <div class="filter-group" style="display: flex; flex-direction: column; gap: 0.25rem;">
                            <label for="estructurasOperacionFilter"
                                style="font-weight: 500; font-size: 0.875rem;">Operación:</label>
                            <select id="estructurasOperacionFilter"
                                style="padding: 0.5rem 1rem; border-radius: 6px; border: 1px solid var(--border); background: var(--bg-card); color: var(--text-main); min-width: 200px;">
                                <option value="">Todas</option>
                            </select>
                        </div>
                        <button id="buscarEstructurasBtn" class="btn-primary"
                            style="padding: 0.5rem 1.5rem; border-radius: 6px; border: none; background: var(--primary); color: white; cursor: pointer; font-weight: 500;">
                            <i class="ri-search-line"></i> Buscar
                        </button>
                    </div>

                    <!-- Info Bar -->
                    <div id="estructurasInfo"
                        style="display: none; justify-content: space-between; align-items: center; margin-bottom: 1rem; padding: 0.75rem 1rem; background: rgba(59, 130, 246, 0.05); border-left: 4px solid var(--primary); border-radius: 4px;">
                        <span
                            style="display: flex; align-items: center; gap: 0.5rem; color: var(--text-main); font-weight: 500;">
                            <i class="ri-information-line" style="color: var(--primary);"></i>
                            <span id="estructurasResultCount">0 registros encontrados</span>
                        </span>
                        <span id="estructurasCosteTotalInfo"
                            style="display: none; font-size: 0.875rem; font-weight: 600; color: var(--success);">
                            Coste Total: <span id="estructurasCosteTotal">0,00 €</span>
                        </span>
                    </div>

                    <!-- Layout with table and TOP 10 side by side -->
                    <div style="display: grid; grid-template-columns: 1fr 280px; gap: 1rem;">
                        <!-- Main Table -->
                        <div class="table-card">
                            <div class="table-wrapper" style="overflow-x: auto;">
                                <table id="estructurasTable"
                                    style="table-layout: fixed; width: 100%; min-width: 900px;">
                                    <thead>
                                        <tr>
                                            <th style="width: 50px;">ID</th>
                                            <th style="width: 100px;">Cód. Artículo</th>
                                            <th style="width: 200px;">Componente</th>
                                            <th style="width: 180px;">Operación</th>
                                            <th style="width: 70px; text-align: center;">Op. Inv.</th>
                                            <th style="width: 90px; text-align: right;">Cantidad</th>
                                            <th style="width: 100px; text-align: right;">Precio Últ.</th>
                                            <th style="width: 110px; text-align: right;">Coste</th>
                                        </tr>
                                    </thead>
                                    <tbody id="estructurasTableBody">
                                        <tr>
                                            <td colspan="8"
                                                style="text-align: center; padding: 2rem; color: var(--text-muted);">
                                                <i class="ri-alert-line"
                                                    style="font-size: 2rem; display: block; margin-bottom: 0.5rem;"></i>
                                                Introduce un artículo o componente y pulsa Buscar
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                            <!-- Pagination Bar -->
                            <div id="estructurasPaginationBar"
                                style="display: none; justify-content: space-between; align-items: center; padding: 1rem; border-top: 1px solid var(--border); background: var(--bg-body);">
                                <span id="estructurasPaginationInfo"
                                    style="font-size: 0.875rem; color: var(--text-muted);">Mostrando 0-0 de 0</span>
                                <div style="display: flex; gap: 0.5rem;">
                                    <button id="estructurasPrevBtn"
                                        style="padding: 0.5rem 1rem; border-radius: 6px; border: 1px solid var(--border); background: var(--bg-card); color: var(--text-main); cursor: pointer;"
                                        disabled>
                                        <i class="ri-arrow-left-s-line"></i> Anterior
                                    </button>
                                    <button id="estructurasNextBtn"
                                        style="padding: 0.5rem 1rem; border-radius: 6px; border: 1px solid var(--border); background: var(--bg-card); color: var(--text-main); cursor: pointer;">
                                        Siguiente <i class="ri-arrow-right-s-line"></i>
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- TOP 10 Sidebar -->
                        <div class="table-card" style="height: fit-content; overflow: hidden;">
                            <div style="padding: 0.5rem 0.75rem; border-bottom: 1px solid var(--border);">
                                <h3 style="margin: 0; font-size: 0.85rem; color: var(--text-main);">
                                    <i class="ri-trophy-line" style="color: var(--warning);"></i> TOP 10 Mayor Coste
                                </h3>
                            </div>
                            <div id="estructurasTop10Body" style="padding: 0.25rem;">
                                <div style="text-align: center; padding: 1rem; color: var(--text-muted);">Cargando...
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Modal para imagen de artículo -->
                    <div id="articuloImagenModal"
                        style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 9999; justify-content: center; align-items: center;">
                        <div
                            style="background: var(--bg-card); border-radius: 12px; padding: 1rem; max-width: 90%; max-height: 90%; position: relative; box-shadow: 0 20px 60px rgba(0,0,0,0.3);">
                            <button onclick="cerrarModalImagen()"
                                style="position: absolute; top: 0.5rem; right: 0.5rem; background: var(--bg-body); border: none; width: 32px; height: 32px; border-radius: 50%; cursor: pointer; color: var(--text-main); font-size: 1.2rem;">
                                <i class="ri-close-line"></i>
                            </button>
                            <div id="articuloImagenHeader"
                                style="margin-bottom: 0.5rem; padding-bottom: 0.5rem; border-bottom: 1px solid var(--border);">
                                <h3 style="margin: 0; color: var(--text-main); font-size: 1rem;"
                                    id="articuloImagenTitulo">
                                    Artículo</h3>
                            </div>
                            <div id="articuloImagenContent"
                                style="text-align: center; min-width: 300px; min-height: 200px;">
                                <div class="spinner" style="margin: 3rem auto;"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div id="proveedoresView" class="view-section">
                <div class="proveedores-content" style="padding: 2rem;">

                    <div class="filter-bar"
                        style="display: flex; gap: 1rem; margin-bottom: 1rem; padding: 1rem; background: var(--bg-card); border-radius: 8px; box-shadow: var(--shadow-sm); flex-wrap: wrap; align-items: flex-end;">
                        <div class="filter-group" style="display: flex; flex-direction: column; gap: 0.25rem;">
                            <label for="proveedorFilter"
                                style="font-weight: 500; font-size: 0.875rem;">Proveedor:</label>
                            <input type="text" id="proveedorFilter" placeholder="Código o denominación..."
                                style="padding: 0.5rem 1rem; border-radius: 6px; border: 1px solid var(--border); background: var(--bg-card); color: var(--text-main); min-width: 250px;">
                        </div>
                        <button id="buscarProveedoresBtn" class="btn-primary"
                            style="padding: 0.5rem 1.5rem; border-radius: 6px; border: none; background: var(--primary); color: white; cursor: pointer; font-weight: 500;">
                            <i class="ri-search-line"></i> Buscar
                        </button>
                    </div>

                    <!-- Info Bar -->
                    <div id="proveedoresInfo"
                        style="display: none; justify-content: space-between; align-items: center; margin-bottom: 1rem; padding: 0.75rem 1rem; background: rgba(59, 130, 246, 0.05); border-left: 4px solid var(--primary); border-radius: 4px;">
                        <span
                            style="display: flex; align-items: center; gap: 0.5rem; color: var(--text-main); font-weight: 500;">
                            <i class="ri-information-line" style="color: var(--primary);"></i>
                            <span id="proveedoresResultCount">0 registros encontrados</span>
                        </span>
                    </div>

                    <!-- Pagination Bar -->
                    <div id="proveedoresPaginationBar" class="pagination-bar"
                        style="display: none; justify-content: space-between; align-items: center; margin-bottom: 1rem; padding: 0.75rem 1rem; background: var(--bg-card); border-radius: 8px; box-shadow: var(--shadow-sm);">
                        <span id="proveedoresPaginationInfo"
                            style="font-size: 0.875rem; color: var(--text-muted);">Mostrando 0
                            de
                            0</span>
                        <div style="display: flex; gap: 0.5rem;">
                            <button id="proveedoresPrevPageBtn" class="btn-pagination"
                                style="padding: 0.5rem 1rem; border-radius: 6px; border: 1px solid var(--border); background: var(--bg-card); color: var(--text-main); cursor: pointer; display: flex; align-items: center; gap: 0.25rem;">
                                <i class="ri-arrow-left-s-line"></i> Anterior
                            </button>
                            <button id="proveedoresNextPageBtn" class="btn-pagination"
                                style="padding: 0.5rem 1rem; border-radius: 6px; border: 1px solid var(--border); background: var(--bg-card); color: var(--text-main); cursor: pointer; display: flex; align-items: center; gap: 0.25rem;">
                                Siguiente <i class="ri-arrow-right-s-line"></i>
                            </button>
                        </div>
                    </div>

                    <div class="table-card">
                        <div class="table-wrapper">
                            <table id="proveedoresTable" style="table-layout: fixed; width: 100%; min-width: 800px;">
                                <thead>
                                    <tr>
                                        <th style="width: 120px;">Código</th>
                                        <th style="width: 300px;">Denominación</th>
                                        <th style="width: 200px;">Email</th>
                                        <th style="width: 130px;">Teléfono 1</th>
                                        <th style="width: 130px;">Teléfono 2</th>
                                    </tr>
                                </thead>
                                <tbody id="proveedoresTableBody">
                                    <tr>
                                        <td colspan="5"
                                            style="text-align: center; padding: 2rem; color: var(--text-muted);">
                                            <i class="ri-truck-line"
                                                style="font-size: 2rem; display: block; margin-bottom: 0.5rem;"></i>
                                            Pulsa Buscar para cargar los proveedores
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Clientes View -->
            <div id="clientesView" class="view-section">
                <div class="clientes-content" style="padding: 2rem;">

                    <div class="filter-bar"
                        style="display: flex; gap: 1rem; margin-bottom: 1rem; padding: 1rem; background: var(--bg-card); border-radius: 8px; box-shadow: var(--shadow-sm); flex-wrap: wrap; align-items: flex-end;">
                        <div class="filter-group" style="display: flex; flex-direction: column; gap: 0.25rem;">
                            <label for="clienteFilter" style="font-weight: 500; font-size: 0.875rem;">Cliente:</label>
                            <input type="text" id="clienteFilter" placeholder="Código o nombre empresa..."
                                style="padding: 0.5rem 1rem; border-radius: 6px; border: 1px solid var(--border); background: var(--bg-card); color: var(--text-main); min-width: 250px;">
                        </div>
                        <button id="buscarClientesBtn" class="btn-primary"
                            style="padding: 0.5rem 1.5rem; border-radius: 6px; border: none; background: var(--primary); color: white; cursor: pointer; font-weight: 500;">
                            <i class="ri-search-line"></i> Buscar
                        </button>
                    </div>

                    <!-- Info Bar -->
                    <div id="clientesInfo"
                        style="display: none; justify-content: space-between; align-items: center; margin-bottom: 1rem; padding: 0.75rem 1rem; background: rgba(59, 130, 246, 0.05); border-left: 4px solid var(--primary); border-radius: 4px;">
                        <span
                            style="display: flex; align-items: center; gap: 0.5rem; color: var(--text-main); font-weight: 500;">
                            <i class="ri-information-line" style="color: var(--primary);"></i>
                            <span id="clientesResultCount">0 registros encontrados</span>
                        </span>
                    </div>

                    <!-- Pagination Bar -->
                    <div id="clientesPaginationBar" class="pagination-bar"
                        style="display: none; justify-content: space-between; align-items: center; margin-bottom: 1rem; padding: 0.75rem 1rem; background: var(--bg-card); border-radius: 8px; box-shadow: var(--shadow-sm);">
                        <span id="clientesPaginationInfo"
                            style="font-size: 0.875rem; color: var(--text-muted);">Mostrando
                            0 de 0</span>
                        <div style="display: flex; gap: 0.5rem;">
                            <button id="clientesPrevPageBtn" class="btn-pagination"
                                style="padding: 0.5rem 1rem; border-radius: 6px; border: 1px solid var(--border); background: var(--bg-card); color: var(--text-main); cursor: pointer; display: flex; align-items: center; gap: 0.25rem;">
                                <i class="ri-arrow-left-s-line"></i> Anterior
                            </button>
                            <button id="clientesNextPageBtn" class="btn-pagination"
                                style="padding: 0.5rem 1rem; border-radius: 6px; border: 1px solid var(--border); background: var(--bg-card); color: var(--text-main); cursor: pointer; display: flex; align-items: center; gap: 0.25rem;">
                                Siguiente <i class="ri-arrow-right-s-line"></i>
                            </button>
                        </div>
                    </div>

                    <div class="table-card">
                        <div class="table-wrapper">
                            <table id="clientesTable" style="table-layout: fixed; width: 100%; min-width: 800px;">
                                <thead>
                                    <tr>
                                        <th style="width: 120px;">Código</th>
                                        <th style="width: 300px;">Nombre Empresa</th>
                                        <th style="width: 200px;">Email</th>
                                        <th style="width: 130px;">Teléfono</th>
                                        <th style="width: 100px;">Estado</th>
                                    </tr>
                                </thead>
                                <tbody id="clientesTableBody">
                                    <tr>
                                        <td colspan="5"
                                            style="text-align: center; padding: 2rem; color: var(--text-muted);">
                                            <i class="ri-user-star-line"
                                                style="font-size: 2rem; display: block; margin-bottom: 0.5rem;"></i>
                                            Pulsa Buscar para cargar los clientes
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Normas View -->
            <div id="normasView" class="view-section">
                <div class="normas-content" style="padding: 2rem;">

                    <div class="filter-bar"
                        style="display: flex; gap: 1rem; margin-bottom: 1rem; padding: 1rem; background: var(--bg-card); border-radius: 8px; box-shadow: var(--shadow-sm); flex-wrap: wrap; align-items: flex-end;">
                        <div class="filter-group" style="display: flex; flex-direction: column; gap: 0.25rem;">
                            <label for="normasTipoFilter" style="font-weight: 500; font-size: 0.875rem;">Tipo
                                Norma:</label>
                            <select id="normasTipoFilter"
                                style="padding: 0.5rem 1rem; border-radius: 6px; border: 1px solid var(--border); background: var(--bg-card); color: var(--text-main); min-width: 150px;">
                                <option value="">Todos</option>
                            </select>
                        </div>
                        <div class="filter-group" style="display: flex; flex-direction: column; gap: 0.25rem;">
                            <label for="normasClienteFilter"
                                style="font-weight: 500; font-size: 0.875rem;">Norma/Cliente:</label>
                            <input type="text" id="normasClienteFilter" placeholder="Buscar..."
                                style="padding: 0.5rem 1rem; border-radius: 6px; border: 1px solid var(--border); background: var(--bg-card); color: var(--text-main); min-width: 200px;">
                        </div>
                        <div class="filter-group" style="display: flex; flex-direction: column; gap: 0.25rem;">
                            <label for="normasControlFilter"
                                style="font-weight: 500; font-size: 0.875rem;">Control:</label>
                            <select id="normasControlFilter"
                                style="padding: 0.5rem 1rem; border-radius: 6px; border: 1px solid var(--border); background: var(--bg-card); color: var(--text-main); min-width: 150px;">
                                <option value="">Todos</option>
                            </select>
                        </div>
                        <div class="filter-group" style="display: flex; flex-direction: column; gap: 0.25rem;">
                            <label for="normasActualFilter"
                                style="font-weight: 500; font-size: 0.875rem;">Actual:</label>
                            <select id="normasActualFilter"
                                style="padding: 0.5rem 1rem; border-radius: 6px; border: 1px solid var(--border); background: var(--bg-card); color: var(--text-main); min-width: 100px;">
                                <option value="">Todos</option>
                                <option value="si">Sí</option>
                                <option value="no">No</option>
                            </select>
                        </div>
                        <button id="buscarNormasBtn" class="btn-primary"
                            style="padding: 0.5rem 1.5rem; border-radius: 6px; border: none; background: var(--primary); color: white; cursor: pointer; font-weight: 500;">
                            <i class="ri-search-line"></i> Buscar
                        </button>
                    </div>

                    <!-- Info Bar -->
                    <div id="normasInfo"
                        style="display: none; justify-content: space-between; align-items: center; margin-bottom: 1rem; padding: 0.75rem 1rem; background: rgba(59, 130, 246, 0.05); border-left: 4px solid var(--primary); border-radius: 4px;">
                        <span
                            style="display: flex; align-items: center; gap: 0.5rem; color: var(--text-main); font-weight: 500;">
                            <i class="ri-information-line" style="color: var(--primary);"></i>
                            <span id="normasResultCount">0 registros encontrados</span>
                        </span>
                    </div>

                    <!-- Pagination Bar -->
                    <div id="normasPaginationBar" class="pagination-bar"
                        style="display: none; justify-content: space-between; align-items: center; margin-bottom: 1rem; padding: 0.75rem 1rem; background: var(--bg-card); border-radius: 8px; box-shadow: var(--shadow-sm);">
                        <span id="normasPaginationInfo" style="font-size: 0.875rem; color: var(--text-muted);">Mostrando
                            0 de
                            0</span>
                        <div style="display: flex; gap: 0.5rem;">
                            <button id="normasPrevPageBtn" class="btn-pagination"
                                style="padding: 0.5rem 1rem; border-radius: 6px; border: 1px solid var(--border); background: var(--bg-card); color: var(--text-main); cursor: pointer; display: flex; align-items: center; gap: 0.25rem;">
                                <i class="ri-arrow-left-s-line"></i> Anterior
                            </button>
                            <button id="normasNextPageBtn" class="btn-pagination"
                                style="padding: 0.5rem 1rem; border-radius: 6px; border: 1px solid var(--border); background: var(--bg-card); color: var(--text-main); cursor: pointer; display: flex; align-items: center; gap: 0.25rem;">
                                Siguiente <i class="ri-arrow-right-s-line"></i>
                            </button>
                        </div>
                    </div>

                    <div class="table-card">
                        <div class="table-wrapper">
                            <table id="normasTable" style="table-layout: fixed; width: 100%; min-width: 900px;">
                                <thead>
                                    <tr>
                                        <th style="width: 180px;">Tipo/Referencia</th>
                                        <th style="width: 100px;">Edición</th>
                                        <th style="width: 120px;">Fecha Norma</th>
                                        <th style="width: 100px;">Estado</th>
                                        <th style="width: 80px;">Actual</th>
                                        <th style="width: 400px;">Designación</th>
                                    </tr>
                                </thead>
                                <tbody id="normasTableBody">
                                    <tr>
                                        <td colspan="6"
                                            style="text-align: center; padding: 2rem; color: var(--text-muted);">
                                            <i class="ri-book-2-line"
                                                style="font-size: 2rem; display: block; margin-bottom: 0.5rem;"></i>
                                            Pulsa Buscar para cargar las normas
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Centros View -->
            <div id="centrosView" class="view-section">
                <div class="centros-content" style="padding: 2rem;">

                    <div class="filter-bar"
                        style="display: flex; gap: 1rem; margin-bottom: 1rem; padding: 1rem; background: var(--bg-card); border-radius: 8px; box-shadow: var(--shadow-sm); flex-wrap: wrap; align-items: flex-end;">
                        <div class="filter-group" style="display: flex; flex-direction: column; gap: 0.25rem;">
                            <label for="centrosSeccionFilter"
                                style="font-weight: 500; font-size: 0.875rem;">Sección:</label>
                            <select id="centrosSeccionFilter"
                                style="padding: 0.5rem 1rem; border-radius: 6px; border: 1px solid var(--border); background: var(--bg-card); color: var(--text-main); min-width: 200px;">
                                <option value="">Todas</option>
                            </select>
                        </div>
                        <div class="filter-group" style="display: flex; flex-direction: column; gap: 0.25rem;">
                            <label for="centrosTipoFilter" style="font-weight: 500; font-size: 0.875rem;">Tipo:</label>
                            <select id="centrosTipoFilter"
                                style="padding: 0.5rem 1rem; border-radius: 6px; border: 1px solid var(--border); background: var(--bg-card); color: var(--text-main); min-width: 200px;">
                                <option value="">Todos</option>
                            </select>
                        </div>
                        <div class="filter-group" style="display: flex; flex-direction: column; gap: 0.25rem;">
                            <label for="centrosEstadoFilter"
                                style="font-weight: 500; font-size: 0.875rem;">Activo:</label>
                            <select id="centrosEstadoFilter"
                                style="padding: 0.5rem 1rem; border-radius: 6px; border: 1px solid var(--border); background: var(--bg-card); color: var(--text-main); min-width: 150px;">
                                <option value="">Todos</option>
                            </select>
                        </div>
                        <button id="buscarCentrosBtn" class="btn-primary"
                            style="padding: 0.5rem 1.5rem; border-radius: 6px; border: none; background: var(--primary); color: white; cursor: pointer; font-weight: 500;">
                            <i class="ri-search-line"></i> Buscar
                        </button>
                    </div>

                    <!-- Info Bar -->
                    <div id="centrosInfo"
                        style="display: none; justify-content: space-between; align-items: center; margin-bottom: 1rem; padding: 0.75rem 1rem; background: rgba(59, 130, 246, 0.05); border-left: 4px solid var(--primary); border-radius: 4px;">
                        <span
                            style="display: flex; align-items: center; gap: 0.5rem; color: var(--text-main); font-weight: 500;">
                            <i class="ri-information-line" style="color: var(--primary);"></i>
                            <span id="centrosResultCount">0 registros encontrados</span>
                        </span>
                    </div>

                    <!-- Pagination Bar -->
                    <div id="centrosPaginationBar" class="pagination-bar"
                        style="display: none; justify-content: space-between; align-items: center; margin-bottom: 1rem; padding: 0.75rem 1rem; background: var(--bg-card); border-radius: 8px; box-shadow: var(--shadow-sm);">
                        <span id="centrosPaginationInfo"
                            style="font-size: 0.875rem; color: var(--text-muted);">Mostrando
                            0 de 0</span>
                        <div style="display: flex; gap: 0.5rem;">
                            <button id="centrosPrevPageBtn" class="btn-pagination"
                                style="padding: 0.5rem 1rem; border-radius: 6px; border: 1px solid var(--border); background: var(--bg-card); color: var(--text-main); cursor: pointer; display: flex; align-items: center; gap: 0.25rem;">
                                <i class="ri-arrow-left-s-line"></i> Anterior
                            </button>
                            <button id="centrosNextPageBtn" class="btn-pagination"
                                style="padding: 0.5rem 1rem; border-radius: 6px; border: 1px solid var(--border); background: var(--bg-card); color: var(--text-main); cursor: pointer; display: flex; align-items: center; gap: 0.25rem;">
                                Siguiente <i class="ri-arrow-right-s-line"></i>
                            </button>
                        </div>
                    </div>

                    <div class="table-card">
                        <div class="table-wrapper">
                            <table id="centrosTable" style="table-layout: fixed; width: 100%; min-width: 800px;">
                                <thead>
                                    <tr>
                                        <th style="width: 120px; cursor: pointer;" data-sort="codMaquina"
                                            class="sortable-centros">
                                            Código <i class="ri-arrow-up-down-line"></i>
                                        </th>
                                        <th style="width: 300px; cursor: pointer;" data-sort="descripcion"
                                            class="sortable-centros">Descripción <i class="ri-arrow-up-down-line"></i>
                                        </th>
                                        <th style="width: 150px; cursor: pointer;" data-sort="tipo"
                                            class="sortable-centros">
                                            Tipo <i class="ri-arrow-up-down-line"></i></th>
                                        <th style="width: 150px; cursor: pointer;" data-sort="seccion"
                                            class="sortable-centros">
                                            Sección <i class="ri-arrow-up-down-line"></i></th>
                                        <th style="width: 100px; cursor: pointer;" data-sort="estado"
                                            class="sortable-centros">
                                            Activo <i class="ri-arrow-up-down-line"></i></th>
                                    </tr>
                                </thead>
                                <tbody id="centrosTableBody">
                                    <tr>
                                        <td colspan="5"
                                            style="text-align: center; padding: 2rem; color: var(--text-muted);">
                                            <i class="ri-building-line"
                                                style="font-size: 2rem; display: block; margin-bottom: 0.5rem;"></i>
                                            Selecciona filtros y pulsa Buscar para ver los centros
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Activos View -->
            <div id="activosView" class="view-section">
                <div class="activos-content" style="padding: 2rem;">

                    <div class="filter-bar"
                        style="display: flex; gap: 1rem; margin-bottom: 1rem; padding: 1rem; background: var(--bg-card); border-radius: 8px; box-shadow: var(--shadow-sm); flex-wrap: wrap; align-items: flex-end;">
                        <div class="filter-group" style="display: flex; flex-direction: column; gap: 0.25rem;">
                            <label for="activosCodigoFilter"
                                style="font-weight: 500; font-size: 0.875rem;">Activo:</label>
                            <select id="activosCodigoFilter"
                                style="padding: 0.5rem 1rem; border-radius: 6px; border: 1px solid var(--border); background: var(--bg-card); color: var(--text-main); min-width: 350px;">
                                <option value="">Todos</option>
                            </select>
                        </div>
                        <div class="filter-group" style="display: flex; flex-direction: column; gap: 0.25rem;">
                            <label for="activosZonaFilter" style="font-weight: 500; font-size: 0.875rem;">Zona:</label>
                            <select id="activosZonaFilter"
                                style="padding: 0.5rem 1rem; border-radius: 6px; border: 1px solid var(--border); background: var(--bg-card); color: var(--text-main); min-width: 250px;">
                                <option value="">Todas</option>
                            </select>
                        </div>
                        <button id="buscarActivosBtn" class="btn-primary"
                            style="padding: 0.5rem 1.5rem; border-radius: 6px; border: none; background: var(--primary); color: white; cursor: pointer; font-weight: 500;">
                            <i class="ri-search-line"></i> Buscar
                        </button>
                    </div>

                    <!-- Info Bar -->
                    <div id="activosInfo"
                        style="display: none; justify-content: space-between; align-items: center; margin-bottom: 1rem; padding: 0.75rem 1rem; background: rgba(59, 130, 246, 0.05); border-left: 4px solid var(--primary); border-radius: 4px;">
                        <span
                            style="display: flex; align-items: center; gap: 0.5rem; color: var(--text-main); font-weight: 500;">
                            <i class="ri-information-line" style="color: var(--primary);"></i>
                            <span id="activosResultCount">0 registros encontrados</span>
                        </span>
                    </div>

                    <!-- Pagination Bar -->
                    <div id="activosPaginationBar" class="pagination-bar"
                        style="display: none; justify-content: space-between; align-items: center; margin-bottom: 1rem; padding: 0.75rem 1rem; background: var(--bg-card); border-radius: 8px; box-shadow: var(--shadow-sm);">
                        <span id="activosPaginationInfo"
                            style="font-size: 0.875rem; color: var(--text-muted);">Mostrando
                            0 de 0</span>
                        <div style="display: flex; gap: 0.5rem;">
                            <button id="activosPrevPageBtn" class="btn-pagination"
                                style="padding: 0.5rem 1rem; border-radius: 6px; border: 1px solid var(--border); background: var(--bg-card); color: var(--text-main); cursor: pointer; display: flex; align-items: center; gap: 0.25rem;">
                                <i class="ri-arrow-left-s-line"></i> Anterior
                            </button>
                            <button id="activosNextPageBtn" class="btn-pagination"
                                style="padding: 0.5rem 1rem; border-radius: 6px; border: 1px solid var(--border); background: var(--bg-card); color: var(--text-main); cursor: pointer; display: flex; align-items: center; gap: 0.25rem;">
                                Siguiente <i class="ri-arrow-right-s-line"></i>
                            </button>
                        </div>
                    </div>

                    <div class="table-card">
                        <div class="table-wrapper">
                            <table id="activosTable" style="table-layout: fixed; width: 100%;">
                                <thead>
                                    <tr>
                                        <th style="width: 120px; cursor: pointer;" data-sort="codigo"
                                            class="sortable-act">
                                            Código Activo <i class="ri-arrow-up-down-line"></i>
                                        </th>
                                        <th style="width: 250px; cursor: pointer;" data-sort="denominacion"
                                            class="sortable-act">Denominación <i class="ri-arrow-up-down-line"></i></th>
                                        <th style="width: 200px; cursor: pointer;" data-sort="zona"
                                            class="sortable-act">Zona <i class="ri-arrow-up-down-line"></i></th>
                                    </tr>
                                </thead>
                                <tbody id="activosTableBody">
                                    <tr>
                                        <td colspan="3"
                                            style="text-align: center; padding: 2rem; color: var(--text-muted);">
                                            <i class="ri-device-line"
                                                style="font-size: 2rem; display: block; margin-bottom: 0.5rem;"></i>
                                            Introduce un código de activo o selecciona una zona y pulsa Buscar
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Equipos View (Historical/Maestros - Renamed to avoid conflicts) -->
            <div id="equiposView_Maestros" class="view-section">
                <div class="equipos-content" style="padding: 2rem;">
                    <div class="equipos-header" style="margin-bottom: 2rem;">
                        <!-- Title removed as requested -->
                        <p style="color: var(--text-muted); margin: 0;">Consulta los equipos de calibración (Fw_Comunes)
                        </p>
                    </div>

                    <!-- Active Equipment KPI -->
                    <div class="stats-grid"
                        style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 2rem;">
                        <div class="stat-card"
                            style="background: var(--bg-card); padding: 1.5rem; border-radius: 12px; box-shadow: var(--shadow-sm); border-left: 4px solid var(--primary);">
                            <h3
                                style="font-size: 0.875rem; color: var(--text-muted); margin: 0 0 0.5rem 0; text-transform: uppercase;">
                                Total Equipos Activos</h3>
                            <div style="display: flex; align-items: baseline; gap: 0.5rem;">
                                <span id="kpiActiveEquipos"
                                    style="font-size: 2rem; font-weight: 700; color: var(--text-main);">0</span>
                                <span style="font-size: 0.875rem; color: var(--success);">En planta</span>
                            </div>
                        </div>
                    </div>

                    <div class="filter-bar"
                        style="display: flex; gap: 1rem; margin-bottom: 1rem; padding: 1rem; background: var(--bg-card); border-radius: 8px; box-shadow: var(--shadow-sm); flex-wrap: wrap; align-items: flex-end;">
                        <div class="filter-group" style="display: flex; flex-direction: column; gap: 0.25rem;">
                            <label for="equiposRefFilter" style="font-weight: 500; font-size: 0.875rem;">Nº REF:</label>
                            <input type="text" id="equiposRefFilter" placeholder="Número de referencia..."
                                style="padding: 0.5rem 1rem; border-radius: 6px; border: 1px solid var(--border); background: var(--bg-card); color: var(--text-main); min-width: 200px;">
                        </div>
                        <div class="filter-group" style="display: flex; flex-direction: column; gap: 0.25rem;">
                            <label for="equiposEmpresaFilter"
                                style="font-weight: 500; font-size: 0.875rem;">Empresa:</label>
                            <select id="equiposEmpresaFilter"
                                style="padding: 0.5rem 1rem; border-radius: 6px; border: 1px solid var(--border); background: var(--bg-card); color: var(--text-main); min-width: 200px;">
                                <option value="">Todas</option>
                            </select>
                        </div>
                        <div class="filter-group" style="display: flex; flex-direction: column; gap: 0.25rem;">
                            <label for="equiposAreaFilter" style="font-weight: 500; font-size: 0.875rem;">Area:</label>
                            <select id="equiposAreaFilter"
                                style="padding: 0.5rem 1rem; border-radius: 6px; border: 1px solid var(--border); background: var(--bg-card); color: var(--text-main); min-width: 150px;">
                                <option value="">Todas</option>
                            </select>
                        </div>
                        <div class="filter-group" style="display: flex; flex-direction: column; gap: 0.25rem;">
                            <label for="equiposSubareaFilter"
                                style="font-weight: 500; font-size: 0.875rem;">Subarea:</label>
                            <select id="equiposSubareaFilter"
                                style="padding: 0.5rem 1rem; border-radius: 6px; border: 1px solid var(--border); background: var(--bg-card); color: var(--text-main); min-width: 150px;">
                                <option value="">Todas</option>
                            </select>
                        </div>
                        <div class="filter-group" style="display: flex; flex-direction: column; gap: 0.25rem;">
                            <label for="equiposRetiradoFilter"
                                style="font-weight: 500; font-size: 0.875rem;">Retirado:</label>
                            <select id="equiposRetiradoFilter"
                                style="padding: 0.5rem 1rem; border-radius: 6px; border: 1px solid var(--border); background: var(--bg-card); color: var(--text-main); min-width: 100px;">
                                <option value="">Todos</option>
                                <option value="no">No</option>
                                <option value="si">Sí</option>
                            </select>
                        </div>
                        <button id="buscarEquiposBtn" class="btn-primary"
                            style="padding: 0.5rem 1.5rem; border-radius: 6px; border: none; background: var(--primary); color: white; cursor: pointer; font-weight: 500;">
                            <i class="ri-search-line"></i> Buscar
                        </button>
                        <button id="imprimirEquiposBtn" class="btn-secondary"
                            style="margin-left: auto; padding: 0.5rem 1.5rem; border-radius: 6px; border: 1px solid var(--border); background: var(--bg-card); color: var(--text-main); cursor: pointer; font-weight: 500;">
                            <i class="ri-file-pdf-line"></i> Generar PDF
                        </button>
                    </div>

                    <!-- Info Bar -->
                    <div id="equiposInfo"
                        style="display: none; justify-content: space-between; align-items: center; margin-bottom: 1rem; padding: 0.75rem 1rem; background: rgba(59, 130, 246, 0.05); border-left: 4px solid var(--primary); border-radius: 4px;">
                        <span
                            style="display: flex; align-items: center; gap: 0.5rem; color: var(--text-main); font-weight: 500;">
                            <i class="ri-information-line" style="color: var(--primary);"></i>
                            <span id="equiposResultCount">0 registros encontrados</span>
                        </span>
                    </div>

                    <!-- Pagination Bar -->
                    <div id="equiposPaginationBar" class="pagination-bar"
                        style="display: none; justify-content: space-between; align-items: center; margin-bottom: 1rem; padding: 0.75rem 1rem; background: var(--bg-card); border-radius: 8px; box-shadow: var(--shadow-sm);">
                        <span id="equiposPaginationInfo"
                            style="font-size: 0.875rem; color: var(--text-muted);">Mostrando 0 de
                            0</span>
                        <div style="display: flex; gap: 0.5rem;">
                            <button id="equiposPrevPageBtn" class="btn-pagination"
                                style="padding: 0.5rem 1rem; border-radius: 6px; border: 1px solid var(--border); background: var(--bg-card); color: var(--text-main); cursor: pointer; display: flex; align-items: center; gap: 0.25rem;">
                                <i class="ri-arrow-left-s-line"></i> Anterior
                            </button>
                            <button id="equiposNextPageBtn" class="btn-pagination"
                                style="padding: 0.5rem 1rem; border-radius: 6px; border: 1px solid var(--border); background: var(--bg-card); color: var(--text-main); cursor: pointer; display: flex; align-items: center; gap: 0.25rem;">
                                Siguiente <i class="ri-arrow-right-s-line"></i>
                            </button>
                        </div>
                    </div>

                    <div class="table-card">
                        <div class="table-wrapper">
                            <table id="equiposTable" style="table-layout: fixed; width: 100%; min-width: 3500px;">
                                <thead>
                                    <tr>
                                        <th style="width: 120px;" data-sort="EMPRESA" class="sortable-equipos">Empresa
                                            <i class="ri-arrow-up-down-line"></i>
                                        </th>
                                        <th style="width: 120px;" data-sort="AREA" class="sortable-equipos">Área <i
                                                class="ri-arrow-up-down-line"></i></th>
                                        <th style="width: 120px;" data-sort="Subarea" class="sortable-equipos">Subárea
                                            <i class="ri-arrow-up-down-line"></i>
                                        </th>
                                        <th style="width: 100px;" data-sort="Nº REF" class="sortable-equipos">Nº REF <i
                                                class="ri-arrow-up-down-line"></i></th>
                                        <th style="width: 150px;" data-sort="proxima" class="sortable-equipos">Próxima
                                            Calib. <i class="ri-arrow-up-down-line"></i></th>
                                        <th style="width: 150px;" data-sort="apto" class="sortable-equipos">Apto Hasta
                                            <i class="ri-arrow-up-down-line"></i>
                                        </th>
                                        <th style="width: 250px;" data-sort="NOMBRE INSTRUMENTO"
                                            class="sortable-equipos">Nombre
                                            Instrumento <i class="ri-arrow-up-down-line"></i></th>
                                        <th style="width: 200px;" data-sort="ORGANISMO" class="sortable-equipos">Org.
                                            Exterior <i class="ri-arrow-up-down-line"></i></th>
                                        <th style="width: 150px;">Familia</th>
                                        <th style="width: 120px;" data-sort="PERIODICIDAD" class="sortable-equipos">
                                            Periodicidad <i class="ri-arrow-up-down-line"></i></th>
                                        <th style="width: 100px;">Int/Ext</th>
                                        <th style="width: 150px;">Campo Medida</th>
                                        <th style="width: 200px;">Observaciones</th>
                                        <th style="width: 150px;">Marca</th>
                                        <th style="width: 150px;">Modelo</th>
                                        <th style="width: 150px;">Nº Serie</th>
                                        <th style="width: 100px;">Div. Escala</th>
                                        <th style="width: 120px;">F. Recepción</th>
                                        <th style="width: 150px;">Procedimiento</th>
                                        <th style="width: 150px;">Criterio Acept.</th>
                                        <th style="width: 100px;" data-sort="inicial" class="sortable-equipos">Estudio
                                            Inicial <i class="ri-arrow-up-down-line"></i></th>
                                        <th style="width: 100px;" data-sort="NºEC" class="sortable-equipos">Nº EC <i
                                                class="ri-arrow-up-down-line"></i></th>
                                        <th style="width: 120px;" data-sort="Fecha Retirada" class="sortable-equipos">F.
                                            Retirada <i class="ri-arrow-up-down-line"></i></th>
                                        <th style="width: 120px;">F. Apertura</th>
                                    </tr>
                                </thead>
                                <tbody id="equiposTableBody">
                                    <tr>
                                        <td colspan="24"
                                            style="text-align: center; padding: 2rem; color: var(--text-muted);">
                                            <i class="ri-cpu-line"
                                                style="font-size: 2rem; display: block; margin-bottom: 0.5rem;"></i>
                                            Introduce filtros y pulsa Buscar
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Ensayos Dashboard View -->
            <div id="ensayosDashboardView" class="view-section">
                <div style="padding: 2rem;">
                    <!-- Title handled by main header -->

                    <!-- Filters -->
                    <div
                        style="margin-bottom: 2rem; display: flex; gap: 1rem; align-items: center; flex-wrap: wrap; padding: 1rem; background: var(--bg-card); border-radius: 8px; box-shadow: var(--shadow-sm);">
                        <div class="filter-group" style="display: flex; flex-direction: column; gap: 0.25rem;">
                            <label style="font-weight: 500; font-size: 0.875rem;">Año:</label>
                            <select id="ensayosDashboardYear"
                                style="padding: 0.5rem 1rem; border-radius: 6px; border: 1px solid var(--border); background: var(--bg-card); color: var(--text-main); min-width: 100px;">
                                <option value="2025" selected>2025</option>
                                <option value="2024">2024</option>
                                <option value="2023">2023</option>
                                <option value="2022">2022</option>
                            </select>
                        </div>
                        <div class="filter-group" style="display: flex; flex-direction: column; gap: 0.25rem;">
                            <label style="font-weight: 500; font-size: 0.875rem;">Mes:</label>
                            <select id="ensayosDashboardMonth"
                                style="padding: 0.5rem 1rem; border-radius: 6px; border: 1px solid var(--border); background: var(--bg-card); color: var(--text-main); min-width: 120px;">
                                <option value="">Todos</option>
                                <option value="1">Enero</option>
                                <option value="2">Febrero</option>
                                <option value="3">Marzo</option>
                                <option value="4">Abril</option>
                                <option value="5">Mayo</option>
                                <option value="6">Junio</option>
                                <option value="7">Julio</option>
                                <option value="8">Agosto</option>
                                <option value="9">Septiembre</option>
                                <option value="10">Octubre</option>
                                <option value="11">Noviembre</option>
                                <option value="12">Diciembre</option>
                            </select>
                        </div>
                        <button id="refreshEnsayosDashboard" class="btn-primary"
                            style="padding: 0.5rem 1rem; border-radius: 6px; border: none; background: var(--primary); color: white; cursor: pointer; margin-top: 1.25rem;">
                            <i class="ri-refresh-line"></i> Actualizar
                        </button>
                        <button id="exportEnsayosPdf" class="btn-secondary"
                            style="padding: 0.5rem 1rem; border-radius: 6px; border: 1px solid var(--border); background: var(--bg-card); color: var(--text-main); cursor: pointer; margin-top: 1.25rem; margin-left: auto;">
                            <i class="ri-file-pdf-line"></i> Exportar PDF
                        </button>
                    </div>

                    <!-- KPIs -->
                    <div class="kpi-grid" style="margin-bottom: 2rem;">
                        <div class="kpi-card">
                            <div class="kpi-icon"
                                style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);"><i
                                    class="ri-file-list-3-line"></i></div>
                            <div class="kpi-info">
                                <h3>Total Informes</h3>
                                <p class="kpi-value" id="kpiTotalEnsayos">0</p>
                                <span class="kpi-trend">En el año seleccionado</span>
                            </div>
                        </div>
                        <div class="kpi-card">
                            <div class="kpi-icon"
                                style="background: linear-gradient(135deg, #FF6B6B 0%, #FF8E53 100%);"><i
                                    class="ri-radioactive-line"></i></div>
                            <div class="kpi-info">
                                <h3>Informes RT</h3>
                                <p class="kpi-value" id="kpiTotalRt">0</p>
                            </div>
                        </div>
                        <div class="kpi-card">
                            <div class="kpi-icon"
                                style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);"><i
                                    class="ri-drop-line"></i></div>
                            <div class="kpi-info">
                                <h3>Informes PT</h3>
                                <p class="kpi-value" id="kpiTotalPt">0</p>
                            </div>
                        </div>
                        <div class="kpi-card">
                            <div class="kpi-icon"
                                style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);"><i
                                    class="ri-eye-line"></i></div>
                            <div class="kpi-info">
                                <h3>Informes VT</h3>
                                <p class="kpi-value" id="kpiTotalVt">0</p>
                            </div>
                        </div>
                    </div>

                    <!-- Charts -->
                    <div class="charts-row"
                        style="display: grid; grid-template-columns: 2fr 1fr; gap: 1.5rem; margin-bottom: 2rem;">
                        <div class="chart-card large"
                            style="background: var(--bg-card); padding: 1.5rem; border-radius: 12px; box-shadow: var(--shadow-sm);">
                            <h3 style="margin-bottom: 1rem; color: var(--text-main);">Evolución Mensual</h3>
                            <div style="height: 300px;"><canvas id="ensayosTrendChart"></canvas></div>
                        </div>
                        <div class="chart-card small"
                            style="background: var(--bg-card); padding: 1.5rem; border-radius: 12px; box-shadow: var(--shadow-sm);">
                            <h3 style="margin-bottom: 1rem; color: var(--text-main);">Distribución</h3>
                            <div style="height: 300px;"><canvas id="ensayosDistChart"></canvas></div>
                        </div>
                    </div>

                    <!-- Bottom Row -->
                    <div class="charts-row" style="display: grid; grid-template-columns: 1fr 2fr; gap: 1.5rem;">
                        <div class="chart-card"
                            style="background: var(--bg-card); padding: 1.5rem; border-radius: 12px; box-shadow: var(--shadow-sm);">
                            <h3 style="margin-bottom: 1rem; color: var(--text-main);">Top Inspectores</h3>
                            <div style="height: 250px;"><canvas id="ensayosInspectorChart"></canvas></div>
                        </div>
                        <div class="chart-card"
                            style="background: var(--bg-card); padding: 1.5rem; border-radius: 12px; box-shadow: var(--shadow-sm);">
                            <h3 style="margin-bottom: 1rem; color: var(--text-main);">Top Artículos</h3>
                            <div class="table-wrapper" style="height: 250px; overflow-y: auto;">
                                <table id="ensayosTopArticlesTable" style="width: 100%;">
                                    <thead>
                                        <tr>
                                            <th style="width: 20%;">Articulo</th>
                                            <th style="width: 20%; text-align: center;">Total</th>
                                            <th style="width: 20%; text-align: center; color: var(--success);">VT</th>
                                            <th style="width: 20%; text-align: center; color: var(--info);">PT</th>
                                            <th style="width: 20%; text-align: center; color: var(--danger);">RT</th>
                                        </tr>
                                    </thead>
                                    <tbody></tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Ensayos VT View -->
            <div id="ensayosVtView" class="view-section">
                <div class="ensayos-vt-content" style="padding: 2rem;">
                    <div class="ensayos-vt-header" style="margin-bottom: 2rem;">
                        <h2 style="margin: 0 0 0.5rem 0; color: var(--text-main);">Informes VT (Visual)</h2>
                        <p style="color: var(--text-muted); margin: 0;">Consulta los informes de inspección visual</p>
                    </div>
                    <div class="filter-bar"
                        style="display: flex; gap: 1rem; margin-bottom: 1rem; padding: 1rem; background: var(--bg-card); border-radius: 8px; box-shadow: var(--shadow-sm); flex-wrap: wrap; align-items: flex-end;">
                        <div class="filter-group" style="display: flex; flex-direction: column; gap: 0.25rem;">
                            <label style="font-weight: 500; font-size: 0.875rem;">Artículo:</label>
                            <input type="text" id="ensayosVtArticuloFilter" placeholder="Código..."
                                style="padding: 0.5rem 1rem; border-radius: 6px; border: 1px solid var(--border); background: var(--bg-card); color: var(--text-main); width: 200px;">
                        </div>
                        <div class="filter-group" style="display: flex; flex-direction: column; gap: 0.25rem;">
                            <label style="font-weight: 500; font-size: 0.875rem;">Tratamiento:</label>
                            <select id="ensayosVtTratamientoFilter"
                                style="padding: 0.5rem 1rem; border-radius: 6px; border: 1px solid var(--border); background: var(--bg-card); color: var(--text-main); min-width: 200px;">
                                <option value="">Todos</option>
                            </select>
                        </div>
                        <button id="buscarEnsayosVtBtn" class="btn-primary"
                            style="padding: 0.5rem 1.5rem; border-radius: 6px; border: none; background: var(--primary); color: white; cursor: pointer; font-weight: 500;">
                            <i class="ri-search-line"></i> Buscar
                        </button>
                    </div>
                    <div
                        style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                        <span id="ensayosVtResultCount" style="color: var(--text-muted); font-size: 0.9rem;"></span>
                        <div style="display: flex; gap: 0.5rem; align-items: center;">
                            <button id="ensayosVtPrevBtn" class="btn-pagination"
                                style="padding: 0.5rem 1rem; border-radius: 6px; border: 1px solid var(--border); background: var(--bg-card); color: var(--text-main); cursor: pointer;">
                                <i class="ri-arrow-left-s-line"></i> Anterior
                            </button>
                            <span id="ensayosVtPageInfo" style="font-size: 0.875rem;"></span>
                            <button id="ensayosVtNextBtn" class="btn-pagination"
                                style="padding: 0.5rem 1rem; border-radius: 6px; border: 1px solid var(--border); background: var(--bg-card); color: var(--text-main); cursor: pointer;">
                                Siguiente <i class="ri-arrow-right-s-line"></i>
                            </button>
                        </div>
                    </div>
                    <div class="table-card">
                        <div class="table-wrapper">
                            <table id="ensayosVtTable" style="table-layout: fixed; width: 100%;">
                                <thead>
                                    <tr>
                                        <th style="width: 100px; cursor: pointer;"
                                            onclick="handleEnsayosSort('vt', 'Fecha')">
                                            Fecha <i class="ri-arrow-up-down-line sort-icon" id="sort-vt-Fecha"></i>
                                        </th>
                                        <th style="width: 150px; cursor: pointer;"
                                            onclick="handleEnsayosSort('vt', 'Artículo')">Artículo <i
                                                class="ri-arrow-up-down-line sort-icon" id="sort-vt-Artículo"></i></th>
                                        <th style="width: 100px; cursor: pointer;"
                                            onclick="handleEnsayosSort('vt', 'Informe')">
                                            Informe <i class="ri-arrow-up-down-line sort-icon" id="sort-vt-Informe"></i>
                                        </th>
                                        <th style="width: 100px; cursor: pointer;"
                                            onclick="handleEnsayosSort('vt', 'Colada')">
                                            Colada <i class="ri-arrow-up-down-line sort-icon" id="sort-vt-Colada"></i>
                                        </th>
                                        <th style="width: 80px; cursor: pointer;"
                                            onclick="handleEnsayosSort('vt', 'Lingote')">
                                            Lingote <i class="ri-arrow-up-down-line sort-icon" id="sort-vt-Lingote"></i>
                                        </th>
                                        <th style="width: 120px; cursor: pointer;"
                                            onclick="handleEnsayosSort('vt', 'Tratamiento')">Tratamiento <i
                                                class="ri-arrow-up-down-line sort-icon" id="sort-vt-Tratamiento"></i>
                                        </th>
                                        <th style="width: 150px; cursor: pointer;"
                                            onclick="handleEnsayosSort('vt', 'Inspector')">Inspector <i
                                                class="ri-arrow-up-down-line sort-icon" id="sort-vt-Inspector"></i></th>
                                    </tr>
                                </thead>
                                <tbody id="ensayosVtTableBody"></tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Ensayos PT View -->
            <div id="ensayosPtView" class="view-section">
                <div class="ensayos-pt-content" style="padding: 2rem;">
                    <div class="ensayos-pt-header" style="margin-bottom: 2rem;">
                        <h2 style="margin: 0 0 0.5rem 0; color: var(--text-main);">Informes PT (Líquidos Penetrantes)
                        </h2>
                        <p style="color: var(--text-muted); margin: 0;">Consulta los informes de líquidos penetrantes
                        </p>
                    </div>
                    <div class="filter-bar"
                        style="display: flex; gap: 1rem; margin-bottom: 1rem; padding: 1rem; background: var(--bg-card); border-radius: 8px; box-shadow: var(--shadow-sm); flex-wrap: wrap; align-items: flex-end;">
                        <div class="filter-group" style="display: flex; flex-direction: column; gap: 0.25rem;">
                            <label style="font-weight: 500; font-size: 0.875rem;">Artículo:</label>
                            <input type="text" id="ensayosPtArticuloFilter" placeholder="Código..."
                                style="padding: 0.5rem 1rem; border-radius: 6px; border: 1px solid var(--border); background: var(--bg-card); color: var(--text-main); width: 200px;">
                        </div>
                        <div class="filter-group" style="display: flex; flex-direction: column; gap: 0.25rem;">
                            <label style="font-weight: 500; font-size: 0.875rem;">Tratamiento:</label>
                            <select id="ensayosPtTratamientoFilter"
                                style="padding: 0.5rem 1rem; border-radius: 6px; border: 1px solid var(--border); background: var(--bg-card); color: var(--text-main); min-width: 200px;">
                                <option value="">Todos</option>
                            </select>
                        </div>
                        <button id="buscarEnsayosPtBtn" class="btn-primary"
                            style="padding: 0.5rem 1.5rem; border-radius: 6px; border: none; background: var(--primary); color: white; cursor: pointer; font-weight: 500;">
                            <i class="ri-refresh-line"></i> Cargar Datos
                        </button>
                    </div>
                    <div
                        style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                        <span id="ensayosPtResultCount" style="color: var(--text-muted); font-size: 0.9rem;"></span>
                        <div style="display: flex; gap: 0.5rem; align-items: center;">
                            <button id="ensayosPtPrevBtn" class="btn-pagination"
                                style="padding: 0.5rem 1rem; border-radius: 6px; border: 1px solid var(--border); background: var(--bg-card); color: var(--text-main); cursor: pointer;">
                                <i class="ri-arrow-left-s-line"></i> Anterior
                            </button>
                            <span id="ensayosPtPageInfo" style="font-size: 0.875rem;"></span>
                            <button id="ensayosPtNextBtn" class="btn-pagination"
                                style="padding: 0.5rem 1rem; border-radius: 6px; border: 1px solid var(--border); background: var(--bg-card); color: var(--text-main); cursor: pointer;">
                                Siguiente <i class="ri-arrow-right-s-line"></i>
                            </button>
                        </div>
                    </div>
                    <div class="table-card">
                        <div class="table-wrapper">
                            <table id="ensayosPtTable" style="table-layout: fixed; width: 100%;">
                                <thead>
                                    <tr>
                                        <th style="width: 100px; cursor: pointer;"
                                            onclick="handleEnsayosSort('pt', 'Fecha')">
                                            Fecha <i class="ri-arrow-up-down-line sort-icon" id="sort-pt-Fecha"></i>
                                        </th>
                                        <th style="width: 150px; cursor: pointer;"
                                            onclick="handleEnsayosSort('pt', 'Artículo')">Artículo <i
                                                class="ri-arrow-up-down-line sort-icon" id="sort-pt-Artículo"></i></th>
                                        <th style="width: 100px; cursor: pointer;"
                                            onclick="handleEnsayosSort('pt', 'Informe')">
                                            Informe <i class="ri-arrow-up-down-line sort-icon" id="sort-pt-Informe"></i>
                                        </th>
                                        <th style="width: 100px; cursor: pointer;"
                                            onclick="handleEnsayosSort('pt', 'Colada')">
                                            Colada <i class="ri-arrow-up-down-line sort-icon" id="sort-pt-Colada"></i>
                                        </th>
                                        <th style="width: 80px; cursor: pointer;"
                                            onclick="handleEnsayosSort('pt', 'Lingote')">
                                            Lingote <i class="ri-arrow-up-down-line sort-icon" id="sort-pt-Lingote"></i>
                                        </th>
                                        <th style="width: 120px; cursor: pointer;"
                                            onclick="handleEnsayosSort('pt', 'Tratamiento')">Tratamiento <i
                                                class="ri-arrow-up-down-line sort-icon" id="sort-pt-Tratamiento"></i>
                                        </th>
                                        <th style="width: 150px; cursor: pointer;"
                                            onclick="handleEnsayosSort('pt', 'Inspector')">Inspector <i
                                                class="ri-arrow-up-down-line sort-icon" id="sort-pt-Inspector"></i></th>
                                    </tr>
                                </thead>
                                <tbody id="ensayosPtTableBody"></tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Ensayos RT View -->
            <div id="ensayosRtView" class="view-section">
                <div class="ensayos-rt-content" style="padding: 2rem;">
                    <div class="ensayos-rt-header" style="margin-bottom: 2rem;">
                        <h2 style="margin: 0 0 0.5rem 0; color: var(--text-main);">Informes RT (Radiografía)</h2>
                        <p style="color: var(--text-muted); margin: 0;">Consulta los informes de radiografía</p>
                    </div>
                    <div class="filter-bar"
                        style="display: flex; gap: 1rem; margin-bottom: 1rem; padding: 1rem; background: var(--bg-card); border-radius: 8px; box-shadow: var(--shadow-sm); flex-wrap: wrap; align-items: flex-end;">
                        <div class="filter-group" style="display: flex; flex-direction: column; gap: 0.25rem;">
                            <label style="font-weight: 500; font-size: 0.875rem;">Artículo:</label>
                            <input type="text" id="ensayosRtArticuloFilter" placeholder="Código..."
                                style="padding: 0.5rem 1rem; border-radius: 6px; border: 1px solid var(--border); background: var(--bg-card); color: var(--text-main); width: 200px;">
                        </div>
                        <div class="filter-group" style="display: flex; flex-direction: column; gap: 0.25rem;">
                            <label style="font-weight: 500; font-size: 0.875rem;">Tratamiento:</label>
                            <select id="ensayosRtTratamientoFilter"
                                style="padding: 0.5rem 1rem; border-radius: 6px; border: 1px solid var(--border); background: var(--bg-card); color: var(--text-main); min-width: 200px;">
                                <option value="">Todos</option>
                            </select>
                        </div>
                        <button id="buscarEnsayosRtBtn" class="btn-primary"
                            style="padding: 0.5rem 1.5rem; border-radius: 6px; border: none; background: var(--primary); color: white; cursor: pointer; font-weight: 500;">
                            <i class="ri-refresh-line"></i> Buscar
                        </button>
                    </div>
                    <div
                        style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                        <span id="ensayosRtResultCount" style="color: var(--text-muted); font-size: 0.9rem;"></span>
                        <div style="display: flex; gap: 0.5rem; align-items: center;">
                            <button id="ensayosRtPrevBtn" class="btn-pagination"
                                style="padding: 0.5rem 1rem; border-radius: 6px; border: 1px solid var(--border); background: var(--bg-card); color: var(--text-main); cursor: pointer;">
                                <i class="ri-arrow-left-s-line"></i> Anterior
                            </button>
                            <span id="ensayosRtPageInfo" style="font-size: 0.875rem;"></span>
                            <button id="ensayosRtNextBtn" class="btn-pagination"
                                style="padding: 0.5rem 1rem; border-radius: 6px; border: 1px solid var(--border); background: var(--bg-card); color: var(--text-main); cursor: pointer;">
                                Siguiente <i class="ri-arrow-right-s-line"></i>
                            </button>
                        </div>
                    </div>
                    <div class="table-card">
                        <div class="table-wrapper">
                            <table id="ensayosRtTable" style="table-layout: fixed; width: 100%;">
                                <thead>
                                    <tr>
                                        <th style="width: 100px; cursor: pointer;"
                                            onclick="handleEnsayosSort('rt', 'Fecha')">
                                            Fecha <i class="ri-arrow-up-down-line sort-icon" id="sort-rt-Fecha"></i>
                                        </th>
                                        <th style="width: 150px; cursor: pointer;"
                                            onclick="handleEnsayosSort('rt', 'Artículo')">Artículo <i
                                                class="ri-arrow-up-down-line sort-icon" id="sort-rt-Artículo"></i></th>
                                        <th style="width: 100px; cursor: pointer;"
                                            onclick="handleEnsayosSort('rt', 'Informe')">
                                            Informe <i class="ri-arrow-up-down-line sort-icon" id="sort-rt-Informe"></i>
                                        </th>
                                        <th style="width: 100px; cursor: pointer;"
                                            onclick="handleEnsayosSort('rt', 'Colada')">
                                            Colada <i class="ri-arrow-up-down-line sort-icon" id="sort-rt-Colada"></i>
                                        </th>
                                        <th style="width: 80px; cursor: pointer;"
                                            onclick="handleEnsayosSort('rt', 'Lingote')">
                                            Lingote <i class="ri-arrow-up-down-line sort-icon" id="sort-rt-Lingote"></i>
                                        </th>
                                        <th style="width: 120px; cursor: pointer;"
                                            onclick="handleEnsayosSort('rt', 'Tratamiento')">Tratamiento <i
                                                class="ri-arrow-up-down-line sort-icon" id="sort-rt-Tratamiento"></i>
                                        </th>
                                        <th style="width: 150px; cursor: pointer;"
                                            onclick="handleEnsayosSort('rt', 'Inspector')">Inspector <i
                                                class="ri-arrow-up-down-line sort-icon" id="sort-rt-Inspector"></i></th>
                                    </tr>
                                </thead>
                                <tbody id="ensayosRtTableBody"></tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Ensayos Dureza View -->
            <div id="ensayosDurezaView" class="view-section">
                <div class="ensayos-dureza-content" style="padding: 2rem;">
                    <div class="ensayos-dureza-header" style="margin-bottom: 2rem;">
                        <h2 style="margin: 0 0 0.5rem 0; color: var(--text-main);">Informes Dureza</h2>
                        <p style="color: var(--text-muted); margin: 0;">Consulta los informes de dureza</p>
                    </div>
                    <div class="filter-bar"
                        style="display: flex; gap: 1rem; margin-bottom: 1rem; padding: 1rem; background: var(--bg-card); border-radius: 8px; box-shadow: var(--shadow-sm); flex-wrap: wrap; align-items: flex-end;">
                        <button id="buscarEnsayosDurezaBtn" class="btn-primary"
                            style="padding: 0.5rem 1.5rem; border-radius: 6px; border: none; background: var(--primary); color: white; cursor: pointer; font-weight: 500;">
                            <i class="ri-refresh-line"></i> Cargar Datos
                        </button>
                    </div>
                    <div class="table-card">
                        <div class="table-wrapper">
                            <table id="ensayosDurezaTable" style="table-layout: fixed; width: 100%;">
                                <thead>
                                    <tr>
                                        <th>Fecha</th>
                                        <th>Artículo</th>
                                        <th>Tratamiento</th>
                                        <th>Valor</th>
                                        <th>Unidad</th>
                                    </tr>
                                </thead>
                                <tbody id="ensayosDurezaTableBody"></tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Ensayos Traccion View -->
            <div id="ensayosTraccionView" class="view-section">
                <div class="ensayos-traccion-content" style="padding: 2rem;">
                    <div class="ensayos-traccion-header" style="margin-bottom: 2rem;">
                        <h2 style="margin: 0 0 0.5rem 0; color: var(--text-main);">Informes Tracción</h2>
                        <p style="color: var(--text-muted); margin: 0;">Consulta los informes de tracción</p>
                    </div>
                    <div class="filter-bar"
                        style="display: flex; gap: 1rem; margin-bottom: 1rem; padding: 1rem; background: var(--bg-card); border-radius: 8px; box-shadow: var(--shadow-sm); flex-wrap: wrap; align-items: flex-end;">
                        <button id="buscarEnsayosTraccionBtn" class="btn-primary"
                            style="padding: 0.5rem 1.5rem; border-radius: 6px; border: none; background: var(--primary); color: white; cursor: pointer; font-weight: 500;">
                            <i class="ri-refresh-line"></i> Cargar Datos
                        </button>
                    </div>
                    <div class="table-card">
                        <div class="table-wrapper">
                            <table id="ensayosTraccionTable" style="table-layout: fixed; width: 100%;">
                                <thead>
                                    <tr>
                                        <th>Fecha</th>
                                        <th>Artículo</th>
                                        <th>Tratamiento</th>
                                        <th>Rm</th>
                                        <th>Rp0.2</th>
                                        <th>A%</th>
                                    </tr>
                                </thead>
                                <tbody id="ensayosTraccionTableBody"></tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Ensayos Metalografia View -->
            <div id="ensayosMetalografiaView" class="view-section">
                <div class="ensayos-metalografia-content" style="padding: 2rem;">
                    <div class="ensayos-metalografia-header" style="margin-bottom: 2rem;">
                        <h2 style="margin: 0 0 0.5rem 0; color: var(--text-main);">Informes Metalografía</h2>
                        <p style="color: var(--text-muted); margin: 0;">Consulta los informes metalográficos</p>
                    </div>
                    <div class="filter-bar"
                        style="display: flex; gap: 1rem; margin-bottom: 1rem; padding: 1rem; background: var(--bg-card); border-radius: 8px; box-shadow: var(--shadow-sm); flex-wrap: wrap; align-items: flex-end;">
                        <button id="buscarEnsayosMetalografiaBtn" class="btn-primary"
                            style="padding: 0.5rem 1.5rem; border-radius: 6px; border: none; background: var(--primary); color: white; cursor: pointer; font-weight: 500;">
                            <i class="ri-refresh-line"></i> Cargar Datos
                        </button>
                    </div>
                    <div class="table-card">
                        <div class="table-wrapper">
                            <table id="ensayosMetalografiaTable" style="table-layout: fixed; width: 100%;">
                                <thead>
                                    <tr>
                                        <th>Fecha</th>
                                        <th>Artículo</th>
                                        <th>Tratamiento</th>
                                        <th>Observaciones</th>
                                    </tr>
                                </thead>
                                <tbody id="ensayosMetalografiaTableBody"></tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>


            <!-- Personal Dashboard View -->
            <div id="personal-dashboardView" class="view-section">
                <div style="padding: 2rem;">

                    <!-- Filter Bar -->
                    <div class="filter-bar"
                        style="display: flex; gap: 1rem; margin-bottom: 1.5rem; padding: 1rem; background: var(--bg-card); border-radius: 8px; box-shadow: var(--shadow-sm); flex-wrap: wrap; align-items: flex-end;">
                        <div class="filter-group" style="display: flex; flex-direction: column; gap: 0.25rem;">
                            <label style="font-weight: 500; font-size: 0.875rem;">Año:</label>
                            <select id="personalDashboardYear"
                                style="padding: 0.5rem 1rem; border-radius: 6px; border: 1px solid var(--border); background: var(--bg-card); color: var(--text-main); min-width: 100px;">
                                <option value="2025">2025</option>
                                <option value="2024">2024</option>
                                <option value="2023">2023</option>
                                <option value="2022">2022</option>
                            </select>
                        </div>
                        <div class="filter-group" style="display: flex; flex-direction: column; gap: 0.25rem;">
                            <label style="font-weight: 500; font-size: 0.875rem;">Mes:</label>
                            <select id="personalDashboardMonth"
                                style="padding: 0.5rem 1rem; border-radius: 6px; border: 1px solid var(--border); background: var(--bg-card); color: var(--text-main); min-width: 120px;">
                                <option value="">Todos</option>
                                <option value="1">Enero</option>
                                <option value="2">Febrero</option>
                                <option value="3">Marzo</option>
                                <option value="4">Abril</option>
                                <option value="5">Mayo</option>
                                <option value="6">Junio</option>
                                <option value="7">Julio</option>
                                <option value="8">Agosto</option>
                                <option value="9">Septiembre</option>
                                <option value="10">Octubre</option>
                                <option value="11">Noviembre</option>
                                <option value="12">Diciembre</option>
                            </select>
                        </div>
                        <div class="filter-group" style="display: flex; flex-direction: column; gap: 0.25rem;">
                            <label style="font-weight: 500; font-size: 0.875rem;">Sección:</label>
                            <select id="personalDashboardSeccion"
                                style="padding: 0.5rem 1rem; border-radius: 6px; border: 1px solid var(--border); background: var(--bg-card); color: var(--text-main); min-width: 200px;">
                                <option value="">Todas</option>
                            </select>
                        </div>
                        <button id="personalDashboardRefresh" class="btn-primary"
                            style="padding: 0.5rem 1.5rem; border-radius: 6px; border: none; background: var(--primary); color: white; cursor: pointer; font-weight: 500;">
                            <i class="ri-refresh-line"></i> Actualizar
                        </button>
                        <button id="exportPersonalPdf" class="btn-secondary"
                            style="padding: 0.5rem 1rem; border-radius: 6px; border: 1px solid var(--border); background: var(--bg-card); color: var(--text-main); cursor: pointer; margin-left: auto;">
                            <i class="ri-file-pdf-line"></i> Imprimir
                        </button>
                    </div>

                    <!-- KPI Cards -->
                    <div class="kpi-grid" style="margin-bottom: 2rem;">
                        <div class="kpi-card">
                            <div class="kpi-icon"
                                style="background: linear-gradient(135deg, #10b981 0%, #34d399 100%);">
                                <i class="ri-user-line" style="font-size: 1.5rem;"></i>
                            </div>
                            <div class="kpi-info">
                                <h3>Total Empleados</h3>
                                <p class="kpi-value" id="personalKpiEmpleados">--</p>
                            </div>
                        </div>
                        <div class="kpi-card">
                            <div class="kpi-icon"
                                style="background: linear-gradient(135deg, #3b82f6 0%, #60a5fa 100%);">
                                <i class="ri-time-line" style="font-size: 1.5rem;"></i>
                            </div>
                            <div class="kpi-info">
                                <h3>Horas Totales</h3>
                                <p class="kpi-value" id="personalKpiHorasMes">--</p>
                                <span class="kpi-trend" style="font-size: 0.75rem; color: var(--text-muted);">
                                    Trabajo: <span id="personalKpiHorasTrabajo">--</span> | Ausencia: <span
                                        id="personalKpiHorasAusencia">--</span>
                                </span>
                            </div>
                        </div>
                        <div class="kpi-card">
                            <div class="kpi-icon"
                                style="background: linear-gradient(135deg, #f59e0b 0%, #fbbf24 100%);">
                                <i class="ri-alert-line" style="font-size: 1.5rem;"></i>
                            </div>
                            <div class="kpi-info">
                                <h3>Registros Fuera de Rango</h3>
                                <p class="kpi-value" id="personalKpiOutliers">--</p>
                                <span class="kpi-trend" style="font-size: 0.7rem;">Días con &lt;7.75h o &gt;8.25h</span>
                            </div>
                        </div>
                        <div class="kpi-card">
                            <div class="kpi-icon"
                                style="background: linear-gradient(135deg, #8b5cf6 0%, #a78bfa 100%);">
                                <i class="ri-bar-chart-grouped-line" style="font-size: 1.5rem;"></i>
                            </div>
                            <div class="kpi-info">
                                <h3>Media Horas/Día</h3>
                                <p class="kpi-value" id="personalKpiMedia">--</p>
                            </div>
                        </div>
                    </div>

                    <!-- Charts Row -->
                    <div class="charts-row">
                        <div class="chart-card large">
                            <div class="card-header"
                                style="display: flex; justify-content: space-between; align-items: center;">
                                <h3>Evolución de Horas (Mensual por Sección)</h3>
                                <div style="display: flex; gap: 0.5rem;">
                                    <button id="personalEvolutionTrabajo" class="btn-toggle active"
                                        style="padding: 0.25rem 0.75rem; border-radius: 4px; border: 1px solid var(--primary); background: var(--primary); color: white; cursor: pointer; font-size: 0.75rem;">
                                        Trabajo
                                    </button>
                                    <button id="personalEvolutionAusencia" class="btn-toggle"
                                        style="padding: 0.25rem 0.75rem; border-radius: 4px; border: 1px solid var(--border); background: var(--bg-card); color: var(--text-main); cursor: pointer; font-size: 0.75rem;">
                                        Ausencia
                                    </button>
                                    <button id="personalEvolutionCombinado" class="btn-toggle"
                                        style="padding: 0.25rem 0.75rem; border-radius: 4px; border: 1px solid var(--border); background: var(--bg-card); color: var(--text-main); cursor: pointer; font-size: 0.75rem;">
                                        Combinado
                                    </button>
                                </div>
                            </div>
                            <div class="chart-container">
                                <canvas id="personalHorasEvolucionChart"></canvas>
                            </div>
                        </div>
                        <div class="chart-card small">
                            <div class="card-header">
                                <h3>Horas por Sección</h3>
                            </div>
                            <div class="chart-container">
                                <canvas id="personalHorasSeccionChart"></canvas>
                            </div>
                        </div>
                    </div>

                    <!-- Top Sections Table -->
                    <div class="chart-card full-width" style="margin-top: 1.5rem;">
                        <div class="card-header">
                            <h3>Resumen por Sección</h3>
                        </div>
                        <div class="table-wrapper">
                            <table id="personalSeccionesTable" style="min-width: 100%;">
                                <thead>
                                    <tr>
                                        <th>Sección</th>
                                        <th style="text-align: center;">Período</th>
                                        <th style="text-align: center;">Empleados</th>
                                        <th style="text-align: center;">Horas Trabajo</th>
                                        <th style="text-align: center;">Horas Ausencia</th>
                                        <th style="text-align: center;">% Ausencia</th>
                                        <th style="text-align: center;">Total Horas</th>
                                    </tr>
                                </thead>
                                <tbody id="personalSeccionesBody">
                                    <tr>
                                        <td colspan="7" style="text-align: center; color: var(--text-muted);">
                                            Cargando...</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Bonos View -->
            <div id="bonosView" class="view-section">
                <div class="bonos-content" style="padding: 2rem;">

                    <div class="filter-bar"
                        style="display: flex; gap: 1rem; margin-bottom: 1rem; padding: 1rem; background: var(--bg-card); border-radius: 8px; box-shadow: var(--shadow-sm); flex-wrap: wrap; align-items: flex-end;">
                        <div class="filter-group" style="display: flex; flex-direction: column; gap: 0.25rem;">
                            <label style="font-weight: 500; font-size: 0.875rem;">Nombre:</label>
                            <select id="bonosNombreFilter"
                                style="padding: 0.5rem 1rem; border-radius: 6px; border: 1px solid var(--border); background: var(--bg-card); color: var(--text-main); width: 250px;">
                                <option value="">Todos</option>
                            </select>
                        </div>
                        <div class="filter-group" style="display: flex; flex-direction: column; gap: 0.25rem;">
                            <label style="font-weight: 500; font-size: 0.875rem;">Desde:</label>
                            <input type="date" id="bonosFechaDesdeFilter"
                                style="padding: 0.5rem 1rem; border-radius: 6px; border: 1px solid var(--border); background: var(--bg-card); color: var(--text-main);">
                        </div>
                        <div class="filter-group" style="display: flex; flex-direction: column; gap: 0.25rem;">
                            <label style="font-weight: 500; font-size: 0.875rem;">Hasta:</label>
                            <input type="date" id="bonosFechaHastaFilter"
                                style="padding: 0.5rem 1rem; border-radius: 6px; border: 1px solid var(--border); background: var(--bg-card); color: var(--text-main);">
                        </div>
                        <div class="filter-group" style="display: flex; flex-direction: column; gap: 0.25rem;">
                            <label style="font-weight: 500; font-size: 0.875rem;">Sección:</label>
                            <select id="bonosSeccionFilter"
                                style="padding: 0.5rem 1rem; border-radius: 6px; border: 1px solid var(--border); background: var(--bg-card); color: var(--text-main); min-width: 200px;">
                                <option value="">Todas</option>
                            </select>
                        </div>
                        <div class="filter-group"
                            style="display: flex; align-items: center; gap: 0.5rem; padding-bottom: 0.5rem;">
                            <input type="checkbox" id="bonosOutliersFilter"
                                style="width: 1.1rem; height: 1.1rem; cursor: pointer; accent-color: var(--primary);">
                            <label for="bonosOutliersFilter"
                                style="font-weight: 500; font-size: 0.875rem; cursor: pointer;">Fuera de rango</label>
                        </div>
                        <button id="buscarBonosBtn" class="btn-primary"
                            style="padding: 0.5rem 1.5rem; border-radius: 6px; border: none; background: var(--primary); color: white; cursor: pointer; font-weight: 500;">
                            <i class="ri-search-line"></i> Buscar
                        </button>
                        <button id="printBonosBtn" class="btn-secondary"
                            style="margin-left: auto; padding: 0.5rem 1.5rem; border-radius: 6px; border: 1px solid var(--border); background: var(--bg-card); color: var(--text-main); cursor: pointer; font-weight: 500;">
                            <i class="ri-printer-line"></i> Imprimir
                        </button>
                    </div>

                    <div
                        style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                        <span id="bonosResultCount" style="color: var(--text-muted); font-size: 0.9rem;"></span>
                        <div style="display: flex; gap: 0.5rem; align-items: center;">
                            <button id="bonosPrevBtn" class="btn-pagination"
                                style="padding: 0.5rem 1rem; border-radius: 6px; border: 1px solid var(--border); background: var(--bg-card); color: var(--text-main); cursor: pointer;">
                                <i class="ri-arrow-left-s-line"></i> Anterior
                            </button>
                            <span id="bonosPageInfo" style="font-size: 0.875rem;"></span>
                            <button id="bonosNextBtn" class="btn-pagination"
                                style="padding: 0.5rem 1rem; border-radius: 6px; border: 1px solid var(--border); background: var(--bg-card); color: var(--text-main); cursor: pointer;">
                                Siguiente <i class="ri-arrow-right-s-line"></i>
                            </button>
                        </div>
                    </div>

                    <div class="table-card">
                        <div class="table-wrapper">
                            <table id="bonosTable" style="table-layout: fixed; width: 100%;">
                                <thead style="height: 50px;">
                                    <tr>
                                        <th style="width: 100px; cursor: pointer;"
                                            onclick="handleBonosSort('operario')">
                                            Operario <i class="ri-arrow-up-down-line sort-icon"
                                                id="sort-bonos-operario"></i>
                                        </th>
                                        <th style="width: 100px; cursor: pointer;" onclick="handleBonosSort('fecha')">
                                            Fecha <i class="ri-arrow-up-down-line sort-icon" id="sort-bonos-fecha"></i>
                                        </th>
                                        <th style="width: 200px; cursor: pointer;" onclick="handleBonosSort('nombre')">
                                            Nombre <i class="ri-arrow-up-down-line sort-icon"
                                                id="sort-bonos-nombre"></i>
                                        </th>
                                        <th style="width: 80px; cursor: pointer;" onclick="handleBonosSort('seccion')">
                                            Sección <i class="ri-arrow-up-down-line sort-icon"
                                                id="sort-bonos-seccion"></i>
                                        </th>
                                        <th style="width: 150px; cursor: pointer;"
                                            onclick="handleBonosSort('nombreSeccion')">
                                            Nombre Sección <i class="ri-arrow-up-down-line sort-icon"
                                                id="sort-bonos-nombreSeccion"></i>
                                        </th>
                                        <th style="width: 100px; text-align: center; cursor: pointer;"
                                            onclick="handleBonosSort('horasTrabajo')">
                                            Horas Trabajo <i class="ri-arrow-up-down-line sort-icon"
                                                id="sort-bonos-horasTrabajo"></i>
                                        </th>
                                        <th style="width: 100px; text-align: center; cursor: pointer;"
                                            onclick="handleBonosSort('horasAusencia')">
                                            Horas Ausencia <i class="ri-arrow-up-down-line sort-icon"
                                                id="sort-bonos-horasAusencia"></i>
                                        </th>
                                        <th style="width: 100px; text-align: center; cursor: pointer;"
                                            onclick="handleBonosSort('totalHoras')">
                                            Total Horas <i class="ri-arrow-up-down-line sort-icon"
                                                id="sort-bonos-totalHoras"></i>
                                        </th>
                                    </tr>
                                </thead>
                                <tbody id="bonosTableBody"></tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Calidad Rechazos Dashboard View -->
            <div id="calidadRechazosView" class="view-section">
                <div style="padding: 2rem;">
                    <!-- Filters -->
                    <div
                        style="margin-bottom: 2rem; display: flex; gap: 1rem; align-items: center; flex-wrap: wrap; padding: 1rem; background: var(--bg-card); border-radius: 8px; box-shadow: var(--shadow-sm);">
                        <div class="filter-group" style="display: flex; flex-direction: column; gap: 0.25rem;">
                            <label style="font-weight: 500; font-size: 0.875rem;">Año:</label>
                            <select id="calidadYearFilter"
                                style="padding: 0.5rem 1rem; border-radius: 6px; border: 1px solid var(--border); background: var(--bg-card); color: var(--text-main); min-width: 100px;">
                                <option value="2025" selected>2025</option>
                                <option value="2024">2024</option>
                                <option value="2023">2023</option>
                            </select>
                        </div>
                        <div class="filter-group" style="display: flex; flex-direction: column; gap: 0.25rem;">
                            <label style="font-weight: 500; font-size: 0.875rem;">Mes:</label>
                            <select id="calidadMonthFilter"
                                style="padding: 0.5rem 1rem; border-radius: 6px; border: 1px solid var(--border); background: var(--bg-card); color: var(--text-main); min-width: 120px;">
                                <option value="">Todos</option>
                                <option value="1">Enero</option>
                                <option value="2">Febrero</option>
                                <option value="3">Marzo</option>
                                <option value="4">Abril</option>
                                <option value="5">Mayo</option>
                                <option value="6">Junio</option>
                                <option value="7">Julio</option>
                                <option value="8">Agosto</option>
                                <option value="9">Septiembre</option>
                                <option value="10">Octubre</option>
                                <option value="11">Noviembre</option>
                                <option value="12">Diciembre</option>
                            </select>
                        </div>
                        <div class="filter-group" style="display: flex; flex-direction: column; gap: 0.25rem;">
                            <label style="font-weight: 500; font-size: 0.875rem;">Sección:</label>
                            <select id="calidadSeccionFilter"
                                style="padding: 0.5rem 1rem; border-radius: 6px; border: 1px solid var(--border); background: var(--bg-card); color: var(--text-main); min-width: 200px;">
                                <option value="">Todas</option>
                            </select>
                        </div>
                        <div class="filter-group" style="display: flex; flex-direction: column; gap: 0.25rem;">
                            <label style="font-weight: 500; font-size: 0.875rem;">Tipo Sección:</label>
                            <select id="calidadTipoSeccionFilter"
                                style="padding: 0.5rem 1rem; border-radius: 6px; border: 1px solid var(--border); background: var(--bg-card); color: var(--text-main); min-width: 150px;">
                                <option value="causa">Por Causa (Origen)</option>
                                <option value="deteccion">Por Detección (Operación)</option>
                            </select>
                        </div>
                        <button id="refreshCalidadDashboard" class="btn-primary"
                            style="padding: 0.5rem 1rem; border-radius: 6px; border: none; background: var(--primary); color: white; cursor: pointer; margin-top: 1.25rem;">
                            <i class="ri-refresh-line"></i> Actualizar
                        </button>
                        <button id="exportCalidadPdf" class="btn-secondary"
                            style="padding: 0.5rem 1rem; border-radius: 6px; border: 1px solid var(--border); background: var(--bg-card); color: var(--text-main); cursor: pointer; margin-top: 1.25rem; margin-left: auto;">
                            <i class="ri-file-pdf-line"></i> Exportar PDF
                        </button>
                    </div>

                    <!-- KPIs -->
                    <div class="kpi-grid"
                        style="margin-bottom: 2rem; display: grid; grid-template-columns: repeat(6, minmax(0, 1fr)); gap: 0.75rem;">
                        <div class="kpi-card">
                            <div class="kpi-icon"
                                style="background: linear-gradient(135deg, #ef4444 0%, #f87171 100%);">
                                <i class="ri-close-circle-line" style="font-size: 1.5rem;"></i>
                            </div>
                            <div class="kpi-info">
                                <h3>Total Piezas Rechazadas</h3>
                                <p class="kpi-value" id="calidadKpiPiezas">0</p>
                            </div>
                        </div>
                        <div class="kpi-card">
                            <div class="kpi-icon"
                                style="background: linear-gradient(135deg, #f59e0b 0%, #fbbf24 100%);">
                                <i class="ri-money-euro-circle-line" style="font-size: 1.5rem;"></i>
                            </div>
                            <div class="kpi-info">
                                <h3>Importe Total</h3>
                                <p class="kpi-value" id="calidadKpiImporte">0 €</p>
                            </div>
                        </div>
                        <div class="kpi-card">
                            <div class="kpi-icon"
                                style="background: linear-gradient(135deg, #3b82f6 0%, #60a5fa 100%);">
                                <i class="ri-error-warning-line" style="font-size: 1.5rem;"></i>
                            </div>
                            <div class="kpi-info">
                                <h3>Causas Diferentes</h3>
                                <p class="kpi-value" id="calidadKpiCausas">0</p>
                            </div>
                        </div>
                        <div class="kpi-card">
                            <div class="kpi-icon"
                                style="background: linear-gradient(135deg, #8b5cf6 0%, #a78bfa 100%);">
                                <i class="ri-box-3-line" style="font-size: 1.5rem;"></i>
                            </div>
                            <div class="kpi-info">
                                <h3>Artículos Afectados</h3>
                                <p class="kpi-value" id="calidadKpiArticulos">0</p>
                            </div>
                        </div>
                        <div class="kpi-card">
                            <div class="kpi-icon"
                                style="background: linear-gradient(135deg, #10b981 0%, #34d399 100%);">
                                <i class="ri-stack-line" style="font-size: 1.5rem;"></i>
                            </div>
                            <div class="kpi-info">
                                <h3>Total Piezas Fabricadas</h3>
                                <p class="kpi-value" id="calidadKpiProducidas">0</p>
                            </div>
                        </div>
                        <div class="kpi-card">
                            <div class="kpi-icon"
                                style="background: linear-gradient(135deg, #ec4899 0%, #f472b6 100%);">
                                <i class="ri-percent-line" style="font-size: 1.5rem;"></i>
                            </div>
                            <div class="kpi-info">
                                <h3>% Rechazo</h3>
                                <p class="kpi-value" id="calidadKpiPorcentaje">0 %</p>
                            </div>
                        </div>
                    </div>

                    <!-- Row 1: Causes Table + Pie Chart -->
                    <div class="charts-row"
                        style="display: grid; grid-template-columns: 2fr 1fr; gap: 1.5rem; margin-bottom: 2rem;">
                        <div class="chart-card"
                            style="background: var(--bg-card); padding: 1.5rem; border-radius: 12px; box-shadow: var(--shadow-sm);">
                            <h3 style="margin-bottom: 1rem; color: var(--text-main);">Causas de Rechazo</h3>
                            <div class="table-wrapper" style="max-height: 350px; overflow-y: auto;">
                                <table id="calidadCausasTable" style="width: 100%; min-width: auto;">
                                    <thead>
                                        <tr>
                                            <th style="width: 15%;">Código</th>
                                            <th style="width: 40%;">Descripción</th>
                                            <th style="width: 20%; text-align: center;">Piezas</th>
                                            <th style="width: 25%; text-align: right;">Importe €</th>
                                        </tr>
                                    </thead>
                                    <tbody id="calidadCausasBody">
                                        <tr>
                                            <td colspan="4" style="text-align: center; color: var(--text-muted);">
                                                Cargando...</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        <div class="chart-card"
                            style="background: var(--bg-card); padding: 1.5rem; border-radius: 12px; box-shadow: var(--shadow-sm);">
                            <h3 style="margin-bottom: 1rem; color: var(--text-main);">Distribución por Causa</h3>
                            <div style="height: 300px;"><canvas id="calidadPieChart"></canvas></div>
                        </div>
                    </div>

                    <!-- Row 2: Articles Table + Horizontal Bar Chart -->
                    <div class="charts-row" style="display: grid; grid-template-columns: 1fr 2fr; gap: 1.5rem;">
                        <div class="chart-card"
                            style="background: var(--bg-card); padding: 1.5rem; border-radius: 12px; box-shadow: var(--shadow-sm);">
                            <h3 style="margin-bottom: 1rem; color: var(--text-main);">Top 10 Artículos</h3>
                            <div class="table-wrapper" style="max-height: 300px; overflow-y: auto;">
                                <table id="calidadArticulosTable" style="width: 100%; min-width: auto;">
                                    <thead>
                                        <tr>
                                            <th style="width: 60%;">Artículo</th>
                                            <th style="width: 40%; text-align: right;">Importe €</th>
                                        </tr>
                                    </thead>
                                    <tbody id="calidadArticulosBody">
                                        <tr>
                                            <td colspan="2" style="text-align: center; color: var(--text-muted);">
                                                Cargando...</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        <div class="chart-card"
                            style="background: var(--bg-card); padding: 1.5rem; border-radius: 12px; box-shadow: var(--shadow-sm);">
                            <h3 style="margin-bottom: 1rem; color: var(--text-main);">Importe por Artículo</h3>
                            <div style="height: 300px;"><canvas id="calidadArticulosChart"></canvas></div>
                        </div>
                    </div>

                    <!-- Row 3: Evolution Chart -->
                    <div class="charts-row" style="margin-top: 1.5rem;">
                        <div class="chart-card"
                            style="background: var(--bg-card); padding: 1.5rem; border-radius: 12px; box-shadow: var(--shadow-sm); width: 100%;">
                            <div
                                style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                                <h3 style="color: var(--text-main); margin: 0;">Evolución Mensual por Sección</h3>
                                <div style="display: flex; gap: 0.5rem;">
                                    <button id="calidadEvolutionImporte" class="btn-toggle active"
                                        style="padding: 0.25rem 0.75rem; border-radius: 4px; border: 1px solid var(--primary); background: var(--primary); color: white; cursor: pointer; font-size: 0.75rem;">
                                        Importe
                                    </button>
                                    <button id="calidadEvolutionPiezas" class="btn-toggle"
                                        style="padding: 0.25rem 0.75rem; border-radius: 4px; border: 1px solid var(--border); background: var(--bg-card); color: var(--text-main); cursor: pointer; font-size: 0.75rem;">
                                        Piezas
                                    </button>
                                </div>
                            </div>
                            <div style="height: 350px;"><canvas id="calidadEvolutionChart"></canvas></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- OTD (On-Time Delivery) View -->
            <div id="otdView" class="view-section">
                <div style="padding: 1.5rem;">


                    <!-- Filter Bar -->
                    <div
                        style="display: flex; gap: 1rem; margin-bottom: 1.5rem; padding: 1rem; background: var(--bg-card); border-radius: 8px; box-shadow: var(--shadow-sm); flex-wrap: wrap; align-items: center;">
                        <div class="filter-group" style="display: flex; align-items: center; gap: 0.5rem;">
                            <label for="otdAnoFilter" style="font-weight: 500;">Año:</label>
                            <select id="otdAnoFilter"
                                style="padding: 0.5rem 1rem; border-radius: 6px; border: 1px solid var(--border); background: var(--bg-card); color: var(--text-main); min-width: 100px;">
                                <option value="">Cargando...</option>
                            </select>
                        </div>

                        <div class="filter-group" style="display: flex; align-items: center; gap: 0.5rem;">
                            <label for="otdClienteFilter" style="font-weight: 500;">Cliente:</label>
                            <select id="otdClienteFilter"
                                style="padding: 0.5rem 1rem; border-radius: 6px; border: 1px solid var(--border); background: var(--bg-card); color: var(--text-main); min-width: 200px;">
                                <option value="">Todos</option>
                            </select>
                        </div>

                        <div class="filter-group" style="display: flex; align-items: center; gap: 0.5rem;">
                            <label for="otdFamiliaFilter" style="font-weight: 500;">Familia:</label>
                            <!-- Custom Multi-Select Dropdown for Familia -->
                            <div id="otdFamiliaDropdown" style="position: relative; min-width: 200px;">
                                <div id="otdFamiliaSelected" tabindex="0"
                                    style="padding: 0.5rem 1rem; border-radius: 6px; border: 1px solid var(--border); background: var(--bg-card); color: var(--text-main); cursor: pointer; display: flex; align-items: center; justify-content: space-between; min-width: 200px; font-size: 0.875rem;">
                                    <span id="otdFamiliaSelectedText">Todas</span>
                                    <i class="ri-arrow-down-s-line"></i>
                                </div>
                                <div id="otdFamiliaOptions"
                                    style="display: none; position: absolute; top: 100%; left: 0; min-width: 280px; max-height: 300px; overflow-y: auto; background: var(--bg-card); border: 1px solid var(--border); border-radius: 6px; box-shadow: var(--shadow-md); z-index: 50; padding: 0.5rem;">
                                    <span
                                        style="color: var(--text-muted); padding: 0.5rem; display: block;">Cargando...</span>
                                </div>
                            </div>
                        </div>

                        <div class="filter-group" style="display: flex; align-items: center; gap: 0.5rem;">
                            <label for="otdArticuloFilter" style="font-weight: 500;">Artículo:</label>
                            <input type="text" id="otdArticuloFilter" placeholder="Código..."
                                style="padding: 0.5rem 1rem; border-radius: 6px; border: 1px solid var(--border); background: var(--bg-card); color: var(--text-main); width: 100px;">
                        </div>
                        <button id="buscarOtdBtn"
                            style="padding: 0.5rem 1.5rem; border-radius: 6px; border: none; background: linear-gradient(135deg, var(--primary), #667eea); color: white; cursor: pointer; font-weight: 500; display: flex; align-items: center; gap: 0.5rem;">
                            <i class="ri-search-line"></i> Buscar
                        </button>
                    </div>

                    <!-- Métricas de Cumplimiento Table -->
                    <div class="chart-card"
                        style="background: var(--bg-card); border-radius: 8px; box-shadow: var(--shadow-sm); margin-bottom: 1.5rem; overflow: hidden;">
                        <div class="table-wrapper" style="overflow-x: hidden;">
                            <table id="otdMetricsTable" class="otd-metrics-table"
                                style="width: 100%; border-collapse: collapse; font-size: 0.875rem;">
                                <thead>
                                    <tr style="background: #0078d4; color: white;">
                                        <th
                                            style="padding: 0.75rem; text-align: left; border: 1px solid #005a9e; width: 200px;">
                                            Tipo</th>
                                        <th
                                            style="padding: 0.5rem; text-align: center; border: 1px solid #005a9e; width: 60px;">
                                            ene
                                        </th>
                                        <th
                                            style="padding: 0.5rem; text-align: center; border: 1px solid #005a9e; width: 60px;">
                                            feb
                                        </th>
                                        <th
                                            style="padding: 0.5rem; text-align: center; border: 1px solid #005a9e; width: 60px;">
                                            mar
                                        </th>
                                        <th
                                            style="padding: 0.5rem; text-align: center; border: 1px solid #005a9e; width: 60px;">
                                            abr
                                        </th>
                                        <th
                                            style="padding: 0.5rem; text-align: center; border: 1px solid #005a9e; width: 60px;">
                                            may
                                        </th>
                                        <th
                                            style="padding: 0.5rem; text-align: center; border: 1px solid #005a9e; width: 60px;">
                                            jun
                                        </th>
                                        <th
                                            style="padding: 0.5rem; text-align: center; border: 1px solid #005a9e; width: 60px;">
                                            jul
                                        </th>
                                        <th
                                            style="padding: 0.5rem; text-align: center; border: 1px solid #005a9e; width: 60px;">
                                            ago
                                        </th>
                                        <th
                                            style="padding: 0.5rem; text-align: center; border: 1px solid #005a9e; width: 60px;">
                                            sep
                                        </th>
                                        <th
                                            style="padding: 0.5rem; text-align: center; border: 1px solid #005a9e; width: 60px;">
                                            oct
                                        </th>
                                        <th
                                            style="padding: 0.5rem; text-align: center; border: 1px solid #005a9e; width: 60px;">
                                            nov
                                        </th>
                                        <th
                                            style="padding: 0.5rem; text-align: center; border: 1px solid #005a9e; width: 60px;">
                                            dic
                                        </th>
                                        <th
                                            style="padding: 0.5rem; text-align: center; border: 1px solid #16a34a; background: #16a34a; font-weight: 700; width: 70px; color: white;">
                                            Total</th>
                                    </tr>
                                </thead>
                                <tbody id="otdMetricsBody">
                                    <tr>
                                        <td colspan="14"
                                            style="text-align: center; padding: 2rem; color: var(--text-muted);">
                                            Cargando...</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Row: Piezas Table (100% width) -->
                    <div style="margin-bottom: 1.5rem;">
                        <!-- Piezas Table -->
                        <div class="chart-card"
                            style="background: var(--bg-card); border-radius: 8px; box-shadow: var(--shadow-sm); overflow: hidden;">
                            <div class="table-wrapper" style="overflow-x: hidden;">
                                <table id="otdPiezasTable" class="otd-metrics-table"
                                    style="width: 100%; border-collapse: collapse; font-size: 0.875rem;">
                                    <thead>
                                        <tr style="background: #0078d4; color: white;">
                                            <th
                                                style="padding: 0.75rem; text-align: left; border: 1px solid #005a9e; min-width: 180px; width: 200px;">
                                                Tipo</th>
                                            <th
                                                style="padding: 0.5rem; text-align: center; border: 1px solid #005a9e; width: 60px;">
                                                ene</th>
                                            <th
                                                style="padding: 0.5rem; text-align: center; border: 1px solid #005a9e; width: 60px;">
                                                feb</th>
                                            <th
                                                style="padding: 0.5rem; text-align: center; border: 1px solid #005a9e; width: 60px;">
                                                mar</th>
                                            <th
                                                style="padding: 0.5rem; text-align: center; border: 1px solid #005a9e; width: 60px;">
                                                abr</th>
                                            <th
                                                style="padding: 0.5rem; text-align: center; border: 1px solid #005a9e; width: 60px;">
                                                may</th>
                                            <th
                                                style="padding: 0.5rem; text-align: center; border: 1px solid #005a9e; width: 60px;">
                                                jun</th>
                                            <th
                                                style="padding: 0.5rem; text-align: center; border: 1px solid #005a9e; width: 60px;">
                                                jul</th>
                                            <th
                                                style="padding: 0.5rem; text-align: center; border: 1px solid #005a9e; width: 60px;">
                                                ago</th>
                                            <th
                                                style="padding: 0.5rem; text-align: center; border: 1px solid #005a9e; width: 60px;">
                                                sep</th>
                                            <th
                                                style="padding: 0.5rem; text-align: center; border: 1px solid #005a9e; width: 60px;">
                                                oct</th>
                                            <th
                                                style="padding: 0.5rem; text-align: center; border: 1px solid #005a9e; width: 60px;">
                                                nov</th>
                                            <th
                                                style="padding: 0.5rem; text-align: center; border: 1px solid #005a9e; width: 60px;">
                                                dic</th>
                                            <th
                                                style="padding: 0.5rem; text-align: center; border: 1px solid #16a34a; background: #16a34a; font-weight: 700; width: 70px; color: white;">
                                                Total</th>
                                        </tr>
                                    </thead>
                                    <tbody id="otdPiezasBody">
                                        <tr>
                                            <td colspan="14"
                                                style="text-align: center; padding: 2rem; color: var(--text-muted);">
                                                Cargando...</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- Row: Chart + TODOS + RECHAZADAS (33% each) -->
                    <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 1.5rem; margin-bottom: 1.5rem;">
                        <!-- Chart: % Cumplimiento -->
                        <div class="chart-card"
                            style="background: var(--bg-card); padding: 1.5rem; border-radius: 8px; box-shadow: var(--shadow-sm);">
                            <h3 style="margin: 0 0 1rem 0; color: var(--text-main); font-size: 1rem;">CUMPLIMIENTO
                                ENTREGAS (%)</h3>
                            <div style="height: 250px;"><canvas id="otdCumplimientoChart"></canvas></div>
                        </div>

                        <!-- Top Artículos TODOS -->
                        <div class="chart-card"
                            style="background: var(--bg-card); padding: 1rem; border-radius: 8px; box-shadow: var(--shadow-sm);">
                            <h3 style="margin: 0 0 0.75rem 0; color: #0078d4; font-size: 0.875rem; font-weight: 600;">
                                TODOS</h3>
                            <div class="table-wrapper" style="max-height: 250px; overflow-y: auto; overflow-x: hidden;">
                                <table id="otdArticulosTable"
                                    style="width: 100%; border-collapse: collapse; font-size: 0.8rem; table-layout: fixed;">
                                    <thead>
                                        <tr style="background: #0078d4; color: white;">
                                            <th style="padding: 0.5rem; text-align: left; width: 70%;">artículo</th>
                                            <th style="padding: 0.5rem; text-align: right; width: 30%;">Cant</th>
                                        </tr>
                                    </thead>
                                    <tbody id="otdArticulosBody">
                                        <tr>
                                            <td colspan="2"
                                                style="text-align: center; padding: 1rem; color: var(--text-muted);">
                                                Cargando...</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <!-- Rechazados -->
                        <div class="chart-card"
                            style="background: var(--bg-card); padding: 1rem; border-radius: 8px; box-shadow: var(--shadow-sm); min-width: 0;">

                            <h3 style="margin: 0 0 0.75rem 0; color: #dc2626; font-size: 0.875rem; font-weight: 600;">
                                RECHAZADAS</h3>

                            <div class="table-wrapper" style="max-height: 250px; overflow-y: auto; overflow-x: hidden;">

                                <table id="otdRechazadosTable"
                                    style="width: 100%; border-collapse: collapse; font-size: 0.8rem; table-layout: fixed;">
                                    <thead>
                                        <tr style="background: #dc2626; color: white;">
                                            <th style="padding: 0.5rem; text-align: left; width: 70%;">artículo</th>
                                            <th style="padding: 0.5rem; text-align: right; width: 30%;">Cant</th>
                                        </tr>
                                    </thead>
                                    <tbody id="otdRechazadosBody">
                                        <tr>
                                            <td colspan="2"
                                                style="text-align: center; padding: 1rem; color: var(--text-muted);">
                                                Cargando...</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- Detalle Albaranes Table -->
                    <div class="table-card" style="margin-top: 1.5rem;">
                        <div
                            style="padding: 1rem 1.5rem; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 1rem;">
                            <h3 style="margin: 0; font-size: 1.125rem; font-weight: 600;"><i class="ri-truck-line"
                                    style="margin-right: 0.5rem; color: var(--primary);"></i>Detalle de Entregas</h3>
                            <div style="display: flex; align-items: center; gap: 1rem;">
                                <span id="otdPaginationInfo" style="font-size: 0.875rem; color: var(--text-muted);">
                                    Mostrando 0 de 0
                                </span>
                            </div>
                        </div>
                        <div class="table-wrapper" style="max-height: 400px; overflow-y: auto;">
                            <table id="otdDetalleTable" style="width: 100%; min-width: 1000px;">
                                <thead style="position: sticky; top: 0; background: var(--bg-card); z-index: 1;">
                                    <tr>
                                        <th style="width: 40px; text-align: center;">Nº</th>
                                        <th style="width: 100px; cursor: pointer;" data-sort="numAlbaran">
                                            Nº Albarán <i class="ri-arrow-up-down-line"
                                                style="font-size: 0.75rem; opacity: 0.5;"></i>
                                        </th>
                                        <th style="width: 120px; cursor: pointer;" data-sort="articulo">
                                            Artículo <i class="ri-arrow-up-down-line"
                                                style="font-size: 0.75rem; opacity: 0.5;"></i>
                                        </th>
                                        <th style="width: 100px; text-align: right; cursor: pointer;"
                                            data-sort="cantidadPedida">
                                            Pedida <i class="ri-arrow-up-down-line"
                                                style="font-size: 0.75rem; opacity: 0.5;"></i>
                                        </th>
                                        <th style="width: 100px; text-align: right; cursor: pointer;"
                                            data-sort="cantidadServida">
                                            Servida <i class="ri-arrow-up-down-line"
                                                style="font-size: 0.75rem; opacity: 0.5;"></i>
                                        </th>
                                        <th style="width: 100px; cursor: pointer;" data-sort="fechaAlbaran">
                                            F.Albarán <i class="ri-arrow-up-down-line"
                                                style="font-size: 0.75rem; opacity: 0.5;"></i>
                                        </th>
                                        <th style="width: 100px; cursor: pointer;" data-sort="fechaEntrega">
                                            F.Entrega <i class="ri-arrow-up-down-line"
                                                style="font-size: 0.75rem; opacity: 0.5;"></i>
                                        </th>
                                        <th style="width: 70px; text-align: center; cursor: pointer;"
                                            data-sort="diferenciaDias">
                                            Días <i class="ri-arrow-up-down-line"
                                                style="font-size: 0.75rem; opacity: 0.5;"></i>
                                        </th>
                                        <th style="cursor: pointer;" data-sort="cliente">
                                            Cliente <i class="ri-arrow-up-down-line"
                                                style="font-size: 0.75rem; opacity: 0.5;"></i>
                                        </th>
                                    </tr>
                                </thead>
                                <tbody id="otdDetalleBody">
                                    <tr>
                                        <td colspan="9"
                                            style="text-align: center; padding: 2rem; color: var(--text-muted);">
                                            Cargando...</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        <div
                            style="padding: 0.75rem 1rem; border-top: 1px solid var(--border); display: flex; justify-content: flex-end; gap: 0.5rem;">
                            <button id="otdPrevPage" class="btn-pagination"
                                style="padding: 0.4rem 0.75rem; border-radius: 4px; border: 1px solid var(--border); background: var(--bg-card); color: var(--text-main); cursor: pointer;">
                                <i class="ri-arrow-left-s-line"></i> Anterior
                            </button>
                            <button id="otdNextPage" class="btn-pagination"
                                style="padding: 0.4rem 0.75rem; border-radius: 4px; border: 1px solid var(--border); background: var(--bg-card); color: var(--text-main); cursor: pointer;">
                                Siguiente <i class="ri-arrow-right-s-line"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- COMERCIAL Dashboard View -->
            <div id="comercial-dashboardView" class="view-section">
                <div style="padding: 1.5rem;">
                    <!-- Header con título y selector de año -->
                    <div
                        style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem; flex-wrap: wrap; gap: 1rem;">
                        <!-- Year Filter (left) -->
                        <div
                            style="display: flex; align-items: center; gap: 0.75rem; padding: 0.75rem 1rem; background: var(--bg-card); border-radius: 8px; box-shadow: var(--shadow-sm);">
                            <label for="comercialYearFilter"
                                style="font-weight: 600; color: var(--text-main);">Año:</label>
                            <select id="comercialYearFilter"
                                style="padding: 0.5rem 1rem; border-radius: 6px; border: 1px solid var(--border); background: var(--bg-card); color: var(--text-main); min-width: 100px; cursor: pointer;">
                                <option value="2026">2026</option>
                                <option value="2025" selected>2025</option>
                            </select>
                        </div>

                        <!-- AI Insight Placeholder (right) -->
                        <div
                            style="display: flex; align-items: center; gap: 0.75rem; padding: 0.5rem 1rem; background: rgba(88, 86, 214, 0.05); border: 1px solid rgba(88, 86, 214, 0.2); border-radius: 8px; flex: 1; max-width: 800px;">
                            <div
                                style="background: var(--bg-card); padding: 0.25rem; border-radius: 4px; border: 1px solid var(--border); display: flex; align-items: center; justify-content: center;">
                                <i class="ri-openai-fill" style="color: var(--primary); font-size: 1.2rem;"></i>
                            </div>
                            <span style="font-size: 0.85rem; color: var(--text-main); font-style: italic;">
                                <strong>Insight AI:</strong> Las ventas en 2025 muestran una tendencia positiva,
                                impulsadas por el crecimiento del 15% en el sector "Automoción".
                            </span>
                        </div>
                    </div>

                    <!-- Filter Bar with Checkboxes -->
                    <div
                        style="display: flex; gap: 1rem; margin-bottom: 1.5rem; padding: 1rem; background: var(--bg-card); border-radius: 8px; box-shadow: var(--shadow-sm); flex-wrap: wrap; align-items: flex-start;">
                        <!-- Tipo (checkboxes) -->
                        <div style="display: flex; flex-direction: column; gap: 0.25rem; flex: 1; min-width: 200px;">
                            <label style="font-weight: 600; font-size: 0.75rem; color: var(--text-muted);">Tipo</label>
                            <div id="comercialTipoContainer"
                                style="max-height: 120px; overflow-y: auto; padding: 0.5rem; border-radius: 6px; border: 1px solid var(--border); background: var(--bg); font-size: 0.8rem;">
                                <span style="color: var(--text-muted);">Cargando...</span>
                            </div>
                        </div>
                        <!-- Familia (checkboxes) -->
                        <div style="display: flex; flex-direction: column; gap: 0.25rem; flex: 1; min-width: 250px;">
                            <label
                                style="font-weight: 600; font-size: 0.75rem; color: var(--text-muted);">Familia</label>
                            <div id="comercialFamiliaContainer"
                                style="max-height: 120px; overflow-y: auto; padding: 0.5rem; border-radius: 6px; border: 1px solid var(--border); background: var(--bg); font-size: 0.8rem;">
                                <span style="color: var(--text-muted);">Selecciona un Tipo</span>
                            </div>
                        </div>
                        <!-- Subfamilia (checkboxes) -->
                        <div style="display: flex; flex-direction: column; gap: 0.25rem; flex: 1; min-width: 250px;">
                            <label
                                style="font-weight: 600; font-size: 0.75rem; color: var(--text-muted);">Subfamilia</label>
                            <div id="comercialSubfamiliaContainer"
                                style="max-height: 120px; overflow-y: auto; padding: 0.5rem; border-radius: 6px; border: 1px solid var(--border); background: var(--bg); font-size: 0.8rem;">
                                <span style="color: var(--text-muted);">Selecciona una Familia</span>
                            </div>
                        </div>
                        <!-- Clear filters button -->
                        <button onclick="clearComercialFilters()"
                            style="padding: 0.5rem 1rem; border-radius: 6px; border: 1px solid var(--border); background: var(--bg-card); color: var(--text-main); cursor: pointer; height: fit-content; align-self: flex-end;">
                            <i class="ri-filter-off-line"></i> Limpiar
                        </button>
                    </div>

                    <!-- KPIs -->
                    <div class="kpi-grid" style="margin-bottom: 1.5rem;">
                        <div class="kpi-card">
                            <div class="kpi-icon"
                                style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                                <i class="ri-money-euro-circle-line" style="font-size: 2rem;"></i>
                            </div>
                            <div class="kpi-info">
                                <h3>Ventas Totales</h3>
                                <p class="kpi-value" id="comercialKpiVentas">0 €</p>
                                <span class="kpi-trend" id="comercialKpiVentasTrend">Importe facturado</span>
                            </div>
                        </div>
                        <div class="kpi-card">
                            <div class="kpi-icon"
                                style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
                                <i class="ri-file-list-3-line" style="font-size: 2rem;"></i>
                            </div>
                            <div class="kpi-info">
                                <h3>Nº Facturas</h3>
                                <p class="kpi-value" id="comercialKpiFacturas">0</p>
                                <span class="kpi-trend">Facturas emitidas</span>
                            </div>
                        </div>
                        <div class="kpi-card">
                            <div class="kpi-icon"
                                style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">
                                <i class="ri-building-line" style="font-size: 2rem;"></i>
                            </div>
                            <div class="kpi-info">
                                <h3>Clientes Activos</h3>
                                <p class="kpi-value" id="comercialKpiClientes">0</p>
                                <span class="kpi-trend">Clientes con facturas</span>
                            </div>
                        </div>
                        <div class="kpi-card">
                            <div class="kpi-icon"
                                style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);">
                                <i class="ri-shopping-cart-line" style="font-size: 2rem;"></i>
                            </div>
                            <div class="kpi-info">
                                <h3>Ticket Medio</h3>
                                <p class="kpi-value" id="comercialKpiTicket">0 €</p>
                                <span class="kpi-trend">Por factura</span>
                            </div>
                        </div>
                    </div>

                    <!-- Gráficos Row -->
                    <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 1.5rem; margin-bottom: 1.5rem;">
                        <!-- Gráfico de Evolución Mensual -->
                        <div class="chart-card">
                            <div class="card-header">
                                <h3>Evolución de Ventas Mensual</h3>
                            </div>
                            <div class="chart-container" style="height: 300px;">
                                <canvas id="comercialVentasMensualesChart"></canvas>
                            </div>
                        </div>

                        <!-- Gráfico Comparativo Anual -->
                        <div class="chart-card">
                            <div class="card-header">
                                <h3>Comparativa Anual</h3>
                            </div>
                            <div class="chart-container" style="height: 300px;">
                                <canvas id="comercialEvolucionAnualChart"></canvas>
                            </div>
                        </div>
                    </div>

                    <!-- Top Clientes y Top Artículos -->
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem;">
                        <!-- Top 10 Clientes -->
                        <div class="chart-card">
                            <div class="card-header">
                                <h3><i class="ri-building-line"
                                        style="margin-right: 0.5rem; color: var(--primary);"></i>Top 10
                                    Clientes
                                </h3>
                            </div>
                            <div style="max-height: 350px; overflow-y: auto;">
                                <table class="responsive-dashboard-table"
                                    style="width: 100%; border-collapse: collapse; font-size: 0.8rem; table-layout: fixed;">
                                    <thead style="position: sticky; top: 0; background: var(--bg-card);">
                                        <tr style="border-bottom: 2px solid var(--border);">
                                            <th
                                                style="padding: 0.5rem 0.25rem; text-align: center; font-weight: 600; width: 25px;">
                                                #</th>
                                            <th style="padding: 0.5rem 0.25rem; text-align: left; font-weight: 600;">
                                                Cliente</th>
                                            <th
                                                style="padding: 0.5rem 0.25rem; text-align: right; font-weight: 600; width: 80px;">
                                                Ventas €</th>
                                            <th
                                                style="padding: 0.5rem 0.25rem; text-align: right; font-weight: 600; width: 40px;">
                                                Fact</th>
                                        </tr>
                                    </thead>
                                    <tbody id="comercialTopClientesBody">
                                        <tr>
                                            <td colspan="4"
                                                style="text-align: center; padding: 2rem; color: var(--text-muted);">
                                                Cargando...</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <!-- Top 10 Artículos -->
                        <div class="chart-card">
                            <div class="card-header">
                                <h3><i class="ri-box-3-line"
                                        style="margin-right: 0.5rem; color: var(--primary);"></i>Top 10
                                    Artículos</h3>
                            </div>
                            <div style="max-height: 350px; overflow-y: auto;">
                                <table class="responsive-dashboard-table"
                                    style="width: 100%; border-collapse: collapse; font-size: 0.8rem; table-layout: fixed;">
                                    <thead style="position: sticky; top: 0; background: var(--bg-card);">
                                        <tr style="border-bottom: 2px solid var(--border);">
                                            <th
                                                style="padding: 0.5rem 0.25rem; text-align: center; font-weight: 600; width: 25px;">
                                                #</th>
                                            <th
                                                style="padding: 0.5rem 0.25rem; text-align: left; font-weight: 600; width: 90px;">
                                                Artículo</th>
                                            <th style="padding: 0.5rem 0.25rem; text-align: left; font-weight: 600;">
                                                Cliente</th>
                                            <th
                                                style="padding: 0.5rem 0.25rem; text-align: right; font-weight: 600; width: 70px;">
                                                Ventas €</th>
                                        </tr>
                                    </thead>
                                    <tbody id="comercialTopArticulosBody">
                                        <tr>
                                            <td colspan="4"
                                                style="text-align: center; padding: 2rem; color: var(--text-muted);">
                                                Cargando...</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- Top Tipos y Top Familias -->
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; margin-top: 1.5rem;">
                        <!-- Top 10 Tipos -->
                        <div class="chart-card">
                            <div class="card-header">
                                <h3><i class="ri-price-tag-3-line"
                                        style="margin-right: 0.5rem; color: var(--primary);"></i>Top
                                    10 Tipos
                                </h3>
                            </div>
                            <div style="max-height: 350px; overflow-y: auto;">
                                <table class="responsive-dashboard-table"
                                    style="width: 100%; border-collapse: collapse; font-size: 0.8rem; table-layout: fixed;">
                                    <thead style="position: sticky; top: 0; background: var(--bg-card);">
                                        <tr style="border-bottom: 2px solid var(--border);">
                                            <th
                                                style="padding: 0.5rem 0.25rem; text-align: center; font-weight: 600; width: 40px;">
                                                #</th>
                                            <th
                                                style="padding: 0.5rem 0.25rem; text-align: left; font-weight: 600; width: 60px;">
                                                Código</th>
                                            <th style="padding: 0.5rem 0.25rem; text-align: left; font-weight: 600;">
                                                Denominación</th>
                                            <th
                                                style="padding: 0.5rem 0.25rem; text-align: right; font-weight: 600; width: 80px;">
                                                Ventas €</th>
                                        </tr>
                                    </thead>
                                    <tbody id="comercialTopTiposBody">
                                        <tr>
                                            <td colspan="4"
                                                style="text-align: center; padding: 2rem; color: var(--text-muted);">
                                                Cargando...</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <!-- Top 10 Familias -->
                        <div class="chart-card">
                            <div class="card-header">
                                <h3><i class="ri-folder-3-line"
                                        style="margin-right: 0.5rem; color: var(--primary);"></i>Top 10
                                    Familias
                                </h3>
                            </div>
                            <div style="max-height: 350px; overflow-y: auto;">
                                <table class="responsive-dashboard-table"
                                    style="width: 100%; border-collapse: collapse; font-size: 0.8rem; table-layout: fixed;">
                                    <thead style="position: sticky; top: 0; background: var(--bg-card);">
                                        <tr style="border-bottom: 2px solid var(--border);">
                                            <th
                                                style="padding: 0.5rem 0.25rem; text-align: center; font-weight: 600; width: 40px;">
                                                #</th>
                                            <th
                                                style="padding: 0.5rem 0.25rem; text-align: left; font-weight: 600; width: 60px;">
                                                Código</th>
                                            <th style="padding: 0.5rem 0.25rem; text-align: left; font-weight: 600;">
                                                Denominación</th>
                                            <th
                                                style="padding: 0.5rem 0.25rem; text-align: right; font-weight: 600; width: 80px;">
                                                Ventas €</th>
                                        </tr>
                                    </thead>
                                    <tbody id="comercialTopFamiliasBody">
                                        <tr>
                                            <td colspan="4"
                                                style="text-align: center; padding: 2rem; color: var(--text-muted);">
                                                Cargando...</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Capa Charge View (Capacidad Productiva) -->
            <div id="capaChargeView" class="view-section">
                <div style="padding: 1.5rem;">

                    <!-- Filter Bar and Configuration -->
                    <div
                        style="display: flex; gap: 1rem; margin-bottom: 1.5rem; padding: 1rem; background: var(--bg-card); border-radius: 8px; box-shadow: var(--shadow-sm); flex-wrap: wrap; align-items: flex-end;">
                        <!-- Año Filter -->
                        <div class="filter-group" style="display: flex; flex-direction: column; gap: 0.25rem;">
                            <label for="capacidadYearFilter"
                                style="font-weight: 600; font-size: 0.75rem; text-transform: uppercase; color: var(--text-muted);">Año</label>
                            <select id="capacidadYearFilter"
                                style="padding: 0.5rem 1rem; border-radius: 6px; border: 1px solid var(--border); background: var(--bg-card); color: var(--text-main); min-width: 100px;">
                                <option value="2026">2026</option>
                                <option value="2025" selected>2025</option>
                                <option value="2024">2024</option>
                                <option value="2023">2023</option>
                            </select>
                        </div>
                        <!-- Sección Filter -->
                        <div class="filter-group" style="display: flex; flex-direction: column; gap: 0.25rem;">
                            <label for="capacidadSeccionFilter"
                                style="font-weight: 600; font-size: 0.75rem; text-transform: uppercase; color: var(--text-muted);">Sección</label>
                            <select id="capacidadSeccionFilter"
                                style="padding: 0.5rem 1rem; border-radius: 6px; border: 1px solid var(--border); background: var(--bg-card); color: var(--text-main); min-width: 180px;">
                                <option value="">Todas</option>
                            </select>
                        </div>
                        <!-- Separator -->
                        <div style="border-left: 2px solid var(--border); height: 40px; margin: 0 0.5rem;"></div>
                        <!-- Días Max -->
                        <div class="filter-group" style="display: flex; flex-direction: column; gap: 0.25rem;">
                            <label for="capacidadDiasMax"
                                style="font-weight: 600; font-size: 0.75rem; text-transform: uppercase; color: var(--text-muted);">Días
                                Máx</label>
                            <input type="number" id="capacidadDiasMax" value="365" min="1" max="366"
                                style="padding: 0.5rem 0.75rem; border-radius: 6px; border: 1px solid var(--border); background: var(--bg-card); color: var(--text-main); width: 80px;">
                        </div>
                        <!-- Días Disponibles -->
                        <div class="filter-group" style="display: flex; flex-direction: column; gap: 0.25rem;">
                            <label for="capacidadDiasDisponibles"
                                style="font-weight: 600; font-size: 0.75rem; text-transform: uppercase; color: var(--text-muted);">Días
                                Disp.</label>
                            <input type="number" id="capacidadDiasDisponibles" value="250" min="1" max="366"
                                style="padding: 0.5rem 0.75rem; border-radius: 6px; border: 1px solid var(--border); background: var(--bg-card); color: var(--text-main); width: 80px;">
                        </div>
                        <!-- Save Config Button -->
                        <button id="guardarConfigCapacidadBtn"
                            style="padding: 0.5rem 1rem; border-radius: 6px; border: 1px solid var(--border); background: var(--bg-card); color: var(--text-main); cursor: pointer; display: flex; align-items: center; gap: 0.5rem;">
                            <i class="ri-save-line"></i> Guardar
                        </button>
                        <div style="flex: 1;"></div>
                        <!-- Calculate Button -->
                        <button id="buscarCapacidadBtn"
                            style="padding: 0.5rem 1.5rem; border-radius: 6px; border: none; background: linear-gradient(135deg, var(--primary), #667eea); color: white; cursor: pointer; font-weight: 500; display: flex; align-items: center; gap: 0.5rem;">
                            <i class="ri-calculator-line"></i> Calcular Capacidad
                        </button>
                    </div>

                    <!-- Info Bar: Horas Convenio y Días Laborables -->
                    <div id="capacidadInfoBar"
                        style="display: flex; gap: 1.5rem; margin-bottom: 1.5rem; padding: 0.75rem 1rem; background: rgba(102, 126, 234, 0.08); border-left: 4px solid var(--primary); border-radius: 4px; flex-wrap: wrap; align-items: center;">
                        <div style="display: flex; align-items: center; gap: 0.5rem;">
                            <i class="ri-calendar-check-line" style="color: var(--primary);"></i>
                            <span style="font-weight: 500;">Días Laborables:</span>
                            <span id="capacidadDiasLaborables" style="font-weight: 700; color: var(--primary);">-</span>
                        </div>
                        <div style="display: flex; align-items: center; gap: 0.5rem;">
                            <i class="ri-time-line" style="color: var(--primary);"></i>
                            <span style="font-weight: 500;">Horas Convenio:</span>
                            <span id="capacidadHorasConvenio" style="font-weight: 700; color: var(--primary);">-</span>
                        </div>
                        <div style="display: flex; align-items: center; gap: 0.5rem;">
                            <i class="ri-group-line" style="color: var(--primary);"></i>
                            <span style="font-weight: 500;">Plantilla Total:</span>
                            <span id="capacidadPlantillaTotal" style="font-weight: 700; color: var(--primary);">-</span>
                        </div>
                    </div>

                    <!-- KPIs - Capacidades -->
                    <div class="kpi-grid" style="margin-bottom: 1.5rem;">
                        <div class="kpi-card">
                            <div class="kpi-icon"
                                style="background: linear-gradient(135deg, #10b981 0%, #059669 100%);">
                                <i class="ri-bar-chart-box-line" style="font-size: 2rem;"></i>
                            </div>
                            <div class="kpi-info">
                                <h3>Capacidad Demostrada</h3>
                                <p class="kpi-value" id="capacidadKpiDemostrada">0 h</p>
                                <span class="kpi-trend">Plantilla × H.Conv × OEE × (1-Abs) × (1-Rec)</span>
                            </div>
                        </div>
                        <div class="kpi-card">
                            <div class="kpi-icon"
                                style="background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);">
                                <i class="ri-speed-up-line" style="font-size: 2rem;"></i>
                            </div>
                            <div class="kpi-info">
                                <h3>Capacidad Máxima</h3>
                                <p class="kpi-value" id="capacidadKpiMaxima">0 h</p>
                                <span class="kpi-trend">Demostrada + (60×Plantilla) + H.Conv</span>
                            </div>
                        </div>
                        <div class="kpi-card">
                            <div class="kpi-icon"
                                style="background: linear-gradient(135deg, #6366f1 0%, #4f46e5 100%);">
                                <i class="ri-building-2-line" style="font-size: 2rem;"></i>
                            </div>
                            <div class="kpi-info">
                                <h3>Capacidad Instalación</h3>
                                <p class="kpi-value" id="capacidadKpiInstalacion">0 h</p>
                                <span class="kpi-trend">Días Máx × 36 × 8 × OEE</span>
                            </div>
                        </div>
                        <div class="kpi-card">
                            <div class="kpi-icon"
                                style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                                <i class="ri-pie-chart-line" style="font-size: 2rem;"></i>
                            </div>
                            <div class="kpi-info">
                                <h3>OEE Promedio</h3>
                                <p class="kpi-value" id="capacidadKpiOee">0 %</p>
                                <span class="kpi-trend">Ponderado por plantilla</span>
                            </div>
                        </div>
                    </div>

                    <!-- Secondary KPIs -->
                    <div
                        style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 1rem; margin-bottom: 1.5rem;">
                        <div
                            style="background: var(--bg-card); border-radius: 8px; padding: 1rem; box-shadow: var(--shadow-sm); display: flex; align-items: center; gap: 1rem;">
                            <div
                                style="width: 48px; height: 48px; border-radius: 50%; background: rgba(244, 63, 94, 0.1); display: flex; align-items: center; justify-content: center;">
                                <i class="ri-user-unfollow-line" style="font-size: 1.5rem; color: #f43f5e;"></i>
                            </div>
                            <div>
                                <p style="font-size: 0.75rem; color: var(--text-muted); margin-bottom: 0.25rem;">
                                    Absentismo</p>
                                <p style="font-size: 1.25rem; font-weight: 700;" id="capacidadKpiAbsentismo">0 %</p>
                            </div>
                        </div>
                        <div
                            style="background: var(--bg-card); border-radius: 8px; padding: 1rem; box-shadow: var(--shadow-sm); display: flex; align-items: center; gap: 1rem;">
                            <div
                                style="width: 48px; height: 48px; border-radius: 50%; background: rgba(239, 68, 68, 0.1); display: flex; align-items: center; justify-content: center;">
                                <i class="ri-error-warning-line" style="font-size: 1.5rem; color: #ef4444;"></i>
                            </div>
                            <div>
                                <p style="font-size: 0.75rem; color: var(--text-muted); margin-bottom: 0.25rem;">Rechazo
                                </p>
                                <p style="font-size: 1.25rem; font-weight: 700;" id="capacidadKpiRechazo">0 %</p>
                            </div>
                        </div>
                        <div
                            style="background: var(--bg-card); border-radius: 8px; padding: 1rem; box-shadow: var(--shadow-sm); display: flex; align-items: center; gap: 1rem;">
                            <div
                                style="width: 48px; height: 48px; border-radius: 50%; background: rgba(34, 197, 94, 0.1); display: flex; align-items: center; justify-content: center;">
                                <i class="ri-percent-line" style="font-size: 1.5rem; color: #22c55e;"></i>
                            </div>
                            <div>
                                <p style="font-size: 0.75rem; color: var(--text-muted); margin-bottom: 0.25rem;">
                                    Utilización</p>
                                <p style="font-size: 1.25rem; font-weight: 700;" id="capacidadKpiUtilizacion">0 %</p>
                            </div>
                        </div>
                    </div>

                    <!-- Chart: Capacidad por Sección -->
                    <div class="chart-card" style="margin-bottom: 1.5rem;">
                        <div class="card-header">
                            <h3><i class="ri-bar-chart-grouped-line"
                                    style="margin-right: 0.5rem; color: var(--primary);"></i>Capacidad por Sección</h3>
                        </div>
                        <div class="chart-container" style="height: 350px;">
                            <canvas id="capacidadSeccionesChart"></canvas>
                        </div>
                    </div>

                    <!-- Data Table -->
                    <div class="table-card">
                        <div class="card-header"
                            style="padding: 1rem 1.5rem 0.5rem; display: flex; justify-content: space-between; align-items: center;">
                            <h3 style="margin: 0; font-size: 1.125rem; font-weight: 600;"><i class="ri-table-line"
                                    style="margin-right: 0.5rem; color: var(--primary);"></i>Detalle por Sección</h3>
                        </div>
                        <div class="table-wrapper" style="overflow-x: auto;">
                            <table id="capacidadTable"
                                style="width: 100%; min-width: 900px; border-collapse: collapse;">
                                <thead style="position: sticky; top: 0; background: var(--bg-card); z-index: 1;">
                                    <tr>
                                        <th style="text-align: left;">
                                            Sección</th>
                                        <th style="text-align: center; width: 80px;">
                                            Plantilla</th>
                                        <th style="text-align: center; width: 80px;">
                                            OEE %</th>
                                        <th style="text-align: center; width: 80px;">
                                            Absent. %</th>
                                        <th style="text-align: center; width: 80px;">
                                            Rechazo %</th>
                                        <th style="text-align: right; width: 120px;">
                                            Cap. Demostrada</th>
                                        <th style="text-align: right; width: 120px;">
                                            Cap. Máxima</th>
                                        <th style="text-align: right; width: 120px;">
                                            Cap. Instalación</th>
                                    </tr>
                                </thead>
                                <tbody id="capacidadTableBody">
                                    <tr>
                                        <td colspan="8"
                                            style="text-align: center; padding: 2rem; color: var(--text-muted);">
                                            <i class="ri-calculator-line"
                                                style="font-size: 2rem; display: block; margin-bottom: 0.5rem;"></i>
                                            Pulse "Calcular Capacidad" para ver los datos
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>


            <!-- COMPRAS Dashboard View -->
            <div id="compras-dashboardView" class="view-section">
                <div style="padding: 1.5rem;">
                    <!-- Header con título y selector de año -->
                    <div
                        style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem; flex-wrap: wrap; gap: 1rem;">
                        <!-- Year Filter (left) -->
                        <div
                            style="display: flex; align-items: center; gap: 0.75rem; padding: 0.75rem 1rem; background: var(--bg-card); border-radius: 8px; box-shadow: var(--shadow-sm);">
                            <label for="comprasYearFilter"
                                style="font-weight: 600; color: var(--text-main);">Año:</label>
                            <select id="comprasYearFilter"
                                style="padding: 0.5rem 1rem; border-radius: 6px; border: 1px solid var(--border); background: var(--bg-card); color: var(--text-main); min-width: 100px; cursor: pointer;">
                                <option value="2026">2026</option>
                                <option value="2025" selected>2025</option>
                            </select>
                        </div>

                        <!-- AI Insight Placeholder (right) -->
                        <div
                            style="display: flex; align-items: center; gap: 0.75rem; padding: 0.5rem 1rem; background: rgba(88, 86, 214, 0.05); border: 1px solid rgba(88, 86, 214, 0.2); border-radius: 8px; flex: 1; max-width: 800px;">
                            <div
                                style="background: var(--bg-card); padding: 0.25rem; border-radius: 4px; border: 1px solid var(--border); display: flex; align-items: center; justify-content: center;">
                                <i class="ri-openai-fill" style="color: var(--primary); font-size: 1.2rem;"></i>
                            </div>
                            <span style="font-size: 0.85rem; color: var(--text-main); font-style: italic;">
                                <strong>Insight AI:</strong> El volumen de compras en 2025 se mantiene estable,
                                destacando un incremento del 12% en "Rodamientos" respecto al año pasado.
                            </span>
                        </div>
                    </div>

                    <!-- Filter Bar with Checkboxes -->
                    <div
                        style="display: flex; gap: 1rem; margin-bottom: 1.5rem; padding: 1rem; background: var(--bg-card); border-radius: 8px; box-shadow: var(--shadow-sm); flex-wrap: wrap; align-items: flex-start;">
                        <!-- Tipo (checkboxes) -->
                        <div style="display: flex; flex-direction: column; gap: 0.25rem; flex: 1; min-width: 200px;">
                            <label style="font-weight: 600; font-size: 0.75rem; color: var(--text-muted);">Tipo</label>
                            <div id="comprasTipoContainer"
                                style="max-height: 120px; overflow-y: auto; padding: 0.5rem; border-radius: 6px; border: 1px solid var(--border); background: var(--bg); font-size: 0.8rem;">
                                <span style="color: var(--text-muted);">Cargando...</span>
                            </div>
                        </div>
                        <!-- Familia (checkboxes) -->
                        <div style="display: flex; flex-direction: column; gap: 0.25rem; flex: 1; min-width: 250px;">
                            <label
                                style="font-weight: 600; font-size: 0.75rem; color: var(--text-muted);">Familia</label>
                            <div id="comprasFamiliaContainer"
                                style="max-height: 120px; overflow-y: auto; padding: 0.5rem; border-radius: 6px; border: 1px solid var(--border); background: var(--bg); font-size: 0.8rem;">
                                <span style="color: var(--text-muted);">Selecciona un Tipo</span>
                            </div>
                        </div>
                        <!-- Subfamilia (checkboxes) -->
                        <div style="display: flex; flex-direction: column; gap: 0.25rem; flex: 1; min-width: 250px;">
                            <label
                                style="font-weight: 600; font-size: 0.75rem; color: var(--text-muted);">Subfamilia</label>
                            <div id="comprasSubfamiliaContainer"
                                style="max-height: 120px; overflow-y: auto; padding: 0.5rem; border-radius: 6px; border: 1px solid var(--border); background: var(--bg); font-size: 0.8rem;">
                                <span style="color: var(--text-muted);">Selecciona una Familia</span>
                            </div>
                        </div>
                        <!-- Clear filters button -->
                        <button onclick="clearComprasFilters()"
                            style="padding: 0.5rem 1rem; border-radius: 6px; border: 1px solid var(--border); background: var(--bg-card); color: var(--text-main); cursor: pointer; height: fit-content; align-self: flex-end;">
                            <i class="ri-filter-off-line"></i> Limpiar
                        </button>
                    </div>

                    <!-- KPIs -->
                    <div class="kpi-grid" style="margin-bottom: 1.5rem;">
                        <div class="kpi-card">
                            <div class="kpi-icon"
                                style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
                                <i class="ri-money-euro-circle-line" style="font-size: 2rem;"></i>
                            </div>
                            <div class="kpi-info">
                                <h3>Compras Totales</h3>
                                <p class="kpi-value" id="comprasKpiTotal">0 €</p>
                                <span class="kpi-trend">Importe total (sin filtrar)</span>
                            </div>
                        </div>
                        <div class="kpi-card">
                            <div class="kpi-icon"
                                style="background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);">
                                <i class="ri-filter-line" style="font-size: 2rem;"></i>
                            </div>
                            <div class="kpi-info">
                                <h3>Total Selección</h3>
                                <p class="kpi-value" id="comprasKpiSeleccion">0 €</p>
                                <span class="kpi-trend">Tipo/Familia/Subfamilia seleccionados</span>
                            </div>
                        </div>
                        <div class="kpi-card">
                            <div class="kpi-icon"
                                style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                                <i class="ri-file-list-3-line" style="font-size: 2rem;"></i>
                            </div>
                            <div class="kpi-info">
                                <h3>Nº Facturas</h3>
                                <p class="kpi-value" id="comprasKpiFacturas">0</p>
                                <span class="kpi-trend">Facturas recibidas</span>
                            </div>
                        </div>
                        <div class="kpi-card">
                            <div class="kpi-icon"
                                style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">
                                <i class="ri-truck-line" style="font-size: 2rem;"></i>
                            </div>
                            <div class="kpi-info">
                                <h3>Proveedores Activos</h3>
                                <p class="kpi-value" id="comprasKpiProveedores">0</p>
                                <span class="kpi-trend">Proveedores con facturas</span>
                            </div>
                        </div>
                        <div class="kpi-card">
                            <div class="kpi-icon"
                                style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);">
                                <i class="ri-shopping-cart-line" style="font-size: 2rem;"></i>
                            </div>
                            <div class="kpi-info">
                                <h3>Ticket Medio</h3>
                                <p class="kpi-value" id="comprasKpiTicket">0 €</p>
                                <span class="kpi-trend">Por factura</span>
                            </div>
                        </div>
                    </div>

                    <!-- Gráficos Row -->
                    <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 1.5rem; margin-bottom: 1.5rem;">
                        <!-- Gráfico de Evolución Mensual -->
                        <div class="chart-card">
                            <div class="card-header">
                                <h3>Evolución de Compras Mensual</h3>
                            </div>
                            <div class="chart-container" style="height: 300px;">
                                <canvas id="comprasMensualesChart"></canvas>
                            </div>
                        </div>

                        <!-- Gráfico Comparativo Anual -->
                        <div class="chart-card">
                            <div class="card-header">
                                <h3>Comparativa Anual</h3>
                            </div>
                            <div class="chart-container" style="height: 300px;">
                                <canvas id="comprasAnualChart"></canvas>
                            </div>
                        </div>
                    </div>

                    <!-- Top Proveedores y Top Artículos -->
                    <!-- Top Tables Grid -->
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem;">

                        <!-- Columna Izquierda: Proveedores y Tipos -->
                        <div style="display: flex; flex-direction: column; gap: 1.5rem;">
                            <!-- Top 10 Proveedores -->
                            <div class="chart-card">
                                <div class="card-header">
                                    <h3><i class="ri-truck-line"
                                            style="margin-right: 0.5rem; color: var(--primary);"></i>Top 10
                                        Proveedores
                                    </h3>
                                </div>
                                <div style="max-height: 350px; overflow-y: auto;">
                                    <table class="responsive-dashboard-table"
                                        style="width: 100%; border-collapse: collapse; font-size: 0.75rem; table-layout: fixed;">
                                        <thead
                                            style="position: sticky; top: 0; background: var(--bg-card); z-index: 1; border-bottom: 2px solid var(--border);">
                                            <tr style="text-align: left; color: var(--text-muted); font-size: 0.7rem;">
                                                <th style="padding: 0.5rem 0.25rem; text-align: center; width: 30px;">
                                                    #
                                                </th>
                                                <th style="padding: 0.5rem 0.25rem; width: 80px;">Código</th>
                                                <th style="padding: 0.5rem 0.25rem;">Proveedor</th>
                                                <th style="padding: 0.5rem 0.25rem; text-align: right; width: 80px;">
                                                    Compras (€)</th>
                                            </tr>
                                        </thead>
                                        <tbody id="comprasTopProveedoresBody">
                                            <tr>
                                                <td colspan="4"
                                                    style="text-align: center; padding: 2rem; color: var(--text-muted);">
                                                    Cargando...</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                            <!-- Top 10 Tipos -->
                            <div class="chart-card">
                                <div class="card-header">
                                    <h3>Top 10 Tipos</h3>
                                </div>
                                <div class="table-container" style="height: 300px; overflow-y: auto;">
                                    <table class="responsive-dashboard-table"
                                        style="width: 100%; border-collapse: collapse; font-size: 0.75rem;">
                                        <thead
                                            style="position: sticky; top: 0; background: var(--bg-card); z-index: 1; border-bottom: 2px solid var(--border);">
                                            <tr style="text-align: left; color: var(--text-muted); font-size: 0.7rem;">
                                                <th style="padding: 0.5rem 0.25rem; width: 30px;">#</th>
                                                <th style="padding: 0.5rem 0.25rem; width: 80px;">Código</th>
                                                <th style="padding: 0.5rem 0.25rem;">Tipo</th>
                                                <th style="padding: 0.5rem 0.25rem; text-align: right; width: 80px;">
                                                    Compras (€)</th>
                                            </tr>
                                        </thead>
                                        <tbody id="comprasTopTiposBody"></tbody>
                                    </table>
                                </div>
                            </div>
                        </div>

                        <!-- Columna Derecha: Artículos y Familias -->
                        <div style="display: flex; flex-direction: column; gap: 1.5rem;">
                            <!-- Top 10 Artículos -->
                            <div class="chart-card">
                                <div class="card-header">
                                    <h3><i class="ri-box-3-line"
                                            style="margin-right: 0.5rem; color: var(--primary);"></i>Top 10
                                        Artículos
                                    </h3>
                                </div>
                                <div style="max-height: 350px; overflow-y: auto;">
                                    <table class="responsive-dashboard-table"
                                        style="width: 100%; border-collapse: collapse; font-size: 0.75rem; table-layout: fixed;">
                                        <thead
                                            style="position: sticky; top: 0; background: var(--bg-card); z-index: 1; border-bottom: 1px solid var(--border);">
                                            <tr style="text-align: left; color: var(--text-muted); font-size: 0.7rem;">
                                                <th style="padding: 0.5rem 0.25rem; text-align: center; width: 30px;">
                                                    #
                                                </th>
                                                <th style="padding: 0.5rem 0.25rem; width: 80px;">Código</th>
                                                <th style="padding: 0.5rem 0.25rem;">Artículo</th>
                                                <th style="padding: 0.5rem 0.25rem; text-align: right; width: 80px;">
                                                    Compras (€)</th>
                                            </tr>
                                        </thead>
                                        <tbody id="comprasTopArticulosBody">
                                            <tr>
                                                <td colspan="4"
                                                    style="text-align: center; padding: 2rem; color: var(--text-muted);">
                                                    Cargando...</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                            <!-- Top 10 Familias -->
                            <div class="chart-card">
                                <div class="card-header">
                                    <h3>Top 10 Familias</h3>
                                </div>
                                <div class="table-container" style="height: 300px; overflow-y: auto;">
                                    <table class="responsive-dashboard-table"
                                        style="width: 100%; border-collapse: collapse; font-size: 0.75rem;">
                                        <thead
                                            style="position: sticky; top: 0; background: var(--bg-card); z-index: 1; border-bottom: 2px solid var(--border);">
                                            <tr style="text-align: left; color: var(--text-muted); font-size: 0.7rem;">
                                                <th style="padding: 0.5rem 0.25rem; width: 30px;">#</th>
                                                <th style="padding: 0.5rem 0.25rem; width: 80px;">Código</th>
                                                <th style="padding: 0.5rem 0.25rem;">Familia</th>
                                                <th style="padding: 0.5rem 0.25rem; text-align: right; width: 80px;">
                                                    Compras (€)</th>
                                            </tr>
                                        </thead>
                                        <tbody id="comprasTopFamiliasBody"></tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ESPECIFICACIONES View -->
            <div id="especificacionesView" class="view-section">
                <div style="padding: 1.5rem;">
                    <!-- Filter Bar -->
                    <div class="filter-bar"
                        style="display: flex; gap: 1rem; margin-bottom: 1.5rem; padding: 1rem; background: var(--bg-card); border-radius: 8px; box-shadow: var(--shadow-sm); flex-wrap: wrap; align-items: flex-end;">
                        <div class="filter-group" style="display: flex; flex-direction: column; gap: 0.25rem;">
                            <label for="especificacionesNecFilter"
                                style="font-weight: 600; font-size: 0.75rem; text-transform: uppercase; color: var(--text-muted);">NºEC</label>
                            <input type="text" id="especificacionesNecFilter" placeholder="Buscar por NºEC..."
                                style="padding: 0.5rem 1rem; border-radius: 6px; border: 1px solid var(--border); background: var(--bg-card); color: var(--text-main); min-width: 150px;">
                        </div>
                        <div class="filter-group" style="display: flex; flex-direction: column; gap: 0.25rem;">
                            <label for="especificacionesTipoFilter"
                                style="font-weight: 600; font-size: 0.75rem; text-transform: uppercase; color: var(--text-muted);">Tipo</label>
                            <select id="especificacionesTipoFilter"
                                style="padding: 0.5rem 1rem; border-radius: 6px; border: 1px solid var(--border); background: var(--bg-card); color: var(--text-main); min-width: 200px;">
                                <option value="">Todos</option>
                            </select>
                        </div>
                        <div class="filter-group" style="display: flex; flex-direction: column; gap: 0.25rem;">
                            <label for="especificacionesAmbitoFilter"
                                style="font-weight: 600; font-size: 0.75rem; text-transform: uppercase; color: var(--text-muted);">Ámbito</label>
                            <select id="especificacionesAmbitoFilter"
                                style="padding: 0.5rem 1rem; border-radius: 6px; border: 1px solid var(--border); background: var(--bg-card); color: var(--text-main); min-width: 200px;">
                                <option value="">Todos</option>
                            </select>
                        </div>
                        <div class="filter-group" style="display: flex; flex-direction: column; gap: 0.25rem;">
                            <label for="especificacionesEstadoFilter"
                                style="font-weight: 600; font-size: 0.75rem; text-transform: uppercase; color: var(--text-muted);">Actual</label>
                            <select id="especificacionesEstadoFilter"
                                style="padding: 0.5rem 1rem; border-radius: 6px; border: 1px solid var(--border); background: var(--bg-card); color: var(--text-main); min-width: 100px;">
                                <option value="">Todos</option>
                                <option value="-1">Sí</option>
                                <option value="0">No</option>
                            </select>
                        </div>
                        <button id="especificacionesBuscarBtn" class="btn-primary"
                            style="padding: 0.5rem 1rem; border-radius: 6px; border: none; background: var(--primary); color: white; cursor: pointer;">
                            <i class="ri-search-line"></i> Buscar
                        </button>
                        <button id="especificacionesLimpiarBtn" class="btn-secondary"
                            style="padding: 0.5rem 1rem; border-radius: 6px; border: 1px solid var(--border); background: var(--bg-card); color: var(--text-main); cursor: pointer;">
                            <i class="ri-filter-off-line"></i> Limpiar
                        </button>
                    </div>

                    <!-- Info Bar -->
                    <div id="especificacionesInfo"
                        style="display: none; justify-content: space-between; align-items: center; margin-bottom: 1rem; padding: 0.75rem 1rem; background: rgba(59, 130, 246, 0.05); border-left: 4px solid var(--primary); border-radius: 4px;">
                        <span
                            style="display: flex; align-items: center; gap: 0.5rem; color: var(--text-main); font-weight: 500;">
                            <i class="ri-information-line" style="color: var(--primary);"></i>
                            <span id="especificacionesResultCount">0 registros encontrados</span>
                        </span>
                    </div>

                    <!-- Pagination Bar (Top) -->
                    <div id="especificacionesPaginationBar" class="pagination-bar"
                        style="display: none; justify-content: space-between; align-items: center; margin-bottom: 1rem; padding: 0.75rem 1rem; background: var(--bg-card); border-radius: 8px; box-shadow: var(--shadow-sm);">
                        <span id="especificacionesPaginationInfoTop"
                            style="font-size: 0.875rem; color: var(--text-muted);">Mostrando 0 de
                            0</span>
                        <div style="display: flex; gap: 0.5rem;">
                            <button id="especificacionesPrevPageTop" class="btn-pagination"
                                style="padding: 0.5rem 1rem; border-radius: 6px; border: 1px solid var(--border); background: var(--bg-card); color: var(--text-main); cursor: pointer; display: flex; align-items: center; gap: 0.25rem;">
                                <i class="ri-arrow-left-s-line"></i> Anterior
                            </button>
                            <button id="especificacionesNextPageTop" class="btn-pagination"
                                style="padding: 0.5rem 1rem; border-radius: 6px; border: 1px solid var(--border); background: var(--bg-card); color: var(--text-main); cursor: pointer; display: flex; align-items: center; gap: 0.25rem;">
                                Siguiente <i class="ri-arrow-right-s-line"></i>
                            </button>
                        </div>
                    </div>

                    <!-- Table Container -->
                    <div class="chart-card"
                        style="background: var(--bg-card); border-radius: 8px; box-shadow: var(--shadow-sm); overflow: hidden;">
                        <div class="table-wrapper" style="overflow-x: auto;">
                            <table id="especificacionesTable"
                                style="width: 100%; border-collapse: collapse; font-size: 0.875rem; table-layout: fixed;">
                                <thead style="background: var(--primary); color: white;">
                                    <tr>
                                        <th style="padding: 0.75rem; text-align: left; width: 10%; cursor: pointer;"
                                            data-sort="NEC">NºEC ↕</th>
                                        <th style="padding: 0.75rem; text-align: center; width: 5%; cursor: pointer;"
                                            data-sort="Revision">Rev ↕</th>
                                        <th style="padding: 0.75rem; text-align: left; width: 35%; cursor: pointer;"
                                            data-sort="Nombre">Nombre ↕</th>
                                        <th style="padding: 0.75rem; text-align: center; width: 10%; white-space: nowrap; cursor: pointer;"
                                            data-sort="Fecha">Fecha ↕</th>
                                        <th style="padding: 0.75rem; text-align: center; width: 5%; cursor: pointer;"
                                            data-sort="Estado">Act ↕</th>
                                        <th style="padding: 0.75rem; text-align: left; width: 15%; cursor: pointer;"
                                            data-sort="tipoDescripcion">Tipo ↕</th>
                                        <th style="padding: 0.75rem; text-align: left; width: 20%; cursor: pointer;"
                                            data-sort="ambitoDescripcion">Ámbito ↕</th>
                                    </tr>
                                </thead>
                                <tbody id="especificacionesTableBody">
                                    <tr>
                                        <td colspan="7"
                                            style="text-align: center; padding: 2rem; color: var(--text-muted);">
                                            Cargando...
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- OEE DASHBOARD VIEW -->
            <div id="oeeView" class="view-section">
                <div style="padding: 2rem;">

                    <!-- Filter Bar -->
                    <div
                        style="margin-bottom: 1.5rem; padding: 1rem; background: var(--bg-card); border-radius: 8px; box-shadow: var(--shadow-sm); display: flex; flex-wrap: wrap; align-items: center; gap: 1.5rem;">
                        <!-- Year -->
                        <div style="display: flex; align-items: center; gap: 0.5rem;">
                            <label for="oeeYearFilter" style="font-weight: 600; color: var(--text-main);">Año:</label>
                            <select id="oeeYearFilter"
                                style="padding: 0.5rem 1rem; border-radius: 6px; border: 1px solid var(--border); background: var(--bg-card); color: var(--text-main); cursor: pointer;">
                                <option value="2026" selected>2026</option>
                                <option value="2025">2025</option>
                                <option value="2024">2024</option>
                                <option value="2023">2023</option>
                                <option value="2022">2022</option>
                            </select>
                        </div>
                        <!-- Month -->
                        <div style="display: flex; align-items: center; gap: 0.5rem;">
                            <label for="oeeMonthFilter" style="font-weight: 600; color: var(--text-main);">Mes:</label>
                            <select id="oeeMonthFilter"
                                style="padding: 0.5rem 1rem; border-radius: 6px; border: 1px solid var(--border); background: var(--bg-card); color: var(--text-main); cursor: pointer; min-width: 140px;">
                                <option value="">Todos los meses</option>
                                <option value="1">Enero</option>
                                <option value="2">Febrero</option>
                                <option value="3">Marzo</option>
                                <option value="4">Abril</option>
                                <option value="5">Mayo</option>
                                <option value="6">Junio</option>
                                <option value="7">Julio</option>
                                <option value="8">Agosto</option>
                                <option value="9">Septiembre</option>
                                <option value="10">Octubre</option>
                                <option value="11">Noviembre</option>
                                <option value="12">Diciembre</option>
                            </select>
                        </div>
                        <!-- Seccion -->
                        <div style="display: flex; align-items: center; gap: 0.5rem;">
                            <label for="oeeSeccionFilter"
                                style="font-weight: 600; color: var(--text-main);">Sección:</label>
                            <select id="oeeSeccionFilter"
                                style="padding: 0.5rem 1rem; border-radius: 6px; border: 1px solid var(--border); background: var(--bg-card); color: var(--text-main); cursor: pointer; min-width: 180px;">
                                <option value="">Todas las Secciones</option>
                                <!-- Populated dynamically -->
                            </select>
                        </div>
                        <!-- Familia -->
                        <div style="display: flex; align-items: center; gap: 0.5rem;">
                            <label for="oeeFamiliaFilter"
                                style="font-weight: 600; color: var(--text-main);">Familia:</label>
                            <select id="oeeFamiliaFilter"
                                style="padding: 0.5rem 1rem; border-radius: 6px; border: 1px solid var(--border); background: var(--bg-card); color: var(--text-main); cursor: pointer; min-width: 180px;">
                                <option value="">Todas las Familias</option>
                                <!-- Populated dynamically -->
                            </select>
                        </div>
                    </div>

                    <!-- KPI Grid -->
                    <div class="kpi-grid">
                        <!-- OEE Global -->
                        <div class="kpi-card">
                            <div class="kpi-icon"
                                style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                                <i class="ri-dashboard-3-line" style="font-size: 2rem;"></i>
                            </div>
                            <div class="kpi-info">
                                <h3>OEE Global</h3>
                                <p class="kpi-value" id="kpiOeeGlobal">--%</p>
                                <span class="kpi-trend positive"><i class="ri-arrow-up-line"></i> Objetivo: >85%</span>
                            </div>
                        </div>

                        <!-- Disponibilidad (OEED) -->
                        <div class="kpi-card">
                            <div class="kpi-icon"
                                style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);">
                                <i class="ri-time-line" style="font-size: 2rem;"></i>
                            </div>
                            <div class="kpi-info">
                                <h3>Disponibilidad (OEED)</h3>
                                <p class="kpi-value" id="kpiAvailability">--%</p>
                                <span class="kpi-trend">H.Disp / H.Plan</span>
                            </div>
                        </div>

                        <!-- Rendimiento (OEER) -->
                        <div class="kpi-card">
                            <div class="kpi-icon"
                                style="background: linear-gradient(135deg, #fa709a 0%, #fe9488 100%);">
                                <i class="ri-speed-line" style="font-size: 2rem;"></i>
                            </div>
                            <div class="kpi-info">
                                <h3>Rendimiento (OEER)</h3>
                                <p class="kpi-value" id="kpiPerformance">--%</p>
                                <span class="kpi-trend">H.Teor / H.Disp</span>
                            </div>
                        </div>

                        <!-- Calidad (OEEQ) -->
                        <div class="kpi-card">
                            <div class="kpi-icon"
                                style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
                                <i class="ri-shield-check-line" style="font-size: 2rem;"></i>
                            </div>
                            <div class="kpi-info">
                                <h3>Calidad (OEEQ)</h3>
                                <p class="kpi-value" id="kpiQuality">--%</p>
                                <span class="kpi-trend">Ok / Totales</span>
                            </div>
                        </div>
                    </div>

                    <!-- Secondary KPIs Row -->
                    <div
                        style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 1rem; margin-top: 1.5rem;">
                        <div
                            style="background: var(--bg-card); padding: 1rem; border-radius: 8px; text-align: center; border: 1px solid var(--border);">
                            <div style="font-size: 0.8rem; color: var(--text-muted); margin-bottom: 0.25rem;">Piezas OK
                            </div>
                            <div id="kpiPiezasOk" style="font-size: 1.5rem; font-weight: 700; color: var(--success);">0
                            </div>
                        </div>
                        <div
                            style="background: var(--bg-card); padding: 1rem; border-radius: 8px; text-align: center; border: 1px solid var(--border);">
                            <div style="font-size: 0.8rem; color: var(--text-muted); margin-bottom: 0.25rem;">Piezas RC
                            </div>
                            <div id="kpiPiezasRc" style="font-size: 1.5rem; font-weight: 700; color: var(--danger);">0
                            </div>
                        </div>
                        <div
                            style="background: var(--bg-card); padding: 1rem; border-radius: 8px; text-align: center; border: 1px solid var(--border);">
                            <div style="font-size: 0.8rem; color: var(--text-muted); margin-bottom: 0.25rem;">H.
                                Teóricas</div>
                            <div id="kpiHorasTeoricas"
                                style="font-size: 1.5rem; font-weight: 700; color: var(--primary);">0
                            </div>
                        </div>
                        <div
                            style="background: var(--bg-card); padding: 1rem; border-radius: 8px; text-align: center; border: 1px solid var(--border);">
                            <div style="font-size: 0.8rem; color: var(--text-muted); margin-bottom: 0.25rem;">H.
                                Disponibles</div>
                            <div id="kpiHorasDisponibles"
                                style="font-size: 1.5rem; font-weight: 700; color: var(--text-main);">
                                0</div>
                        </div>
                        <div
                            style="background: var(--bg-card); padding: 1rem; border-radius: 8px; text-align: center; border: 1px solid var(--border);">
                            <div style="font-size: 0.8rem; color: var(--text-muted); margin-bottom: 0.25rem;">H.
                                Planificadas</div>
                            <div id="kpiHorasPlanificadas"
                                style="font-size: 1.5rem; font-weight: 700; color: var(--text-main);">0</div>
                        </div>
                    </div>

                    <!-- Charts Row -->
                    <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 1.5rem; margin-top: 2rem;">
                        <div class="chart-card large">
                            <div class="card-header">
                                <h3><i class="ri-line-chart-line"></i> Evolución OEE Mensual</h3>
                            </div>
                            <div class="chart-container">
                                <canvas id="oeeTrendChart"></canvas>
                            </div>
                        </div>

                        <div class="chart-card small">
                            <div class="card-header">
                                <h3><i class="ri-bar-chart-groupped-line"></i> Desglose por Factor</h3>
                            </div>
                            <div class="chart-container">
                                <canvas id="oeeBreakdownChart"></canvas>
                            </div>
                        </div>
                    </div>

                    <!-- Operations Table -->
                    <!-- Operations Table -->
                    <div style="margin-top: 2rem;">
                        <h3
                            style="margin-bottom: 1rem; color: var(--text-main); font-size: 1.25rem; display: flex; align-items: center; gap: 0.5rem;">
                            <i class="ri-settings-3-line"></i> OEE por Operación
                        </h3>
                        <!-- Primera fila de encabezado FUERA del scroll -->
                        <div
                            style="background: #1e293b; color: white; border-radius: 8px 8px 0 0; display: grid; grid-template-columns: 510px 200px 270px 360px; min-width: 1340px;">
                            <div
                                style="padding: 0.75rem 1rem; text-align: center; font-weight: 700; border-right: 1px solid #334155;">
                                OPERACIÓN</div>
                            <div
                                style="padding: 0.75rem 1rem; text-align: center; font-weight: 700; border-right: 1px solid #334155;">
                                PIEZAS</div>
                            <div
                                style="padding: 0.75rem 1rem; text-align: center; font-weight: 700; border-right: 1px solid #334155;">
                                HORAS</div>
                            <div style="padding: 0.75rem 1rem; text-align: center; font-weight: 700;">OEE INDICADORES
                            </div>
                        </div>
                        <!-- Contenedor con scroll que empieza en el segundo encabezado -->
                        <div class="table-container"
                            style="max-height: 450px; overflow-y: auto; overflow-x: auto; background: var(--bg-card); border-radius: 0 0 8px 8px; border: 1px solid var(--border); border-top: none; box-shadow: var(--shadow-sm);">
                            <table class="data-table"
                                style="width: 100%; border-collapse: collapse; min-width: 1340px;">
                                <thead style="z-index: 10;">
                                    <!-- Column headers row -->
                                    <tr style="background: #0f172a;">
                                        <th
                                            style="position: sticky; top: 0; z-index: 20; padding: 0.75rem 0.5rem; text-align: left; font-weight: 600; color: #64748b; border-bottom: 1px solid #334155; white-space: nowrap; width: 60px; background: #0f172a;">
                                            Código</th>
                                        <th
                                            style="position: sticky; top: 0; z-index: 20; padding: 0.75rem 1rem; text-align: left; font-weight: 600; color: #64748b; border-bottom: 1px solid #334155; width: 450px; background: #0f172a;">
                                            Descripción</th>
                                        <th
                                            style="position: sticky; top: 0; z-index: 20; padding: 0.75rem 1rem; text-align: right; font-weight: 600; color: #64748b; border-bottom: 1px solid #334155; white-space: nowrap; width: 100px; background: #0f172a;">
                                            Pzas OK</th>
                                        <th
                                            style="position: sticky; top: 0; z-index: 20; padding: 0.75rem 1rem; text-align: right; font-weight: 600; color: #64748b; border-bottom: 1px solid #334155; white-space: nowrap; width: 100px; background: #0f172a;">
                                            Pzas RC</th>
                                        <th
                                            style="position: sticky; top: 0; z-index: 20; padding: 0.75rem 1rem; text-align: right; font-weight: 600; color: #64748b; border-bottom: 1px solid #334155; white-space: nowrap; width: 90px; background: #0f172a;">
                                            H.Teóricas</th>
                                        <th
                                            style="position: sticky; top: 0; z-index: 20; padding: 0.75rem 1rem; text-align: right; font-weight: 600; color: #64748b; border-bottom: 1px solid #334155; white-space: nowrap; width: 90px; background: #0f172a;">
                                            H.Disp.</th>
                                        <th
                                            style="position: sticky; top: 0; z-index: 20; padding: 0.75rem 1rem; text-align: right; font-weight: 600; color: #64748b; border-bottom: 1px solid #334155; white-space: nowrap; width: 90px; background: #0f172a;">
                                            H.Plan.</th>
                                        <th
                                            style="position: sticky; top: 0; z-index: 20; padding: 0.75rem 1rem; text-align: center; font-weight: 600; color: #64748b; border-bottom: 1px solid #334155; white-space: nowrap; width: 90px; background: #0f172a;">
                                            OEED</th>
                                        <th
                                            style="position: sticky; top: 0; z-index: 20; padding: 0.75rem 1rem; text-align: center; font-weight: 600; color: #64748b; border-bottom: 1px solid #334155; white-space: nowrap; width: 90px; background: #0f172a;">
                                            OEER</th>
                                        <th
                                            style="position: sticky; top: 0; z-index: 20; padding: 0.75rem 1rem; text-align: center; font-weight: 600; color: #64748b; border-bottom: 1px solid #334155; white-space: nowrap; width: 90px; background: #0f172a;">
                                            OEEQ</th>
                                        <th
                                            style="position: sticky; top: 0; z-index: 20; padding: 0.75rem 1rem; text-align: center; font-weight: 600; color: #64748b; border-bottom: 1px solid #334155; white-space: nowrap; width: 90px; background: #0f172a;">
                                            OEE</th>
                                    </tr>
                                </thead>
                                <tbody id="oeeOperationsTableBody">
                                    <!-- Populated dynamically -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div> <!-- Close padding div -->
            </div> <!-- Close view section -->


            <!-- ENSAYOS VT VIEW -->
            <div id="ensayos-vtView" class="view-section">
                <div style="padding: 1.5rem;">
                    <!-- Filter Bar -->
                    <div
                        style="margin-bottom: 1.5rem; padding: 1rem; background: var(--bg-card); border-radius: 8px; box-shadow: var(--shadow-sm); display: flex; flex-wrap: wrap; align-items: flex-end; gap: 1rem;">
                        <div style="display: flex; flex-direction: column; gap: 0.25rem;">
                            <label for="ensayosVtArticuloFilter"
                                style="font-weight: 600; font-size: 0.75rem; text-transform: uppercase; color: var(--text-muted);">Artículo
                                / Referencia</label>
                            <input type="text" id="ensayosVtArticuloFilter" placeholder="Buscar..."
                                style="padding: 0.5rem 1rem; border-radius: 6px; border: 1px solid var(--border); background: var(--bg-card); color: var(--text-main); min-width: 200px;">
                        </div>
                        <div style="display: flex; flex-direction: column; gap: 0.25rem;">
                            <label for="ensayosVtTratamientoFilter"
                                style="font-weight: 600; font-size: 0.75rem; text-transform: uppercase; color: var(--text-muted);">Tratamiento</label>
                            <select id="ensayosVtTratamientoFilter"
                                style="padding: 0.5rem 1rem; border-radius: 6px; border: 1px solid var(--border); background: var(--bg-card); color: var(--text-main); min-width: 150px;">
                                <option value="">Todos</option>
                            </select>
                        </div>
                        <button id="buscarEnsayosVtBtn" class="btn-primary"
                            style="padding: 0.5rem 1rem; border-radius: 6px; border: none; background: var(--primary); color: white; cursor: pointer; display: flex; align-items: center; gap: 0.5rem;">
                            <i class="ri-search-line"></i> Buscar
                        </button>
                    </div>

                    <!-- Info & Pagination (Top) -->
                    <div id="ensayosVtInfo"
                        style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                        <span id="ensayosVtResultCount" style="font-weight: 600; color: var(--text-main);">0 registros
                            encontrados</span>
                        <div id="ensayosVtPaginationBar" style="display: flex; gap: 0.5rem; align-items: center;">
                            <span id="ensayosVtPageInfo"
                                style="font-size: 0.875rem; color: var(--text-muted); margin-right: 0.5rem;">Pagina 1 de
                                1</span>
                            <button id="ensayosVtPrevBtn" disabled
                                style="padding: 0.5rem; border: 1px solid var(--border); border-radius: 4px; background: var(--bg-card); color: var(--text-main); cursor: pointer; opacity: 0.5;">
                                <i class="ri-arrow-left-s-line"></i>
                            </button>
                            <button id="ensayosVtNextBtn" disabled
                                style="padding: 0.5rem; border: 1px solid var(--border); border-radius: 4px; background: var(--bg-card); color: var(--text-main); cursor: pointer; opacity: 0.5;">
                                <i class="ri-arrow-right-s-line"></i>
                            </button>
                        </div>
                    </div>

                    <!-- Table -->
                    <div class="table-card"
                        style="background: var(--bg-card); border-radius: 8px; box-shadow: var(--shadow-sm); overflow: hidden;">
                        <div class="table-wrapper" style="overflow-x: auto;">
                            <table id="ensayosVtTable" style="width: 100%; border-collapse: collapse;">
                                <thead>
                                    <tr style="background: var(--primary); color: white;">
                                        <th style="padding: 0.75rem 1rem; text-align: left; cursor: pointer;"
                                            onclick="handleEnsayosSort('vt', 'Fecha')">
                                            Fecha <i id="sort-vt-Fecha" class="ri-arrow-down-line sort-icon"></i>
                                        </th>
                                        <th style="padding: 0.75rem 1rem; text-align: left; cursor: pointer;"
                                            onclick="handleEnsayosSort('vt', 'Referencia')">
                                            Referencia <i id="sort-vt-Referencia"
                                                class="ri-arrow-up-down-line sort-icon"
                                                style="color: rgba(255,255,255,0.5);"></i>
                                        </th>
                                        <th style="padding: 0.75rem 1rem; text-align: left; cursor: pointer;"
                                            onclick="handleEnsayosSort('vt', 'Informe')">
                                            Informe <i id="sort-vt-Informe" class="ri-arrow-up-down-line sort-icon"
                                                style="color: rgba(255,255,255,0.5);"></i>
                                        </th>
                                        <th style="padding: 0.75rem 1rem; text-align: left; cursor: pointer;"
                                            onclick="handleEnsayosSort('vt', 'Colada')">
                                            Colada <i id="sort-vt-Colada" class="ri-arrow-up-down-line sort-icon"
                                                style="color: rgba(255,255,255,0.5);"></i>
                                        </th>
                                        <th style="padding: 0.75rem 1rem; text-align: left; cursor: pointer;"
                                            onclick="handleEnsayosSort('vt', 'Lingote')">
                                            Lingote <i id="sort-vt-Lingote" class="ri-arrow-up-down-line sort-icon"
                                                style="color: rgba(255,255,255,0.5);"></i>
                                        </th>
                                        <th style="padding: 0.75rem 1rem; text-align: left; cursor: pointer;"
                                            onclick="handleEnsayosSort('vt', 'Tratamiento')">
                                            Tratamiento <i id="sort-vt-Tratamiento"
                                                class="ri-arrow-up-down-line sort-icon"
                                                style="color: rgba(255,255,255,0.5);"></i>
                                        </th>
                                        <th style="padding: 0.75rem 1rem; text-align: left; cursor: pointer;"
                                            onclick="handleEnsayosSort('vt', 'Inspector')">
                                            Inspector <i id="sort-vt-Inspector" class="ri-arrow-up-down-line sort-icon"
                                                style="color: rgba(255,255,255,0.5);"></i>
                                        </th>
                                    </tr>
                                </thead>
                                <tbody id="ensayosVtTableBody">
                                    <tr>
                                        <td colspan="7"
                                            style="text-align: center; padding: 2rem; color: var(--text-muted);">
                                            Seleccione filtros y pulse buscar
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ENSAYOS PT VIEW -->
            <div id="ensayos-ptView" class="view-section">
                <div style="padding: 1.5rem;">
                    <!-- Filter Bar -->
                    <div
                        style="margin-bottom: 1.5rem; padding: 1rem; background: var(--bg-card); border-radius: 8px; box-shadow: var(--shadow-sm); display: flex; flex-wrap: wrap; align-items: flex-end; gap: 1rem;">
                        <div style="display: flex; flex-direction: column; gap: 0.25rem;">
                            <label for="ensayosPtArticuloFilter"
                                style="font-weight: 600; font-size: 0.75rem; text-transform: uppercase; color: var(--text-muted);">Artículo
                                / Referencia</label>
                            <input type="text" id="ensayosPtArticuloFilter" placeholder="Buscar..."
                                style="padding: 0.5rem 1rem; border-radius: 6px; border: 1px solid var(--border); background: var(--bg-card); color: var(--text-main); min-width: 200px;">
                        </div>
                        <div style="display: flex; flex-direction: column; gap: 0.25rem;">
                            <label for="ensayosPtTratamientoFilter"
                                style="font-weight: 600; font-size: 0.75rem; text-transform: uppercase; color: var(--text-muted);">Tratamiento</label>
                            <select id="ensayosPtTratamientoFilter"
                                style="padding: 0.5rem 1rem; border-radius: 6px; border: 1px solid var(--border); background: var(--bg-card); color: var(--text-main); min-width: 150px;">
                                <option value="">Todos</option>
                            </select>
                        </div>
                        <button id="buscarEnsayosPtBtn" class="btn-primary"
                            style="padding: 0.5rem 1rem; border-radius: 6px; border: none; background: var(--primary); color: white; cursor: pointer; display: flex; align-items: center; gap: 0.5rem;">
                            <i class="ri-search-line"></i> Buscar
                        </button>
                    </div>

                    <!-- Info & Pagination (Top) -->
                    <div id="ensayosPtInfo"
                        style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                        <span id="ensayosPtResultCount" style="font-weight: 600; color: var(--text-main);">0 registros
                            encontrados</span>
                        <div id="ensayosPtPaginationBar" style="display: flex; gap: 0.5rem; align-items: center;">
                            <span id="ensayosPtPageInfo"
                                style="font-size: 0.875rem; color: var(--text-muted); margin-right: 0.5rem;">Pagina 1 de
                                1</span>
                            <button id="ensayosPtPrevBtn" disabled
                                style="padding: 0.5rem; border: 1px solid var(--border); border-radius: 4px; background: var(--bg-card); color: var(--text-main); cursor: pointer; opacity: 0.5;">
                                <i class="ri-arrow-left-s-line"></i>
                            </button>
                            <button id="ensayosPtNextBtn" disabled
                                style="padding: 0.5rem; border: 1px solid var(--border); border-radius: 4px; background: var(--bg-card); color: var(--text-main); cursor: pointer; opacity: 0.5;">
                                <i class="ri-arrow-right-s-line"></i>
                            </button>
                        </div>
                    </div>

                    <!-- Table -->
                    <div class="table-card"
                        style="background: var(--bg-card); border-radius: 8px; box-shadow: var(--shadow-sm); overflow: hidden;">
                        <div class="table-wrapper" style="overflow-x: auto;">
                            <table id="ensayosPtTable" style="width: 100%; border-collapse: collapse;">
                                <thead>
                                    <tr style="background: var(--primary); color: white;">
                                        <th style="padding: 0.75rem 1rem; text-align: left; cursor: pointer;"
                                            onclick="handleEnsayosSort('pt', 'Fecha')">
                                            Fecha <i id="sort-pt-Fecha" class="ri-arrow-down-line sort-icon"></i>
                                        </th>
                                        <th style="padding: 0.75rem 1rem; text-align: left; cursor: pointer;"
                                            onclick="handleEnsayosSort('pt', 'Referencia')">
                                            Referencia <i id="sort-pt-Referencia"
                                                class="ri-arrow-up-down-line sort-icon"
                                                style="color: rgba(255,255,255,0.5);"></i>
                                        </th>
                                        <th style="padding: 0.75rem 1rem; text-align: left; cursor: pointer;"
                                            onclick="handleEnsayosSort('pt', 'Informe')">
                                            Informe <i id="sort-pt-Informe" class="ri-arrow-up-down-line sort-icon"
                                                style="color: rgba(255,255,255,0.5);"></i>
                                        </th>
                                        <th style="padding: 0.75rem 1rem; text-align: left; cursor: pointer;"
                                            onclick="handleEnsayosSort('pt', 'Colada')">
                                            Colada <i id="sort-pt-Colada" class="ri-arrow-up-down-line sort-icon"
                                                style="color: rgba(255,255,255,0.5);"></i>
                                        </th>
                                        <th style="padding: 0.75rem 1rem; text-align: left; cursor: pointer;"
                                            onclick="handleEnsayosSort('pt', 'Lingote')">
                                            Lingote <i id="sort-pt-Lingote" class="ri-arrow-up-down-line sort-icon"
                                                style="color: rgba(255,255,255,0.5);"></i>
                                        </th>
                                        <th style="padding: 0.75rem 1rem; text-align: left; cursor: pointer;"
                                            onclick="handleEnsayosSort('pt', 'Tratamiento')">
                                            Tratamiento <i id="sort-pt-Tratamiento"
                                                class="ri-arrow-up-down-line sort-icon"
                                                style="color: rgba(255,255,255,0.5);"></i>
                                        </th>
                                        <th style="padding: 0.75rem 1rem; text-align: left; cursor: pointer;"
                                            onclick="handleEnsayosSort('pt', 'Inspector')">
                                            Inspector <i id="sort-pt-Inspector" class="ri-arrow-up-down-line sort-icon"
                                                style="color: rgba(255,255,255,0.5);"></i>
                                        </th>
                                    </tr>
                                </thead>
                                <tbody id="ensayosPtTableBody">
                                    <tr>
                                        <td colspan="7"
                                            style="text-align: center; padding: 2rem; color: var(--text-muted);">
                                            Seleccione filtros y pulse buscar
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ENSAYOS RT VIEW -->
            <div id="ensayos-rtView" class="view-section">
                <div style="padding: 1.5rem;">
                    <!-- Filter Bar -->
                    <div
                        style="margin-bottom: 1.5rem; padding: 1rem; background: var(--bg-card); border-radius: 8px; box-shadow: var(--shadow-sm); display: flex; flex-wrap: wrap; align-items: flex-end; gap: 1rem;">
                        <div style="display: flex; flex-direction: column; gap: 0.25rem;">
                            <label for="ensayosRtArticuloFilter"
                                style="font-weight: 600; font-size: 0.75rem; text-transform: uppercase; color: var(--text-muted);">Artículo
                                / Referencia</label>
                            <input type="text" id="ensayosRtArticuloFilter" placeholder="Buscar..."
                                style="padding: 0.5rem 1rem; border-radius: 6px; border: 1px solid var(--border); background: var(--bg-card); color: var(--text-main); min-width: 200px;">
                        </div>
                        <div style="display: flex; flex-direction: column; gap: 0.25rem;">
                            <label for="ensayosRtTratamientoFilter"
                                style="font-weight: 600; font-size: 0.75rem; text-transform: uppercase; color: var(--text-muted);">Tratamiento</label>
                            <select id="ensayosRtTratamientoFilter"
                                style="padding: 0.5rem 1rem; border-radius: 6px; border: 1px solid var(--border); background: var(--bg-card); color: var(--text-main); min-width: 150px;">
                                <option value="">Todos</option>
                            </select>
                        </div>
                        <button id="buscarEnsayosRtBtn" class="btn-primary"
                            style="padding: 0.5rem 1rem; border-radius: 6px; border: none; background: var(--primary); color: white; cursor: pointer; display: flex; align-items: center; gap: 0.5rem;">
                            <i class="ri-search-line"></i> Buscar
                        </button>
                    </div>

                    <!-- Info & Pagination (Top) -->
                    <div id="ensayosRtInfo"
                        style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                        <span id="ensayosRtResultCount" style="font-weight: 600; color: var(--text-main);">0 registros
                            encontrados</span>
                        <div id="ensayosRtPaginationBar" style="display: flex; gap: 0.5rem; align-items: center;">
                            <span id="ensayosRtPageInfo"
                                style="font-size: 0.875rem; color: var(--text-muted); margin-right: 0.5rem;">Pagina 1 de
                                1</span>
                            <button id="ensayosRtPrevBtn" disabled
                                style="padding: 0.5rem; border: 1px solid var(--border); border-radius: 4px; background: var(--bg-card); color: var(--text-main); cursor: pointer; opacity: 0.5;">
                                <i class="ri-arrow-left-s-line"></i>
                            </button>
                            <button id="ensayosRtNextBtn" disabled
                                style="padding: 0.5rem; border: 1px solid var(--border); border-radius: 4px; background: var(--bg-card); color: var(--text-main); cursor: pointer; opacity: 0.5;">
                                <i class="ri-arrow-right-s-line"></i>
                            </button>
                        </div>
                    </div>

                    <!-- Table -->
                    <div class="table-card"
                        style="background: var(--bg-card); border-radius: 8px; box-shadow: var(--shadow-sm); overflow: hidden;">
                        <div class="table-wrapper" style="overflow-x: auto;">
                            <table id="ensayosRtTable" style="width: 100%; border-collapse: collapse;">
                                <thead>
                                    <tr style="background: var(--primary); color: white;">
                                        <th style="padding: 0.75rem 1rem; text-align: left; cursor: pointer;"
                                            onclick="handleEnsayosSort('rt', 'Fecha')">
                                            Fecha <i id="sort-rt-Fecha" class="ri-arrow-down-line sort-icon"></i>
                                        </th>
                                        <th style="padding: 0.75rem 1rem; text-align: left; cursor: pointer;"
                                            onclick="handleEnsayosSort('rt', 'Referencia')">
                                            Referencia <i id="sort-rt-Referencia"
                                                class="ri-arrow-up-down-line sort-icon"
                                                style="color: rgba(255,255,255,0.5);"></i>
                                        </th>
                                        <th style="padding: 0.75rem 1rem; text-align: left; cursor: pointer;"
                                            onclick="handleEnsayosSort('rt', 'Informe')">
                                            Informe <i id="sort-rt-Informe" class="ri-arrow-up-down-line sort-icon"
                                                style="color: rgba(255,255,255,0.5);"></i>
                                        </th>
                                        <th style="padding: 0.75rem 1rem; text-align: left; cursor: pointer;"
                                            onclick="handleEnsayosSort('rt', 'Colada')">
                                            Colada <i id="sort-rt-Colada" class="ri-arrow-up-down-line sort-icon"
                                                style="color: rgba(255,255,255,0.5);"></i>
                                        </th>
                                        <th style="padding: 0.75rem 1rem; text-align: left; cursor: pointer;"
                                            onclick="handleEnsayosSort('rt', 'Lingote')">
                                            Lingote <i id="sort-rt-Lingote" class="ri-arrow-up-down-line sort-icon"
                                                style="color: rgba(255,255,255,0.5);"></i>
                                        </th>
                                        <th style="padding: 0.75rem 1rem; text-align: left; cursor: pointer;"
                                            onclick="handleEnsayosSort('rt', 'Tratamiento')">
                                            Tratamiento <i id="sort-rt-Tratamiento"
                                                class="ri-arrow-up-down-line sort-icon"
                                                style="color: rgba(255,255,255,0.5);"></i>
                                        </th>
                                        <th style="padding: 0.75rem 1rem; text-align: left; cursor: pointer;"
                                            onclick="handleEnsayosSort('rt', 'Inspector')">
                                            Inspector <i id="sort-rt-Inspector" class="ri-arrow-up-down-line sort-icon"
                                                style="color: rgba(255,255,255,0.5);"></i>
                                        </th>
                                    </tr>
                                </thead>
                                <tbody id="ensayosRtTableBody">
                                    <tr>
                                        <td colspan="7"
                                            style="text-align: center; padding: 2rem; color: var(--text-muted);">
                                            Seleccione filtros y pulse buscar
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>


            <div id="adminView" class="view-section">
                <div style="padding: 2rem;">
                    <div style="padding: 2rem;">
                        <div
                            style="display: flex; justify-content: flex-end; align-items: center; margin-bottom: 1.5rem;">
                            <button onclick="openUserModal()" class="btn-primary"
                                style="padding: 0.75rem 1.5rem; background: var(--primary); color: white; border: none; border-radius: 8px; cursor: pointer; display: flex; align-items: center; gap: 0.5rem;">
                                <i class="ri-user-add-line"></i> Nuevo Usuario
                            </button>
                        </div>

                        <!-- Users Table -->
                        <div class="table-card"
                            style="background: var(--bg-card); border-radius: 12px; overflow: hidden;">
                            <div class="table-wrapper" style="overflow-x: auto;">
                                <table style="width: 100%; border-collapse: collapse;">
                                    <thead>
                                        <tr style="background: var(--primary); color: white;">
                                            <th style="padding: 1rem; text-align: left;">Username</th>
                                            <th style="padding: 1rem; text-align: left;">Nombre Completo</th>
                                            <th style="padding: 1rem; text-align: center;">Iniciales</th>
                                            <th style="padding: 1rem; text-align: center;">Password</th>
                                            <th style="padding: 1rem; text-align: center;">Rol</th>
                                            <th style="padding: 1rem; text-align: center;">Activo</th>
                                            <th style="padding: 1rem; text-align: center;">Acciones</th>
                                        </tr>
                                    </thead>
                                    <tbody id="adminUsersTableBody">
                                        <!-- Populated dynamically -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- Color Editor Section -->
                    <div style="padding: 0 2rem 2rem 2rem;">
                        <div class="table-card"
                            style="background: var(--bg-card); border-radius: 12px; padding: 1.5rem;">
                            <div
                                style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                                <h3 style="margin: 0; font-size: 1.125rem; font-weight: 600;">
                                    <i class="ri-palette-line" style="margin-right: 0.5rem;"></i>Personalización de
                                    Colores
                                </h3>
                                <div style="display: flex; gap: 0.5rem;">
                                    <button onclick="resetCustomColors()"
                                        style="padding: 0.5rem 1rem; border: 1px solid var(--border); border-radius: 6px; background: var(--bg-body); color: var(--text-main); cursor: pointer; display: flex; align-items: center; gap: 0.25rem;">
                                        <i class="ri-refresh-line"></i> Resetear
                                    </button>
                                    <button onclick="saveCustomColors()"
                                        style="padding: 0.5rem 1rem; border: none; border-radius: 6px; background: var(--primary); color: white; cursor: pointer; display: flex; align-items: center; gap: 0.25rem;">
                                        <i class="ri-save-line"></i> Guardar
                                    </button>
                                </div>
                            </div>

                            <div
                                style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 1rem;">
                                <!-- Primary Color -->
                                <div class="color-picker-group"
                                    style="display: flex; flex-direction: column; gap: 0.5rem;">
                                    <label style="font-weight: 500; font-size: 0.875rem;">Color Principal</label>
                                    <div style="display: flex; align-items: center; gap: 0.5rem;">
                                        <input type="color" id="colorPrimary" value="#4f46e5"
                                            style="width: 40px; height: 40px; border: none; cursor: pointer; border-radius: 6px;">
                                        <input type="text" id="colorPrimaryHex" value="#4f46e5"
                                            style="flex: 1; padding: 0.5rem; border: 1px solid var(--border); border-radius: 6px; background: var(--bg-body); color: var(--text-main); font-family: monospace;">
                                    </div>
                                </div>

                                <!-- Sidebar Background -->
                                <div class="color-picker-group"
                                    style="display: flex; flex-direction: column; gap: 0.5rem;">
                                    <label style="font-weight: 500; font-size: 0.875rem;">Fondo Sidebar</label>
                                    <div style="display: flex; align-items: center; gap: 0.5rem;">
                                        <input type="color" id="colorSidebar" value="#0f172a"
                                            style="width: 40px; height: 40px; border: none; cursor: pointer; border-radius: 6px;">
                                        <input type="text" id="colorSidebarHex" value="#0f172a"
                                            style="flex: 1; padding: 0.5rem; border: 1px solid var(--border); border-radius: 6px; background: var(--bg-body); color: var(--text-main); font-family: monospace;">
                                    </div>
                                </div>

                                <!-- Card Background -->
                                <div class="color-picker-group"
                                    style="display: flex; flex-direction: column; gap: 0.5rem;">
                                    <label style="font-weight: 500; font-size: 0.875rem;">Fondo Cards</label>
                                    <div style="display: flex; align-items: center; gap: 0.5rem;">
                                        <input type="color" id="colorCard" value="#ffffff"
                                            style="width: 40px; height: 40px; border: none; cursor: pointer; border-radius: 6px;">
                                        <input type="text" id="colorCardHex" value="#ffffff"
                                            style="flex: 1; padding: 0.5rem; border: 1px solid var(--border); border-radius: 6px; background: var(--bg-body); color: var(--text-main); font-family: monospace;">
                                    </div>
                                </div>

                                <!-- Body Background -->
                                <div class="color-picker-group"
                                    style="display: flex; flex-direction: column; gap: 0.5rem;">
                                    <label style="font-weight: 500; font-size: 0.875rem;">Fondo General</label>
                                    <div style="display: flex; align-items: center; gap: 0.5rem;">
                                        <input type="color" id="colorBody" value="#f8fafc"
                                            style="width: 40px; height: 40px; border: none; cursor: pointer; border-radius: 6px;">
                                        <input type="text" id="colorBodyHex" value="#f8fafc"
                                            style="flex: 1; padding: 0.5rem; border: 1px solid var(--border); border-radius: 6px; background: var(--bg-body); color: var(--text-main); font-family: monospace;">
                                    </div>
                                </div>

                                <!-- Text Main -->
                                <div class="color-picker-group"
                                    style="display: flex; flex-direction: column; gap: 0.5rem;">
                                    <label style="font-weight: 500; font-size: 0.875rem;">Texto Principal</label>
                                    <div style="display: flex; align-items: center; gap: 0.5rem;">
                                        <input type="color" id="colorText" value="#0f172a"
                                            style="width: 40px; height: 40px; border: none; cursor: pointer; border-radius: 6px;">
                                        <input type="text" id="colorTextHex" value="#0f172a"
                                            style="flex: 1; padding: 0.5rem; border: 1px solid var(--border); border-radius: 6px; background: var(--bg-body); color: var(--text-main); font-family: monospace;">
                                    </div>
                                </div>

                                <!-- Success Color -->
                                <div class="color-picker-group"
                                    style="display: flex; flex-direction: column; gap: 0.5rem;">
                                    <label style="font-weight: 500; font-size: 0.875rem;">Color Éxito</label>
                                    <div style="display: flex; align-items: center; gap: 0.5rem;">
                                        <input type="color" id="colorSuccess" value="#10b981"
                                            style="width: 40px; height: 40px; border: none; cursor: pointer; border-radius: 6px;">
                                        <input type="text" id="colorSuccessHex" value="#10b981"
                                            style="flex: 1; padding: 0.5rem; border: 1px solid var(--border); border-radius: 6px; background: var(--bg-body); color: var(--text-main); font-family: monospace;">
                                    </div>
                                </div>

                                <!-- Danger Color -->
                                <div class="color-picker-group"
                                    style="display: flex; flex-direction: column; gap: 0.5rem;">
                                    <label style="font-weight: 500; font-size: 0.875rem;">Color Peligro</label>
                                    <div style="display: flex; align-items: center; gap: 0.5rem;">
                                        <input type="color" id="colorDanger" value="#ef4444"
                                            style="width: 40px; height: 40px; border: none; cursor: pointer; border-radius: 6px;">
                                        <input type="text" id="colorDangerHex" value="#ef4444"
                                            style="flex: 1; padding: 0.5rem; border: 1px solid var(--border); border-radius: 6px; background: var(--bg-body); color: var(--text-main); font-family: monospace;">
                                    </div>
                                </div>

                                <!-- Warning Color -->
                                <div class="color-picker-group"
                                    style="display: flex; flex-direction: column; gap: 0.5rem;">
                                    <label style="font-weight: 500; font-size: 0.875rem;">Color Advertencia</label>
                                    <div style="display: flex; align-items: center; gap: 0.5rem;">
                                        <input type="color" id="colorWarning" value="#f59e0b"
                                            style="width: 40px; height: 40px; border: none; cursor: pointer; border-radius: 6px;">
                                        <input type="text" id="colorWarningHex" value="#f59e0b"
                                            style="flex: 1; padding: 0.5rem; border: 1px solid var(--border); border-radius: 6px; background: var(--bg-body); color: var(--text-main); font-family: monospace;">
                                    </div>
                                </div>
                            </div>

                            <div
                                style="margin-top: 1.5rem; padding: 1rem; background: var(--bg-body); border-radius: 8px;">
                                <p style="margin: 0; font-size: 0.875rem; color: var(--text-muted);">
                                    <i class="ri-information-line" style="margin-right: 0.25rem;"></i>
                                    Los colores se guardan en tu navegador y se aplicarán automáticamente al cargar la
                                    aplicación.
                                </p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- User Edit Modal -->
                <div id="userModal"
                    style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 1000; justify-content: center; align-items: center;">
                    <div
                        style="background: var(--bg-card); border-radius: 16px; padding: 2rem; max-width: 500px; width: 90%; max-height: 90vh; overflow-y: auto;">
                        <div
                            style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                            <h2 id="userModalTitle" style="margin: 0; color: var(--text-main);">Nuevo Usuario</h2>
                            <button onclick="closeUserModal()"
                                style="background: none; border: none; font-size: 1.5rem; cursor: pointer; color: var(--text-muted);">
                                <i class="ri-close-line"></i>
                            </button>
                        </div>

                        <form id="userForm" onsubmit="saveUser(event)">
                            <input type="hidden" id="editingUsername">

                            <div style="margin-bottom: 1rem;">
                                <label
                                    style="display: block; margin-bottom: 0.5rem; font-weight: 500; color: var(--text-main);">Username
                                    *</label>
                                <input type="text" id="userFormUsername" required
                                    style="width: 100%; padding: 0.75rem; border: 1px solid var(--border); border-radius: 8px; background: var(--bg-main); color: var(--text-main);">
                            </div>

                            <div style="margin-bottom: 1rem;">
                                <label
                                    style="display: block; margin-bottom: 0.5rem; font-weight: 500; color: var(--text-main);">Nombre
                                    Completo *</label>
                                <input type="text" id="userFormNombre" required
                                    style="width: 100%; padding: 0.75rem; border: 1px solid var(--border); border-radius: 8px; background: var(--bg-main); color: var(--text-main);">
                            </div>

                            <div style="margin-bottom: 1rem;">
                                <label
                                    style="display: block; margin-bottom: 0.5rem; font-weight: 500; color: var(--text-main);">Password
                                    <span id="passwordRequired">*</span></label>
                                <input type="password" id="userFormPassword"
                                    style="width: 100%; padding: 0.75rem; border: 1px solid var(--border); border-radius: 8px; background: var(--bg-main); color: var(--text-main);">
                                <small id="passwordHelp" style="color: var(--text-muted); display: none;">Dejar vacío
                                    para
                                    mantener la contraseña actual</small>
                            </div>

                            <div style="margin-bottom: 1rem;">
                                <label
                                    style="display: block; margin-bottom: 0.5rem; font-weight: 500; color: var(--text-main);">Iniciales</label>
                                <input type="text" id="userFormIniciales" maxlength="5"
                                    style="width: 100%; padding: 0.75rem; border: 1px solid var(--border); border-radius: 8px; background: var(--bg-main); color: var(--text-main);">
                            </div>

                            <div style="margin-bottom: 1rem;">
                                <label
                                    style="display: block; margin-bottom: 0.5rem; font-weight: 500; color: var(--text-main);">Rol</label>
                                <select id="userFormRol"
                                    style="width: 100%; padding: 0.75rem; border: 1px solid var(--border); border-radius: 8px; background: var(--bg-main); color: var(--text-main);">
                                    <option value="operario">Operario</option>
                                    <option value="supervisor">Supervisor</option>
                                    <option value="admin">Administrador</option>
                                </select>
                            </div>

                            <div style="margin-bottom: 1.5rem;">
                                <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                                    <input type="checkbox" id="userFormActivo" checked
                                        style="width: 18px; height: 18px;">
                                    <span style="color: var(--text-main);">Usuario Activo</span>
                                </label>
                            </div>

                            <div style="display: flex; gap: 1rem; justify-content: flex-end;">
                                <button type="button" onclick="closeUserModal()"
                                    style="padding: 0.75rem 1.5rem; background: var(--bg-main); color: var(--text-main); border: 1px solid var(--border); border-radius: 8px; cursor: pointer;">
                                    Cancelar
                                </button>
                                <button type="submit"
                                    style="padding: 0.75rem 1.5rem; background: var(--primary); color: white; border: none; border-radius: 8px; cursor: pointer;">
                                    Guardar
                                </button>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- Equipo Detail Modal -->
                <div id="equipoModal"
                    style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 1000; justify-content: center; align-items: center;">
                    <div
                        style="background: var(--bg-card); border-radius: 16px; padding: 2rem; width: 90%; max-width: 1000px; max-height: 90vh; overflow-y: auto; display: flex; flex-direction: column; gap: 1.5rem;">

                        <!-- Header -->
                        <div style="display: flex; justify-content: space-between; align-items: flex-start;">
                            <div>
                                <h2 id="equipoModalTitle"
                                    style="margin: 0; color: var(--text-main); font-size: 1.5rem;">Detalle
                                    del Equipo
                                </h2>
                                <p id="equipoModalSubtitle" style="margin: 0.5rem 0 0 0; color: var(--text-muted);"></p>
                            </div>
                            <button onclick="closeEquipoModal()"
                                style="background: none; border: none; font-size: 1.5rem; cursor: pointer; color: var(--text-muted);">
                                <i class="ri-close-line"></i>
                            </button>
                        </div>

                        <!-- Main Info Grid -->
                        <div
                            style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; padding: 1rem; background: var(--bg-body); border-radius: 12px;">
                            <div>
                                <label
                                    style="display: block; font-size: 0.75rem; color: var(--text-muted); margin-bottom: 0.25rem;">Nº
                                    Identificación</label>
                                <strong id="em-ref" style="font-size: 1.1rem; color: var(--text-main);">-</strong>
                            </div>
                            <div>
                                <label
                                    style="display: block; font-size: 0.75rem; color: var(--text-muted); margin-bottom: 0.25rem;">Instrumento</label>
                                <strong id="em-nombre" style="font-size: 1rem; color: var(--text-main);">-</strong>
                            </div>
                            <div>
                                <label
                                    style="display: block; font-size: 0.75rem; color: var(--text-muted); margin-bottom: 0.25rem;">Marca
                                    / Modelo</label>
                                <strong id="em-marca" style="font-size: 1rem; color: var(--text-main);">-</strong>
                            </div>
                            <div>
                                <label
                                    style="display: block; font-size: 0.75rem; color: var(--text-muted); margin-bottom: 0.25rem;">Nº
                                    Serie</label>
                                <strong id="em-serie" style="font-size: 1rem; color: var(--text-main);">-</strong>
                            </div>
                            <div>
                                <label
                                    style="display: block; font-size: 0.75rem; color: var(--text-muted); margin-bottom: 0.25rem;">Ubicación</label>
                                <strong id="em-ubicacion" style="font-size: 1rem; color: var(--text-main);">-</strong>
                            </div>
                            <div>
                                <label
                                    style="display: block; font-size: 0.75rem; color: var(--text-muted); margin-bottom: 0.25rem;">Estado
                                    Operativo</label>
                                <span id="em-estado" class="badge badge-success">-</span>
                            </div>
                        </div>

                        <!-- Additional Specs -->
                        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 1rem;">
                            <div style="padding: 1rem; border: 1px solid var(--border); border-radius: 8px;">
                                <h4 style="margin: 0 0 0.5rem 0; color: var(--text-main);">Especificaciones</h4>
                                <ul
                                    style="list-style: none; padding: 0; margin: 0; font-size: 0.9rem; color: var(--text-secondary);">
                                    <li><strong>Campo Medida:</strong> <span id="em-campo">-</span></li>
                                    <li><strong>División Escala:</strong> <span id="em-division">-</span></li>
                                    <li><strong>Incertidumbre:</strong> <span id="em-incertidumbre">-</span></li>
                                </ul>
                            </div>
                            <div style="padding: 1rem; border: 1px solid var(--border); border-radius: 8px;">
                                <h4 style="margin: 0 0 0.5rem 0; color: var(--text-main);">Calibración</h4>
                                <ul
                                    style="list-style: none; padding: 0; margin: 0; font-size: 0.9rem; color: var(--text-secondary);">
                                    <li><strong>Periodicidad:</strong> <span id="em-periodo">-</span></li>
                                    <li><strong>Organismo:</strong> <span id="em-organismo">-</span></li>
                                    <li><strong>Próxima:</strong> <span id="em-proxima"
                                            style="font-weight: bold;">-</span></li>
                                </ul>
                            </div>
                        </div>

                        <!-- History Table -->
                        <div>
                            <h3 style="margin: 0 0 1rem 0; color: var(--text-main);">Histórico de Calibraciones</h3>
                            <div class="table-container" style="max-height: 300px;">
                                <table class="data-table">
                                    <thead>
                                        <tr>
                                            <th>Fecha</th>
                                            <th>Certificado (Nº EC)</th>
                                            <th>Resultado</th>
                                            <th>Realizado Por</th>
                                            <th>Temp ºC</th>
                                            <th>Humedad %</th>
                                            <th>Observaciones</th>
                                            <th>Documento</th>
                                        </tr>
                                    </thead>
                                    <tbody id="em-history-body">
                                        <!-- Populated via JS -->
                                    </tbody>
                                </table>
                            </div>
                        </div>

                    </div>
                </div>

                <!-- Loading Overlay -->
                <div class="loading-overlay" id="loadingOverlay">
                    <div class="spinner"></div>
                    <p>Cargando datos de SQL Server...</p>
                </div>
        </main>
    </div>

    <!-- Toast Notifications Container -->
    <div id="toastContainer"
        style="position: fixed; top: 1.5rem; right: 1.5rem; z-index: 9999; display: flex; flex-direction: column; gap: 0.75rem; pointer-events: none;">
    </div>

    <!-- Confirm Modal -->
    <div id="confirmModal"
        style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.6); z-index: 10000; justify-content: center; align-items: center; backdrop-filter: blur(4px);">
        <div
            style="background: var(--bg-card); border-radius: 16px; padding: 2rem; max-width: 400px; width: 90%; text-align: center; box-shadow: 0 25px 50px rgba(0,0,0,0.3);">
            <div
                style="width: 60px; height: 60px; background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 1.5rem;">
                <i class="ri-delete-bin-line" style="font-size: 2rem; color: white;"></i>
            </div>
            <h3 id="confirmTitle" style="margin: 0 0 0.75rem; color: var(--text-main); font-size: 1.25rem;">¿Eliminar
                usuario?</h3>
            <p id="confirmMessage" style="margin: 0 0 1.5rem; color: var(--text-muted);">Esta acción no se puede
                deshacer.</p>
            <div style="display: flex; gap: 1rem; justify-content: center;">
                <button onclick="closeConfirmModal(false)"
                    style="padding: 0.75rem 1.5rem; background: var(--bg-main); color: var(--text-main); border: 1px solid var(--border); border-radius: 8px; cursor: pointer; font-weight: 500;">
                    Cancelar
                </button>
                <button onclick="closeConfirmModal(true)"
                    style="padding: 0.75rem 1.5rem; background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%); color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 500;">
                    Eliminar
                </button>
            </div>
        </div>
    </div>

    <script src="app.js?v=202412231302"></script>
</body>

</html>